<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viego: The Ruined King RPG</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap');

        :root {
            --ruined-green: #0ac8b9;
            --dark-bg: #05080a;
            --power-yellow: #f1c40f;
            --hp-red: #c0392b;
            --crit-color: #ffcc00;
            --heal-color: #2ecc71;
            --morde-realm: #2c3e50;
        }

        body {
            background-color: var(--dark-bg);
            background-image: linear-gradient(rgba(0,0,0,0.8), rgba(0,20,20,0.9)), url('https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Viego_0.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #e0e0e0;
            font-family: 'Cinzel', serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
            transition: filter 1s ease, box-shadow 1s ease;
        }

        body.death-realm-active {
            filter: grayscale(100%) sepia(30%) hue-rotate(90deg) contrast(1.1);
            box-shadow: inset 0 0 150px #0ac8b9;
        }

        /* --- INFO MODAL & BUTTONS --- */
        .info-btn {
            position: absolute;
            top: 0; left: 10px;
            width: 25px; height: 25px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--ruined-green);
            color: var(--ruined-green);
            border-radius: 50%;
            font-weight: bold; font-family: sans-serif; font-size: 14px;
            cursor: pointer; z-index: 60;
            display: flex; justify-content: center; align-items: center;
            transition: 0.3s;
        }
        .info-btn:hover { background: var(--ruined-green); color: black; transform: scale(1.1); }

        .info-modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 320px;
            background: rgba(15, 20, 25, 0.98);
            border: 2px solid var(--ruined-green);
            padding: 20px;
            z-index: 1000; /* En √ºstte */
            display: none;
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
            text-align: left;
            font-family: sans-serif; font-size: 13px; line-height: 1.5; color: #ddd;
        }
        .info-modal h3 { color: var(--ruined-green); margin-top: 0; text-align: center; border-bottom: 1px solid #444; padding-bottom: 10px; font-family: 'Cinzel', serif; }
        .info-strong { color: #e74c3c; font-weight: bold; }
        .info-weak { color: #2ecc71; font-weight: bold; }
        .info-close { margin-top: 15px; width: 100%; background: #333; color: white; border: 1px solid #555; padding: 8px; cursor: pointer; text-transform: uppercase; font-weight: bold; transition: 0.2s;}
        .info-close:hover { background: var(--ruined-green); color: black; }

        /* --- OYUN ALANI --- */
        .game-wrapper { 
            width: 90%; max-width: 1000px; 
            background: rgba(10, 12, 15, 0.95); 
            border: 2px solid #333; 
            border-top: 4px solid var(--ruined-green); 
            box-shadow: 0 0 50px rgba(10, 200, 185, 0.1); 
            padding: 20px; 
            position: relative; 
            display: flex; flex-direction: column; 
            height: 650px; 
        }

        #start-screen, #cinematic-dialogue, #overlay, #final-choice-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }
        
        #start-screen { background: rgba(0,0,0,0.95); z-index: 200; }
        #overlay, #final-choice-overlay { background: rgba(0,0,0,0.95); display: none; }
        
        #cinematic-dialogue { 
            display: none; justify-content: flex-end; padding-bottom: 50px;
            background: rgba(0,0,0,0.4); pointer-events: none; 
        }
        
        .dialogue-box {
            background: rgba(0, 0, 0, 0.9); border: 2px solid var(--ruined-green);
            padding: 20px; width: 80%; pointer-events: auto;
            box-shadow: 0 0 30px rgba(10, 200, 185, 0.2);
        }

        #cinematic-text { font-size: 1.2rem; color: #fff; margin-bottom: 15px; font-style: italic; }
        #cinematic-btn { background: transparent; border: 1px solid var(--ruined-green); color: var(--ruined-green); padding: 5px 20px; cursor: pointer; font-family: 'Cinzel', serif; transition: 0.3s; }
        #cinematic-btn:hover { background: var(--ruined-green); color: black; }

        .start-btn { padding: 15px 40px; font-size: 1.5rem; background: transparent; color: var(--ruined-green); border: 2px solid var(--ruined-green); font-family: 'Cinzel', serif; cursor: pointer; transition: 0.3s; margin-top: 30px; }
        .start-btn:hover { background: var(--ruined-green); color: black; box-shadow: 0 0 30px var(--ruined-green); }

        .choice-btn { padding: 20px 40px; margin: 10px; font-size: 1.2rem; border: 2px solid; cursor: pointer; font-family: 'Cinzel', serif; width: 300px; transition: 0.3s; background: rgba(0,0,0,0.8); }
        .btn-attack { border-color: #c0392b; color: #c0392b; }
        .btn-attack:hover { background: #c0392b; color: white; }
        .btn-surrender { border-color: #2ecc71; color: #2ecc71; }
        .btn-surrender:hover { background: #2ecc71; color: white; }

        .battle-scene { flex-grow: 1; display: flex; justify-content: space-between; align-items: center; padding: 0 40px; position: relative; }
        .character-box { width: 250px; text-align: center; position: relative; }
        
        .character-img { 
            width: 200px; height: 200px; object-fit: cover; 
            object-position: center 20%; 
            border-radius: 50%; border: 4px solid #444; 
            box-shadow: 0 0 20px rgba(0,0,0,0.5); transition: transform 0.2s; 
        }
        
        .viego-glow { border-color: var(--ruined-green); box-shadow: 0 0 30px rgba(10, 200, 185, 0.3); }
        .enemy-glow { border-color: #d63031; box-shadow: 0 0 30px rgba(214, 48, 49, 0.3); }
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }

        .stat-bar { width: 100%; height: 18px; background: #222; margin-top: 10px; border: 1px solid #444; position: relative; }
        .fill { height: 100%; transition: width 0.5s ease-out; }
        .hp-fill { background-color: var(--hp-red); }
        .power-fill { background-color: var(--power-yellow); box-shadow: 0 0 10px var(--power-yellow); }
        .shield-fill { background-color: #95a5a6; position: absolute; top: 0; left: 0; height: 100%; width: 0%; opacity: 0.7; }
        .bar-text { font-size: 13px; font-weight: bold; position: absolute; top: 0; right: 5px; color: #fff; text-shadow: 1px 1px 2px black; z-index: 10; line-height: 18px; }

        .controls { height: 160px; border-top: 1px solid #444; display: grid; grid-template-columns: 2fr 1fr; gap: 20px; padding-top: 20px; transition: opacity 0.5s; }
        .hidden-ui { opacity: 0; pointer-events: none; }
        .skills { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; }
        
        .skill-btn { background: #111; border: 1px solid #444; color: #aaa; font-family: 'Cinzel', serif; cursor: pointer; position: relative; transition: 0.2s; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 8px; }
        .skill-btn:hover:not(:disabled) { border-color: var(--ruined-green); color: white; background: #1a1a1a; box-shadow: 0 0 10px rgba(10, 200, 185, 0.2); }
        .skill-btn:disabled { opacity: 0.3; cursor: not-allowed; border-color: #222; color: #444; background: #000; filter: grayscale(100%); }
        
        .skill-name { font-weight: bold; font-size: 0.75rem; text-align: center; margin-bottom: 3px; }
        .skill-cost { font-size: 0.65rem; color: #2ecc71; margin-top: 2px; }
        .skill-sub { font-size: 0.6rem; color: #aaa; margin-top: 2px; }
        .cooldown-text { color: #e74c3c; font-size: 0.65rem; display:none; }
        .ult-btn { border-color: var(--ruined-green); color: var(--ruined-green); }
        .ult-btn:hover:not(:disabled) { background: var(--ruined-green); color: black; }

        .log-box { 
            background: rgba(0,0,0,0.5); border: 1px solid #333; padding: 10px; 
            font-size: 0.9rem; color: #ccc; font-family: sans-serif;
            overflow-y: auto; display: flex; flex-direction: column-reverse; /* Loglar a≈üaƒüƒ±dan yukarƒ± biriksin */
        }
        
        /* KONU≈ûMA BALONLARI D√úZELTMESƒ∞ */
        .speech-bubble { 
            position: absolute; top: -80px; left: 50%; transform: translateX(-50%); 
            background: #fff; color: #000; padding: 10px 15px; border-radius: 10px; 
            font-family: sans-serif; font-size: 12px; font-weight: bold; width: 220px; 
            text-align: center; 
            z-index: 150; /* Resimlerin √∂n√ºnde */
            opacity: 0; pointer-events: none; 
            transition: opacity 0.5s, transform 0.5s; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); border: 2px solid var(--ruined-green); line-height: 1.4; 
        }
        .speech-visible { opacity: 1; transform: translateX(-50%) translateY(-10px); }

        .float-text { position: absolute; font-weight: bold; font-size: 24px; pointer-events: none; animation: floatUp 1.2s ease-out forwards; text-shadow: 2px 2px 0 #000; z-index: 100; }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-80px) scale(1); opacity: 0; } }
        .text-damage { color: #fff; } .text-crit { color: var(--crit-color); font-size: 36px; text-shadow: 0 0 15px red; } .text-heal { color: var(--heal-color); font-size: 28px; } .text-enemy-dmg { color: #e74c3c; }
        .text-special { color: #0ac8b9; font-size: 28px; text-shadow: 0 0 10px white; font-weight: bold; }
        .text-weakness { color: #ff00ff; font-size: 30px; text-shadow: 0 0 20px white; font-weight: bold; }

        .damage-flash { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 0, 0, 0.3); pointer-events: none; z-index: 50; animation: flash 0.2s linear; }
        .ult-flash { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10, 200, 185, 0.5); pointer-events: none; z-index: 50; animation: flash 1s linear; }
        .stun-flash { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 0, 0.3); pointer-events: none; z-index: 50; animation: flash 0.5s linear; }
        .void-flash { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(160, 32, 240, 0.4); pointer-events: none; z-index: 50; animation: flash 1s linear; }
        @keyframes flash { from { opacity: 1; } to { opacity: 0; } }

        .top-bar-controls { position: fixed; top: 20px; right: 20px; z-index: 200; display: flex; gap: 10px; }
        .control-btn-ui { background: rgba(0,0,0,0.5); color: white; border: 1px solid #555; padding: 5px 10px; cursor: pointer; border-radius: 4px; font-size: 14px; }
        .control-btn-ui:hover { background: var(--ruined-green); color: black; }
        select.control-btn-ui { outline: none; } select.control-btn-ui option { background: #000; color: white; }
        .back-btn { position: fixed; top: 20px; left: 20px; z-index: 200; color: var(--ruined-green); text-decoration: none; border: 1px solid var(--ruined-green); padding: 5px 15px; background: rgba(0,0,0,0.8); font-weight: bold; }
    </style>
</head>
<body>

    <a href="index.html" class="back-btn" id="btn-menu">‚Üê Menu</a>
    <div id="flash-effect"></div>
    
    <div class="top-bar-controls">
        <button class="control-btn-ui" onclick="toggleMusic()" id="btn-music">üéµ Music: OFF</button>
        <select class="control-btn-ui" id="lang-select" onchange="changeLanguage(this.value)">
            <option value="en">English</option>
            <option value="tr">T√ºrk√ße</option>
        </select>
    </div>

    <audio id="bgMusic" loop preload="auto">
        <source src="" type="audio/mpeg">
    </audio>

    <div id="info-modal" class="info-modal">
        <h3 id="info-title">KARAKTER Bƒ∞LGƒ∞Sƒ∞</h3>
        <div id="info-content">...</div>
        <button class="info-close" onclick="closeInfo()">KAPAT</button>
    </div>

    <div class="game-wrapper">
        
        <div id="start-screen">
            <h1 style="color: #fff;" id="start-title-1">THE RUINED KING'S</h1>
            <h1 id="start-title-2">REVENGE</h1>
            <p style="color: #aaa; margin-top: 10px;" id="start-sub">"It is all... for her."</p>
            <button class="start-btn" onclick="startGame()" id="start-btn">START STORY</button>
            <p style="font-size: 12px; color: #666; margin-top: 20px;" id="start-note">(Click Start to enable Audio)</p>
        </div>

        <div id="cinematic-dialogue">
            <div class="dialogue-box">
                <div id="cinematic-text">...</div>
                <button id="cinematic-btn" onclick="nextDialogue()">NEXT</button>
            </div>
        </div>

        <div id="overlay" class="overlay-msg">
            <h2 id="overlay-title">VICTORY</h2>
            <p id="overlay-quote">"..."</p>
            <div id="level-up-text" style="color: yellow; margin-bottom: 15px; display:none;">LEVEL UP!</div>
            <button class="start-btn" id="next-btn" onclick="nextLevel()">CONTINUE</button>
        </div>

        <div id="final-choice-overlay">
            <h2 style="color: #fff; margin-bottom: 30px;" id="choice-title">MAKE YOUR CHOICE</h2>
            <button class="choice-btn btn-attack" onclick="makeFinalChoice('attack')" id="btn-choice-attack">STRIKE HER DOWN</button>
            <button class="choice-btn btn-surrender" onclick="makeFinalChoice('surrender')" id="btn-choice-surrender">SURRENDER TO LOVE</button>
        </div>

        <div class="battle-scene">
            <div class="character-box" id="player-box">
                <button class="info-btn" onclick="showInfo('player')">i</button>
                <div class="speech-bubble" id="player-bubble">...</div>
                <div class="level-badge" id="player-lvl">1</div>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Viego_0.jpg" class="character-img viego-glow" id="player-img">
                <h2 style="color: var(--ruined-green);">VIEGO</h2>
                <div class="stat-bar hidden-ui" id="ui-hp-p">
                    <div class="fill hp-fill" id="player-hp-bar" style="width: 100%;"></div>
                    <span class="bar-text" id="player-hp-text">150/150</span>
                </div>
                <div class="stat-bar hidden-ui" style="border-color:#b7950b;" id="ui-mp-p">
                    <div class="fill power-fill" id="player-power-bar" style="width: 0%;"></div>
                    <span class="bar-text" id="player-power-text" style="color:black; font-weight:bold; text-shadow:none;">0/100</span>
                </div>
            </div>

            <h1 style="color: #555; font-size: 3rem;" id="vs-text">VS</h1>

            <div class="character-box" id="enemy-box">
                <button class="info-btn" onclick="showInfo('enemy')">i</button>
                <div class="speech-bubble" id="enemy-bubble">...</div>
                <div class="level-badge" id="enemy-lvl" style="background: #d63031; color: white;">1</div>
                <img src="" class="character-img enemy-glow" id="enemy-img">
                <h2 style="color: #d63031;" id="enemy-name">ENEMY</h2>
                <div class="stat-bar hidden-ui" id="ui-hp-e">
                    <div class="shield-fill" id="enemy-shield-bar" style="width: 0%;"></div>
                    <div class="fill hp-fill" id="enemy-hp-bar" style="width: 100%;"></div>
                    <span class="bar-text" id="enemy-hp-text">100/100</span>
                </div>
                <div id="boss-status" style="color: #ccc; font-size: 12px; margin-top: 5px;"></div>
            </div>
        </div>

        <div class="controls hidden-ui" id="combat-controls">
            <div class="skills">
                <button class="skill-btn" onclick="useSkill('basic')">
                    <span class="skill-name" id="skill-basic-name">Blade of the King</span>
                    <span class="skill-cost" style="color:#fff;" id="skill-basic-cost">15 Dmg | +Power</span>
                </button>
                <button class="skill-btn" id="btn-q" onclick="useSkill('q')">
                    <span class="skill-name" id="skill-q-name">Blade of the Ruined King (Q)</span>
                    <span class="skill-cost" style="color:#2ecc71;" id="skill-q-cost">30 Dmg | 15 Power</span>
                    <span class="skill-sub" id="skill-q-desc">7% Enemy HP Steal</span>
                </button>
                <button class="skill-btn" id="btn-w" onclick="useSkill('w')">
                    <span class="skill-name" id="skill-w-name">Spectral Maw (W)</span>
                    <span class="skill-cost" id="skill-w-cost">40 Dmg | 25 Power</span>
                    <span class="cooldown-text" id="cd-w">Cooldown: 2</span>
                </button>
                <button class="skill-btn ult-btn" id="btn-ult" onclick="useSkill('r')">
                    <span class="skill-name" id="skill-r-name">HEARTBREAKER (R)</span>
                    <span class="skill-cost" id="skill-r-cost">~200 Dmg | SINGLE</span>
                </button>
            </div>
            <div class="log-box" id="combat-log"></div>
        </div>
    </div>

<script>
    const sounds = { basic1: new Audio('BasicAA_1.wav'), basic2: new Audio('BasicAA_2.wav'), w: new Audio('W_Skill.wav'), q: new Audio(), r: new Audio() };
    sounds.basic1.volume = 0.5; sounds.basic2.volume = 0.5; sounds.w.volume = 0.5;
    function playSkillSound(type) { try { if(type==='basic'){if(Math.random()>0.5)sounds.basic1.play();else sounds.basic2.play();} if(type==='w')sounds.w.play(); } catch(e){} }

    const player = { name: "Viego", level: 1, maxHp: 150, hp: 150, maxPower: 100, power: 0, ultUsed: false, critChance: 0.2, nextHitCrit: false, wCooldown: 0 };
    
    let bossState = { isPlayerStunned: false, threshStacks: 0, threshVulnerable: false, belvethForm: 1, mordeRealmTriggered: false, mordeRealmActive: false, turnCount: 0 };
    const musicTracks = { tier1: "Tier1.mp3", tier2: "Tier2.mp3", tier3: "tier3.mp3", morde: "morde.mp3", isolde: "isolde.mp3", thresh: "thresh.mp3" };
    
    const enemiesBase = [
        { id: "gangplank", level: 2, maxHp: 200, hp: 200, damage: 15, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Gangplank_0.jpg" },
        { id: "yorick", level: 4, maxHp: 250, hp: 250, damage: 18, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Yorick_0.jpg" },
        { id: "akshan", level: 6, maxHp: 300, hp: 300, damage: 22, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Akshan_0.jpg" },
        { id: "gwen", level: 8, maxHp: 350, hp: 350, damage: 25, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Gwen_0.jpg" },
        { id: "lucian_senna", level: 10, maxHp: 500, hp: 500, damage: 35, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Lucian_0.jpg" },
        { id: "maokai", level: 12, maxHp: 600, hp: 600, damage: 30, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Maokai_0.jpg" },
        { id: "elise", level: 14, maxHp: 650, hp: 650, damage: 35, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Elise_0.jpg" },
        { id: "vladimir", level: 16, maxHp: 700, hp: 700, damage: 38, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Vladimir_0.jpg" },
        { id: "hecarim", level: 18, maxHp: 750, hp: 750, damage: 42, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Hecarim_0.jpg" },
        { id: "illaoi", level: 20, maxHp: 800, hp: 800, damage: 40, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Illaoi_0.jpg" },
        { id: "kalista", level: 22, maxHp: 850, hp: 850, damage: 45, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Kalista_0.jpg" },
        { id: "ledros", level: 24, maxHp: 950, hp: 950, damage: 50, img: "https://wiki.leagueoflegends.com/en-us/images/01SI033-full.png?b1aad" },
        { id: "leblanc", level: 26, maxHp: 1000, hp: 1000, damage: 60, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Leblanc_0.jpg" },
        { id: "thresh", level: 28, maxHp: 1200, hp: 1200, damage: 65, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Thresh_0.jpg" },
        { id: "belveth", level: 30, maxHp: 1400, hp: 1400, damage: 75, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Belveth_0.jpg" },
        { id: "mordekaiser", level: 35, maxHp: 2000, hp: 2000, damage: 90, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Mordekaiser_0.jpg" }
    ];

    const mechanicsInfo = {
        player: `<span class='info-weak'>Q - Kralƒ±n Kƒ±lƒ±cƒ±:</span> Rakibin canƒ±ndan √ßalar (%7).<br><br><span class='info-weak'>W - Hortlaƒüƒ±n Pen√ßesi:</span> Sonraki saldƒ±rƒ± KRƒ∞Tƒ∞K olur. Thresh gardƒ±nƒ± kƒ±rar!<br><br><span class='info-strong'>R - ULTƒ∞:</span> Eksik cana g√∂re vurur. W+R kombosu kritik vurur!`,
        thresh: `<span class='info-strong'>G√ú√á:</span> Her tur zƒ±rhƒ± ve hasarƒ± artar. Blokladƒ±ƒüƒ± hasarƒ±n %30'u ile iyile≈üir. 12 Stackte STUN atar.<br><br><span class='info-weak'>ZAYIFLIK:</span> Viego'nun W yeteneƒüi gardƒ±nƒ± kƒ±rar (2x Hasar).`,
        leblanc: `<span class='info-strong'>G√ú√á:</span> %40 ≈üansla b√ºy√ºy√º taklit eder (√áift vuru≈ü).<br><br><span class='info-weak'>ZAYIFLIK:</span> Canƒ± azdƒ±r.`,
        belveth: `<span class='info-strong'>G√ú√á:</span> √ñld√ºƒü√ºnde GER√áEK FORMUNA d√∂n√º≈ü√ºr ve canƒ± dolar.<br><br><span class='info-weak'>ZAYIFLIK:</span> ƒ∞lk formu zayƒ±ftƒ±r.`,
        mordekaiser: `<span class='info-strong'>G√ú√á:</span> Canƒ± %35 altƒ±na inince √ñL√úLER ALEMƒ∞NE √ßeker (Statlarƒ± artar).<br><br><span class='info-weak'>ZAYIFLIK:</span> Sadece bir kez olur.`,
        default: `<span class='info-strong'>DURUM:</span> Standart rakip.<br><br><span class='info-weak'>ƒ∞PUCU:</span> Q ile canƒ±nƒ± y√ºksek tut, W+R ile bitir.`
    };

    let currentLang = 'en'; let t = {};
    const translations = {
        en: { title1: "THE RUINED KING'S", title2: "REVENGE", sub: "\"It is all... for her.\"", startBtn: "START STORY", victory: "VICTORY", levelUp: "LEVEL UP!", continue: "CONTINUE", defeat: "DEFEAT...", skillBasic: "Blade of the King", skillQ: "Blade of the Ruined King (Q)", skillQDesc: "7% Enemy HP Steal", skillW: "Spectral Maw (W)", skillR: "HEARTBREAKER (R)", finalChoiceTitle: "MAKE YOUR CHOICE", choiceAttack: "STRIKE HER DOWN", choiceSurrender: "SURRENDER TO LOVE",
            logViegoBasic: "Viego strikes!", logViegoQ: "Viego used Q!", logViegoW: "Viego prepared W!", logViegoR: "VIEGO ULTI!", logCrit: " (CRIT!)", logDamage: " damage.", logEnemyAtk: " attacked! You took ", logNoPower: "Not enough Power!", logCooldown: "Cooldown!", logUltUsed: "Ulti used!", logStart: "Battle Start!",
            bossLogs: { stunned: "YOU ARE STUNNED!", threshStack: "Thresh absorbs souls!", leblancMimic: "LeBlanc MIMICS spell!", belvethTransform: "TRUE FORM REVEALED!", mordeRealm: "DEATH REALM!" },
            isolde: { intro: ["Viego: \"Isolde...\"", "Isolde: \"Let me go...\""], endingAttack: ["Viego: \"If I cannot have you...\"", "System: The End."], endingSurrender: ["Viego: \"I am yours.\"", "*Fade*"] },
            enemies: [
                { id: "gangplank", name: "Gangplank", win: "Viego: \"My city.\"", intro: ["GP: \"Get off my ship!\"", "Viego: \"No.\""], quotes: ["Barrel!"] },
                { id: "yorick", name: "Yorick", win: "Viego: \"Rest.\"", intro: ["Yorick: \"Mist must end.\"", "Viego: \"Never.\""], quotes: ["Dig."] },
                { id: "akshan", name: "Akshan", win: "Viego: \"Revive THIS.\"", intro: ["Akshan: \"Ugly soul.\"", "Viego: \"Annoying.\""], quotes: ["Boom!"] },
                { id: "gwen", name: "Gwen", win: "Viego: \"Doll.\"", intro: ["Gwen: \"She wouldn't want this!\"", "Viego: \"Silence!\""], quotes: ["Snip!"] },
                { id: "lucian_senna", name: "Lucian & Senna", win: "Viego: \"Weak love.\"", intro: ["Lucian: \"Ends here!\"", "Senna: \"It's over.\""], quotes: ["Light!"] },
                { id: "maokai", name: "Maokai", win: "Viego: \"Burn.\"", intro: ["Maokai: \"You poisoned the waters!\"", "Viego: \"I blessed them.\""], quotes: ["Roots."] },
                { id: "elise", name: "Elise", win: "Viego: \"Spider.\"", intro: ["Elise: \"Feed my god.\"", "Viego: \"I am death.\""], quotes: ["Bite."] },
                { id: "vladimir", name: "Vladimir", win: "Viego: \"Uncle.\"", intro: ["Vlad: \"A tragedy.\"", "Viego: \"Don't mock me.\""], quotes: ["Blood."] },
                { id: "hecarim", name: "Hecarim", win: "Viego: \"Serve.\"", intro: ["Hecarim: \"War!\"", "Viego: \"Charge.\""], quotes: ["Trample!"] },
                { id: "illaoi", name: "Illaoi", win: "Viego: \"Motionless.\"", intro: ["Illaoi: \"Move or die.\"", "Viego: \"I am eternal.\""], quotes: ["Smash."] },
                { id: "kalista", name: "Kalista", win: "Viego: \"Traitor.\"", intro: ["Kalista: \"Stop this.\"", "Viego: \"You failed me.\""], quotes: ["Pierce."] },
                { id: "ledros", name: "Ledros", win: "Viego: \"Old friend.\"", intro: ["Ledros: \"I must stop you.\"", "Viego: \"Try.\""], quotes: ["Shield."] },
                { id: "leblanc", name: "LeBlanc", win: "Viego: \"Lies.\"", intro: ["LB: \"Smoke and mirrors.\"", "Viego: \"Truth!\""], quotes: ["Clone."] },
                { id: "thresh", name: "Thresh", win: "Viego: \"Wretch.\"", intro: ["Thresh: \"What delight.\"", "Viego: \"Know your place.\""], quotes: ["Hook."] },
                { id: "belveth", name: "Bel'Veth", win: "Viego: \"Void.\"", intro: ["Bel'Veth: \"I will consume all.\"", "Viego: \"Not her.\""], quotes: ["End."] },
                { id: "mordekaiser", name: "Mordekaiser", win: "Viego: \"Iron fades.\"", intro: ["Morde: \"Iron stands eternal.\"", "Viego: \"Mist is forever.\""], quotes: ["Obliterate."] }
            ]
        },
        tr: { title1: "MAHVOLMU≈û KRAL'IN", title2: "ƒ∞NTƒ∞KAMI", sub: "\"Hepsi... Onun i√ßin.\"", startBtn: "Hƒ∞KAYEYE BA≈ûLA", victory: "ZAFER", levelUp: "SEVƒ∞YE ATLADIN!", continue: "DEVAM ET", defeat: "KAYBETTƒ∞N...", skillBasic: "Kralƒ±n Kƒ±lƒ±cƒ±", skillQ: "M. Kralƒ±n Kƒ±lƒ±cƒ± (Q)", skillQDesc: "%7 Rakip Can √áalma", skillW: "Hortlakƒ±n Pen√ßesi (W)", skillR: "KALP KIRAN (R)", finalChoiceTitle: "SE√áƒ∞Mƒ∞Nƒ∞ YAP", choiceAttack: "ONU √ñLD√úR", choiceSurrender: "TESLƒ∞M OL",
            logViegoBasic: "Viego vurdu!", logViegoQ: "Viego Q kullandƒ±!", logViegoW: "Viego W hazƒ±rladƒ±!", logViegoR: "VIEGO ULTƒ∞ ATTI!", logCrit: " (KRƒ∞Tƒ∞K!)", logDamage: " hasar.", logEnemyAtk: " saldƒ±rdƒ±! Aldƒ±ƒüƒ±n hasar: ", logNoPower: "G√º√ß Yetersiz!", logCooldown: "Bekleme S√ºresi!", logUltUsed: "Ulti kullanƒ±ldƒ±!", logStart: "Sava≈ü Ba≈üladƒ±!",
            bossLogs: { stunned: "SERSEMLEDƒ∞N!", threshStack: "Thresh ruh topladƒ±!", leblancMimic: "LeBlanc TAKLƒ∞T ETTƒ∞!", belvethTransform: "GER√áEK FORM!", mordeRealm: "√ñL√úLER ALEMƒ∞!" },
            isolde: { intro: ["Viego: \"Isolde...\"", "Isolde: \"Bƒ±rak beni...\""], endingAttack: ["Viego: \"Senin olamƒ±yorsam...\"", "Sistem: Son."], endingSurrender: ["Viego: \"Seninim.\"", "*Son*"] },
            enemies: [
                { id: "gangplank", name: "Gangplank", win: "Viego: \"≈ûehrim.\"", intro: ["GP: \"Gemimden in!\"", "Viego: \"Hayƒ±r.\""], quotes: ["Fƒ±√ßƒ±!"] },
                { id: "yorick", name: "Yorick", win: "Viego: \"Uyu.\"", intro: ["Yorick: \"Sis bitmeli.\"", "Viego: \"Asla.\""], quotes: ["Mezar."] },
                { id: "akshan", name: "Akshan", win: "Viego: \"Dirilme.\"", intro: ["Akshan: \"√áirkin ruh.\"", "Viego: \"Sinir bozucusun.\""], quotes: ["Bum!"] },
                { id: "gwen", name: "Gwen", win: "Viego: \"Oyuncak.\"", intro: ["Gwen: \"Bunu istemezdi!\"", "Viego: \"Sus!\""], quotes: ["Kes!"] },
                { id: "lucian_senna", name: "Lucian & Senna", win: "Viego: \"Zayƒ±f.\"", intro: ["Lucian: \"Burada biter!\"", "Senna: \"Bitti.\""], quotes: ["I≈üƒ±k!"] },
                { id: "maokai", name: "Maokai", win: "Viego: \"Yan.\"", intro: ["Maokai: \"Doƒüayƒ± bozdun!\"", "Viego: \"D√ºzelttim.\""], quotes: ["K√∂kler."] },
                { id: "elise", name: "Elise", win: "Viego: \"√ñr√ºmcek.\"", intro: ["Elise: \"Tanrƒ±m a√ß.\"", "Viego: \"Ben √∂l√ºm√ºm.\""], quotes: ["Isƒ±r."] },
                { id: "vladimir", name: "Vladimir", win: "Viego: \"Amca.\"", intro: ["Vlad: \"Trajedi.\"", "Viego: \"Alay etme.\""], quotes: ["Kan."] },
                { id: "hecarim", name: "Hecarim", win: "Viego: \"Hizmet et.\"", intro: ["Hecarim: \"Sava≈ü!\"", "Viego: \"Saldƒ±r.\""], quotes: ["Ez!"] },
                { id: "illaoi", name: "Illaoi", win: "Viego: \"Durgun.\"", intro: ["Illaoi: \"Hareket et.\"", "Viego: \"Sonsuzum.\""], quotes: ["Vur."] },
                { id: "kalista", name: "Kalista", win: "Viego: \"Hain.\"", intro: ["Kalista: \"Dur artƒ±k.\"", "Viego: \"Yemin etmi≈ütin.\""], quotes: ["Mƒ±zrak."] },
                { id: "ledros", name: "Ledros", win: "Viego: \"Dostum.\"", intro: ["Ledros: \"Seni durdurmalƒ±yƒ±m.\"", "Viego: \"Dene.\""], quotes: ["Kalkan."] },
                { id: "leblanc", name: "LeBlanc", win: "Viego: \"Yalanlar.\"", intro: ["LB: \"G√∂z yanƒ±lmasƒ±.\"", "Viego: \"Ger√ßek!\""], quotes: ["Kopya."] },
                { id: "thresh", name: "Thresh", win: "Viego: \"Sefil.\"", intro: ["Thresh: \"Ne keyif.\"", "Viego: \"Yerini bil.\""], quotes: ["Zincir."] },
                { id: "belveth", name: "Bel'Veth", win: "Viego: \"Hi√ßlik.\"", intro: ["Bel'Veth: \"T√ºketeceƒüim.\"", "Viego: \"Onu deƒüil.\""], quotes: ["Son."] },
                { id: "mordekaiser", name: "Mordekaiser", win: "Viego: \"Demir paslanƒ±r.\"", intro: ["Morde: \"Demir ebedidir.\"", "Viego: \"Sis sonsuzdur.\""], quotes: ["Yok ol."] }
            ]
        }
    };

    let currentEnemyIndex = 0; let turn = "player"; const bgMusic = document.getElementById('bgMusic');
    let dialogueIndex = 0; let currentDialogues = []; let enemyTimeout = null; let isIsoldeScene = false; let currentTrack = "";

    function changeMusic(trackName) {
        if (currentTrack === trackName) return; currentTrack = trackName;
        bgMusic.src = musicTracks[trackName]; bgMusic.volume = 0.4;
        bgMusic.play().catch(e => {}); updateMusicBtnText();
    }

    function changeLanguage(lang) {
        currentLang = lang; t = translations[lang];
        document.getElementById('start-title-1').innerText = t.title1; document.getElementById('start-title-2').innerText = t.title2; document.getElementById('start-sub').innerText = t.sub; document.getElementById('start-btn').innerText = t.startBtn; document.getElementById('btn-menu').innerText = "‚Üê Menu";
        document.getElementById('overlay-title').innerText = t.victory; document.getElementById('level-up-text').innerText = t.levelUp; document.getElementById('next-btn').innerText = t.continue;
        document.getElementById('skill-basic-name').innerText = t.skillBasic; document.getElementById('skill-q-name').innerText = t.skillQ; document.getElementById('skill-q-desc').innerText = t.skillQDesc; document.getElementById('skill-w-name').innerText = t.skillW; document.getElementById('skill-r-name').innerText = t.skillR;
        document.getElementById('choice-title').innerText = t.finalChoiceTitle; document.getElementById('btn-choice-attack').innerText = t.choiceAttack; document.getElementById('btn-choice-surrender').innerText = t.choiceSurrender;
        updateMusicBtnText();
        if (!isIsoldeScene) document.getElementById('enemy-name').innerText = enemiesBase[currentEnemyIndex].id.toUpperCase();
    }

    function updateMusicBtnText() { document.getElementById('btn-music').innerText = !bgMusic.paused ? "üéµ Music: ON" : "üéµ Music: OFF"; }
    function forcePlayMusic() { bgMusic.volume = 0.4; bgMusic.play().then(_ => updateMusicBtnText()).catch(e => {}); }
    function toggleMusic() { if(bgMusic.paused) bgMusic.play(); else bgMusic.pause(); updateMusicBtnText(); }

    function showInfo(target) {
        const modal = document.getElementById('info-modal'); const content = document.getElementById('info-content');
        modal.style.display = 'block';
        if (target === 'player') { document.getElementById('info-title').innerText = "VIEGO"; content.innerHTML = mechanicsInfo.player; } 
        else { const id = enemiesBase[currentEnemyIndex].id; document.getElementById('info-title').innerText = id.toUpperCase(); content.innerHTML = mechanicsInfo[id] || mechanicsInfo.default; }
    }
    function closeInfo() { document.getElementById('info-modal').style.display = 'none'; }

    function startGame() { document.getElementById('start-screen').style.display = 'none'; forcePlayMusic(); loadLevel(0); }

    function loadLevel(index) {
        if (enemyTimeout) clearTimeout(enemyTimeout);
        if (index >= enemiesBase.length) { startIsoldeScene(); return; }
        
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('final-choice-overlay').style.display = 'none';
        
        currentEnemyIndex = index;
        const enemyData = enemiesBase[index];
        const enemyTrans = t.enemies[index];
        
        if (enemyData.id === 'mordekaiser') changeMusic('morde'); else if (enemyData.id === 'thresh') changeMusic('thresh'); else if (index < 5) changeMusic('tier1'); else if (index < 12) changeMusic('tier2'); else changeMusic('tier3');

        document.getElementById('enemy-name').innerText = enemyData.id.toUpperCase();
        document.getElementById('enemy-img').src = enemyData.img;
        document.getElementById('enemy-lvl').innerText = enemyData.level;
        enemyData.hp = enemyData.maxHp; 
        
        bossState = { isPlayerStunned: false, threshStacks: 0, threshVulnerable: false, belvethForm: 1, mordeRealmTriggered: false, mordeRealmActive: false, turnCount: 0 };
        document.body.classList.remove('death-realm-active'); 

        if(enemyData.id === 'belveth') document.getElementById('enemy-img').src = "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Belveth_0.jpg";

        player.ultUsed = false; player.power = 0; player.wCooldown = 0; player.nextHitCrit = false;
        turn = "player"; toggleBattleUI(false); 
        
        startPreFightDialogue(enemyTrans);
    }

    function startIsoldeScene() {
        isIsoldeScene = true; changeMusic('isolde');
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('enemy-name').innerText = "ISOLDE";
        document.getElementById('enemy-img').src = "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Gwen_1.jpg"; 
        document.getElementById('enemy-lvl').innerText = "‚àû";
        toggleBattleUI(false); currentDialogues = t.isolde.intro; dialogueIndex = 0;
        document.getElementById('cinematic-dialogue').style.display = 'flex'; updateDialogueText();
    }

    function startPreFightDialogue(enemyTrans) {
        currentDialogues = enemyTrans.intro;
        dialogueIndex = 0; 
        document.getElementById('cinematic-dialogue').style.display = 'flex'; 
        updateDialogueText();
    }

    function updateDialogueText() {
        if(dialogueIndex < currentDialogues.length) { document.getElementById('cinematic-text').innerText = currentDialogues[dialogueIndex]; } else { endDialogue(); }
    }
    function nextDialogue() { dialogueIndex++; updateDialogueText(); }
    
    function endDialogue() {
        document.getElementById('cinematic-dialogue').style.display = 'none';
        if (isIsoldeScene) { document.getElementById('final-choice-overlay').style.display = 'flex'; } else { toggleBattleUI(true); updateUI(); log(t.logStart); }
    }

    function makeFinalChoice(choice) {
        document.getElementById('final-choice-overlay').style.display = 'none';
        currentDialogues = choice === 'attack' ? t.isolde.endingAttack : t.isolde.endingSurrender;
        dialogueIndex = 0; isIsoldeScene = false; document.getElementById('cinematic-dialogue').style.display = 'flex';
        window.nextDialogue = function() { dialogueIndex++; if (dialogueIndex < currentDialogues.length) document.getElementById('cinematic-text').innerText = currentDialogues[dialogueIndex]; else location.reload(); };
        updateDialogueText();
    }

    function toggleBattleUI(show) {
        const elements = [document.getElementById('combat-controls'), document.getElementById('ui-hp-p'), document.getElementById('ui-mp-p'), document.getElementById('ui-hp-e')];
        elements.forEach(el => { if(show) el.classList.remove('hidden-ui'); else el.classList.add('hidden-ui'); });
    }

    function triggerBanter(isPlayerTurn) {
        if (Math.random() > 0.3) return;
        if (isPlayerTurn) { const quotes = t.playerQuotes; showSpeech('player', quotes[Math.floor(Math.random() * quotes.length)]); } 
        else { const quotes = t.enemies[currentEnemyIndex].quotes; showSpeech('enemy', quotes[Math.floor(Math.random() * quotes.length)]); }
    }

    function showSpeech(who, text) { const bubble = document.getElementById(who + '-bubble'); bubble.innerText = text; bubble.classList.add('speech-visible'); }
    function clearBubbles() { document.getElementById('player-bubble').classList.remove('speech-visible'); document.getElementById('enemy-bubble').classList.remove('speech-visible'); }

    // --- OYUNCU HAMLESƒ∞ ---
    function useSkill(type) {
        if (turn !== "player") return;
        if (bossState.isPlayerStunned) { log(t.bossLogs.stunned); bossState.isPlayerStunned = false; turn = "enemy"; setTimeout(enemyTurn, 1000); return; }

        clearBubbles(); triggerBanter(true);
        const enemyData = enemiesBase[currentEnemyIndex];
        let damage = 0; let logMsg = ""; let isCrit = false;
        if (player.nextHitCrit) { isCrit = true; player.nextHitCrit = false; } else { if (Math.random() < player.critChance) isCrit = true; }

        if (type === 'basic') { playSkillSound('basic'); damage = 15 + (player.level * 5); player.power += (isCrit ? 15 : 10); logMsg = t.logViegoBasic; } 
        else if (type === 'q') { if (player.power < 15) { log(t.logNoPower); return; } playSkillSound('q'); player.power -= 15; damage = 30 + (player.level * 8); logMsg = t.logViegoQ; let heal = Math.floor(enemyData.hp * 0.07); if(heal < 5) heal = 5; player.hp += heal; if(player.hp > player.maxHp) player.hp = player.maxHp; showFloatingText(document.getElementById('player-box'), `+${heal}`, 'heal'); }
        else if (type === 'w') { 
            if (player.wCooldown > 0 || player.power < 25) { log(t.logCooldown); return; } playSkillSound('w'); player.power -= 25; damage = 40 + (player.level * 6); if(damage>80) damage=80; player.nextHitCrit = true; player.wCooldown = 3; logMsg = t.logViegoW;
            if(enemyData.id === 'thresh') { bossState.threshVulnerable = true; showFloatingText(document.getElementById('enemy-box'), "GUARD BROKEN!", "text-weakness"); }
        }
        else if (type === 'r') { if (player.ultUsed) { log(t.logUltUsed); return; } playSkillSound('r'); player.ultUsed = true; damage = 60 + (player.level * 9) + Math.floor((enemyData.maxHp - enemyData.hp) * 0.12); triggerEffect('ult'); logMsg = t.logViegoR; }

        if (isCrit && type !== 'w') { damage = type === 'q' ? Math.floor(damage * 1.75) : damage * 2; logMsg += t.logCrit; }
        if (player.power > player.maxPower) player.power = player.maxPower;

        // BOSS DEFENSE
        if (enemyData.id === 'thresh') { 
            let reduction = 20 + (bossState.threshStacks * 4);
            if(bossState.threshVulnerable && damage > 0) { damage *= 2; showFloatingText(document.getElementById('enemy-box'), "CRITICAL BREAK!", "text-weakness"); bossState.threshVulnerable = false; }
            let blocked = Math.min(damage, reduction);
            if(damage < reduction) damage = 0; else damage -= reduction;
            if(blocked > 0) { let heal = Math.floor(blocked * 0.3); enemyData.hp += heal; if(enemyData.hp > enemyData.maxHp) enemyData.hp = enemyData.maxHp; showFloatingText(document.getElementById('enemy-box'), `+${heal}`, 'heal'); }
        }
        if (enemyData.id === 'mordekaiser' && bossState.mordeRealmActive) damage = Math.floor(damage * 0.7);

        enemyData.hp -= damage;
        
        if (enemyData.id === 'belveth' && enemyData.hp <= 0 && bossState.belvethForm === 1) {
            enemyData.hp = 1200; bossState.belvethForm = 2; document.getElementById('enemy-img').src = "belveth2form.jpg"; 
            log(t.bossLogs.belvethTransform); triggerEffect('void'); showFloatingText(document.getElementById('enemy-box'), "TRANSFORM!", "damage"); updateUI(); return; 
        }
        if (enemyData.id === 'mordekaiser' && !bossState.mordeRealmTriggered && (enemyData.hp / enemyData.maxHp) <= 0.35) {
            bossState.mordeRealmTriggered = true; bossState.mordeRealmActive = true; document.body.classList.add('death-realm-active');
            let missing = enemyData.maxHp - enemyData.hp; enemyData.hp += Math.floor(missing * 0.05); enemyData.maxHp = Math.floor(enemyData.maxHp * 1.25); enemyData.hp = Math.floor(enemyData.hp * 1.25);
            log(t.bossLogs.mordeRealm); showFloatingText(document.getElementById('enemy-box'), "DEATH REALM!", "text-special");
        }

        if (enemyData.hp < 0) enemyData.hp = 0;
        shakeElement(document.getElementById('enemy-img')); showFloatingText(document.getElementById('enemy-box'), damage, isCrit ? 'crit' : 'normal'); log(`${logMsg} ${damage} ${t.logDamage}`); updateUI();

        if (enemyData.hp <= 0) { winBattle(); return; }
        turn = "enemy"; enemyTimeout = setTimeout(enemyTurn, 1500);
    }

    function enemyTurn() {
        clearBubbles(); triggerBanter(false);
        const enemyData = enemiesBase[currentEnemyIndex];
        const enemyTrans = t.enemies[currentEnemyIndex];
        let dmg = enemyData.damage + Math.floor(Math.random() * 10);
        bossState.turnCount++;

        if (enemyData.id === 'leblanc' && Math.random() < 0.4) { log(t.bossLogs.leblancMimic); dmg = Math.floor(dmg * 2.2); showFloatingText(document.getElementById('enemy-box'), "MIMIC!", "text-special"); }
        if (enemyData.id === 'thresh') { 
            bossState.threshStacks += 3; dmg += (bossState.threshStacks * 2);
            if (bossState.threshStacks % 12 === 0) { bossState.isPlayerStunned = true; triggerEffect('stun'); showFloatingText(document.getElementById('player-box'), "STUNNED", "text-special"); } 
        }
        if (enemyData.id === 'belveth') { dmg += 10 * bossState.belvethForm; }
        if (enemyData.id === 'mordekaiser' && bossState.mordeRealmActive) { dmg = Math.floor(dmg * 1.3); let ls = Math.floor(dmg * 0.75); enemyData.hp += ls; if(enemyData.hp > enemyData.maxHp) enemyData.hp = enemyData.maxHp; showFloatingText(document.getElementById('enemy-box'), `+${ls}`, 'heal'); }

        player.hp -= dmg; if (player.hp < 0) player.hp = 0;
        if (player.wCooldown > 0) player.wCooldown--;
        triggerEffect('damage'); shakeElement(document.getElementById('player-img')); showFloatingText(document.getElementById('player-box'), `-${dmg}`, 'damage'); updateUI();
        log(`${enemyTrans.name} ${t.logEnemyAtk} ${dmg}.`);
        if (player.hp <= 0) { log(t.logDefeat); setTimeout(() => { alert("DEFEAT"); location.reload(); }, 1000); return; }
        turn = "player";
    }

    function winBattle() {
        if (enemyTimeout) clearTimeout(enemyTimeout);
        const enemyTrans = t.enemies[currentEnemyIndex];
        document.getElementById('overlay-title').innerText = t.victory;
        document.getElementById('overlay-quote').innerText = enemyTrans.win; // Zafer s√∂z√º artƒ±k buradan √ßekiliyor
        player.level++; player.maxHp += 50; player.hp = player.maxHp; 
        document.getElementById('level-up-text').style.display = 'block';
        document.getElementById('overlay').style.display = 'flex';
    }

    function nextLevel() { document.getElementById('overlay').style.display = 'none'; currentEnemyIndex++; loadLevel(currentEnemyIndex); }

    function updateUI() {
        const enemyData = enemiesBase[currentEnemyIndex];
        document.getElementById('player-hp-bar').style.width = (player.hp / player.maxHp) * 100 + '%';
        document.getElementById('player-hp-text').innerText = `${Math.floor(player.hp)}/${player.maxHp}`;
        document.getElementById('player-power-bar').style.width = (player.power / player.maxPower) * 100 + '%';
        document.getElementById('player-power-text').innerText = `${player.power}/${player.maxPower}`;
        document.getElementById('player-lvl').innerText = player.level;
        document.getElementById('enemy-hp-bar').style.width = (enemyData.hp / enemyData.maxHp) * 100 + '%';
        document.getElementById('enemy-hp-text').innerText = `${Math.floor(enemyData.hp)}/${enemyData.maxHp}`;
        
        let status = ""; if(enemyData.id==='thresh') status=`Souls: ${bossState.threshStacks}`; else if(enemyData.id==='belveth') status=`Form: ${bossState.belvethForm}`; else if(enemyData.id==='mordekaiser') status=bossState.mordeRealmActive?"DEATH REALM":"Iron";
        document.getElementById('boss-status').innerText = status;

        document.getElementById('btn-q').disabled = player.power < 15;
        document.getElementById('btn-w').disabled = (player.power < 25 || player.wCooldown > 0);
        document.getElementById('btn-ult').disabled = player.ultUsed;
        
        let bDmg = 15+(player.level*5); document.getElementById('skill-basic-cost').innerText = `~${bDmg} Dmg | +Power`;
        let qDmg = 30+(player.level*8); document.getElementById('skill-q-cost').innerText = `~${qDmg} Dmg | 15 Pwr`;
        let wDmg = Math.min(40+(player.level*6), 80); document.getElementById('skill-w-cost').innerText = `~${wDmg} Dmg | 25 Pwr`;
        let rDmg = 60+(player.level*9)+Math.floor((enemyData.maxHp-enemyData.hp)*0.12); document.getElementById('skill-r-cost').innerText = `~${rDmg} Dmg | 1 Use`;
    }

    function log(msg) { const box = document.getElementById('combat-log'); box.innerHTML = `> ${msg}<br>` + box.innerHTML; }
    function shakeElement(el) { el.classList.remove('shake'); void el.offsetWidth; el.classList.add('shake'); }
    function triggerEffect(type) { const flash = document.getElementById('flash-effect'); flash.className = ''; if (type === 'damage') flash.classList.add('damage-flash'); if (type === 'ult') flash.classList.add('ult-flash'); if (type === 'stun') flash.classList.add('stun-flash'); if (type === 'void') flash.classList.add('void-flash'); setTimeout(() => flash.className = '', 500); }
    function showFloatingText(target, val, type) { const text = document.createElement('div'); text.className = 'float-text ' + (type === 'crit' ? 'text-crit' : (type === 'heal' ? 'text-heal' : (type === 'damage' ? 'text-enemy-dmg' : (type === 'text-special' ? 'text-special' : (type === 'text-weakness' ? 'text-weakness' : 'text-damage'))))); text.innerText = type === 'crit' ? val + "!" : val; const rect = target.getBoundingClientRect(); text.style.left = (rect.left + rect.width / 2) + 'px'; text.style.top = rect.top + 'px'; document.body.appendChild(text); setTimeout(() => text.remove(), 1200); }

    window.onload = function() {
        const savedLang = localStorage.getItem('rpgLang') || 'en';
        document.getElementById('lang-select').value = savedLang;
        changeLanguage(savedLang);
    };
</script>

</body>
</html>
