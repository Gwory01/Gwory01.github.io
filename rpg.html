<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Viego: The Ruined King RPG</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

        :root {
            --ruined-green: #0ac8b9;
            --dark-bg: #05080a;
            --panel-bg: rgba(16, 20, 24, 0.95);
            --border-color: #4a5a6a;
            --gold-border: #c8aa6e;
            --power-yellow: #f1c40f;
            --hp-red: #c0392b;
            --crit-color: #ffcc00;
            --heal-color: #2ecc71;
            --gold-color: #f39c12;
            --sell-color: #e74c3c;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--dark-bg);
            /* G√ñRSEL G√úNCELLEMESƒ∞: Yerel dosya */
            background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.8)), url('Viego.jpg');
            background-size: cover; 
            background-position: center; 
            background-attachment: fixed; 
            color: #e0e0e0; font-family: 'Cinzel', serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            width: 100vw; height: 100dvh;
            margin: 0; padding: 0;
            overflow: hidden; 
            user-select: none;
            position: relative;
        }
        body.death-realm-active { filter: grayscale(100%) sepia(30%) hue-rotate(90deg) contrast(1.1); box-shadow: inset 0 0 150px #0ac8b9; }

        /* --- UI STYLES --- */
        .game-wrapper { 
            width: 98%; height: 95%; max-width: 1100px;
            background: var(--panel-bg); 
            border: 2px solid var(--border-color);
            border-radius: 4px;
            box-shadow: 0 0 50px rgba(0,0,0,0.8), inset 0 0 100px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; 
            position: relative; z-index: 10;
            padding: 5px;
        }
        .game-wrapper::before { content: ""; position: absolute; top: -2px; left: -2px; width: 20px; height: 20px; border-top: 2px solid var(--gold-border); border-left: 2px solid var(--gold-border); z-index: 11; }
        .game-wrapper::after { content: ""; position: absolute; bottom: -2px; right: -2px; width: 20px; height: 20px; border-bottom: 2px solid var(--gold-border); border-right: 2px solid var(--gold-border); z-index: 11; }

        .info-btn { 
            position: absolute; top: 10px; left: 10px; 
            width: 24px; height: 24px; 
            background: #111; border: 1px solid var(--gold-border); 
            color: var(--gold-border); border-radius: 50%; 
            font-weight: bold; cursor: help; z-index: 50; 
            display: flex; justify-content: center; align-items: center; font-size: 14px;
            transition: all 0.2s;
        }
        .info-btn:hover { background: var(--gold-border); color: #000; box-shadow: 0 0 10px var(--gold-border); }

        .top-bar-controls { 
            position: absolute; top: 15px; right: 20px; z-index: 100;
            display: flex; gap: 10px; align-items: center; 
        }
        .control-btn-ui { 
            background: linear-gradient(to bottom, #333, #111); 
            color: #ddd; border: 1px solid #555; 
            padding: 8px 15px; border-radius: 2px; font-size: 12px; cursor: pointer; 
            font-family: 'Cinzel', serif; letter-spacing: 1px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        .control-btn-ui:hover { border-color: var(--ruined-green); color: var(--ruined-green); }
        .back-btn { position: absolute; top: 15px; left: 20px; z-index: 100; color: #aaa; text-decoration: none; border: 1px solid #444; padding: 6px 12px; background: rgba(0,0,0,0.8); font-size: 12px; font-family: 'Roboto'; }

        /* BATTLE SCENE */
        .battle-scene { 
            flex-grow: 1; display: flex; 
            justify-content: space-around; align-items: center; 
            position: relative; width: 100%; 
            padding: 20px;
        }
        .character-box { 
            width: 40%; max-width: 320px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #444;
            padding: 15px;
            border-radius: 4px;
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            transition: border-color 0.3s;
        }
        .character-box:hover { border-color: var(--ruined-green); }
        .character-img { 
            width: 140px; height: 140px; 
            object-fit: cover; object-position: center top; 
            border-radius: 50%; border: 3px solid #333; 
            box-shadow: 0 0 15px rgba(0,0,0,0.8); 
            transition: all 0.2s; margin-bottom: 10px;
        }
        .viego-glow { border-color: var(--ruined-green); }
        .enemy-glow { border-color: #d63031; }
        .character-box h2 { 
            font-size: 1.1rem; margin: 5px 0; 
            color: #fff; text-shadow: 0 2px 4px #000; 
            letter-spacing: 2px; border-bottom: 1px solid #444; padding-bottom: 5px; width: 100%; text-align: center;
        }
        .stat-bar { 
            width: 100%; height: 12px; 
            background: #111; margin-top: 6px; 
            border: 1px solid #333; position: relative; 
            border-radius: 2px; 
        }
        .fill { height: 100%; transition: width 0.4s ease-out; } 
        .hp-fill { background: linear-gradient(to right, #900, #c0392b); } 
        .power-fill { background: linear-gradient(to right, #b7950b, #f1c40f); box-shadow: 0 0 5px #f1c40f; }
        .bar-text { 
            font-size: 10px; font-weight: bold; 
            position: absolute; top: -1px; left: 50%; transform: translateX(-50%); 
            color: #fff; text-shadow: 1px 1px 2px black; line-height: 12px; letter-spacing: 1px;
        }
        #vs-text { font-size: 2rem; color: #444; font-weight: bold; font-style: italic; opacity: 0.5; }

        /* CONTROLS */
        .controls { 
            background: rgba(10, 12, 15, 0.9); 
            border-top: 3px double var(--border-color); 
            padding: 15px; 
            display: grid; grid-template-columns: 3fr 2fr; gap: 15px;
            height: 220px; 
        }
        .hidden-ui { opacity: 0; pointer-events: none; }
        .skills { display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 10px; }
        .skill-btn { 
            background: linear-gradient(to bottom, #2c3e50, #1a252f); 
            border: 1px solid #444; color: #ccc; 
            font-family: 'Cinzel'; padding: 5px; border-radius: 2px; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            transition: 0.2s; position: relative;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        .skill-btn:hover:not(:disabled) { border-color: var(--ruined-green); color: #fff; background: linear-gradient(to bottom, #34495e, #2c3e50); }
        .skill-btn:active { transform: translateY(2px); }
        .skill-btn:disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(100%); background: #111; border-color: #222; }
        .skill-name { font-weight: bold; font-size: 0.8rem; margin-bottom: 4px; text-shadow: 1px 1px 0 #000; }
        .skill-cost { font-size: 0.65rem; color: #aaa; font-family: 'Roboto', sans-serif; }
        .skill-btn:hover .skill-cost { color: var(--ruined-green); }
        .ult-btn { border-color: #2ecc71; }
        .ult-btn:hover:not(:disabled) { border-color: #2ecc71; background: linear-gradient(to bottom, #0d3822, #082015); }

        .log-box { 
            height: 100%; background: rgba(0, 0, 0, 0.6); 
            border: 1px solid #444; border-radius: 2px;
            padding: 10px; font-size: 0.85rem; color: #ccc; 
            font-family: 'Roboto', sans-serif; overflow-y: auto; 
            display: flex; flex-direction: column-reverse; 
            line-height: 1.6; box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
        }
        .log-entry { border-bottom: 1px solid #222; padding: 2px 0; }

        /* INVENTORY */
        #inventory-frame { 
            position: absolute; top: 70px; left: 20px; z-index: 20; 
            display: flex; flex-direction: column; gap: 15px; 
            background: rgba(0,0,0,0.5); padding: 10px; border-radius: 4px; border: 1px solid #333;
        }
        .inv-slot { 
            width: 45px; height: 45px; background: #151515; border: 1px solid #444; 
            border-radius: 4px; position: relative; cursor: pointer; 
            display: flex; justify-content: center; align-items: center; font-size: 22px; 
            transition: 0.2s;
        }
        .inv-slot:hover { border-color: var(--power-yellow); background: #222; transform: scale(1.05); }
        .inv-count { 
            position: absolute; bottom: -5px; right: -5px; 
            font-size: 11px; background: #333; color: #fff; 
            padding: 1px 4px; border-radius: 2px; border: 1px solid #555; font-family: 'Roboto';
        }

        /* MODALS */
        #start-screen, #cinematic-dialogue, #overlay, #final-choice-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 200; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; }
        #overlay, #final-choice-overlay, #cinematic-dialogue { display: none; }
        .dialogue-box { background: #111; border: 2px solid var(--ruined-green); padding: 20px; width: 95%; max-width: 600px; border-radius: 8px; box-shadow: 0 0 30px rgba(10, 200, 185, 0.2); }
        #cinematic-text { font-size: 1.1rem; line-height: 1.6; color: #e0e0e0; margin-bottom: 20px; font-style: italic; min-height: 50px; font-family: 'Roboto', sans-serif; }
        .start-btn { background: transparent; border: 2px solid var(--ruined-green); color: var(--ruined-green); padding: 15px 50px; font-family: 'Cinzel'; font-size: 1.2rem; cursor: pointer; margin-top: 20px; transition: 0.3s; letter-spacing: 2px; }
        .start-btn:hover { background: var(--ruined-green); color: black; box-shadow: 0 0 20px var(--ruined-green); }

        /* SHOP & SETTINGS */
        #shop-modal, #settings-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 3000; display: none; flex-direction: column; padding: 20px; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .shop-content, .settings-content { width: 90%; max-width: 500px; background: #151515; border: 2px solid var(--border-color); padding: 25px; border-radius: 4px; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        .shop-grid { display: grid; grid-template-columns: 1fr; gap: 10px; max-height: 50vh; overflow-y: auto; margin-top: 20px; }
        .shop-item { background: #0a0a0a; border: 1px solid #333; padding: 12px; display: flex; justify-content: space-between; align-items: center; }
        .buy-btn { background: #222; color: var(--gold-color); border: 1px solid var(--gold-color); padding: 5px 10px; font-size: 12px; cursor: pointer; font-family: 'Cinzel'; }
        .buy-btn:hover { background: var(--gold-color); color: #000; }
        .setting-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; color: white; font-family: 'Cinzel'; }
        input[type=range] { width: 60%; cursor: pointer; accent-color: var(--ruined-green); }

        /* WARNING */
        .shop-warning {
            position: absolute; color: #e74c3c; font-size: 12px; font-weight: bold;
            text-align: center; pointer-events: none; z-index: 4000;
            transition: all 0.4s ease-out; text-shadow: 1px 1px 0 #000; opacity: 1;
        }

        /* TOOLTIP & FLOAT */
        #inv-tooltip { 
            position: absolute; background: rgba(15, 20, 25, 0.98); 
            border: 1px solid var(--gold-border); padding: 15px; 
            font-size: 13px; z-index: 5000; pointer-events: none; 
            display: none; width: 250px; text-align: left; 
            font-family: 'Roboto'; color: #ccc; border-radius: 4px; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.8); 
        }
        .tooltip-title { color: var(--gold-border); font-weight: bold; border-bottom: 1px solid #444; margin-bottom: 8px; padding-bottom: 5px; font-size: 15px; font-family: 'Cinzel'; letter-spacing: 1px; }
        .float-text { position: absolute; font-weight: bold; font-size: 22px; animation: floatUp 1.2s ease-out forwards; text-shadow: 2px 2px 0 #000; z-index: 100; pointer-events: none; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-70px); } }
        .text-damage { color: #e74c3c; } .text-heal { color: #2ecc71; } .text-crit { color: #ffcc00; font-size: 30px; } .text-mana { color: #f1c40f; font-size: 18px; } .text-special { color: #a020f0; font-size: 24px; }
        .attacking { animation: bump 0.15s; } @keyframes bump { 50% { transform: scale(1.05); } }
        .damaged { animation: shake 0.4s; } @keyframes shake { 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        body.void-active { filter: hue-rotate(270deg) contrast(1.1); }
        
        /* MOBƒ∞L ƒ∞√áƒ∞N √ñZEL D√úZELTMELER */
        @media screen and (max-width: 768px) {
            body { 
                background-attachment: scroll; 
                background-position: center top; 
            }
            .game-wrapper { width: 100%; height: 100%; border: none; }
            .battle-scene { flex-direction: column-reverse; gap: 15px; padding: 10px; }
            .character-box { width: 95%; padding: 10px; }
            #enemy-box { justify-content: flex-end; }
            #player-box { justify-content: flex-start; }
            .controls { display: flex; flex-direction: column; height: auto; min-height: 250px; }
            .skills { grid-template-columns: 1fr 1fr; height: 160px; }
            .log-box { height: 80px; }
            #vs-text { display: none; }
            .character-img { width: 100px; height: 100px; }
        }
    </style>
</head>
<body>

    <a href="index.html" class="back-btn" id="ui-menu">‚Üê Menu</a>
    
    <div id="inventory-frame">
        <div class="inv-slot" onclick="useInventoryItem('potion')" onmouseover="showTooltip(this, 'potion')" onmouseout="hideTooltip()">
            üß™ <span class="inv-count" id="count-potion">0</span>
        </div>
        <div class="inv-slot" onclick="useInventoryItem('elixir')" onmouseover="showTooltip(this, 'elixir')" onmouseout="hideTooltip()">
            ‚ö° <span class="inv-count" id="count-elixir">0</span>
        </div>
    </div>

    <div class="top-bar-controls">
        <button class="control-btn-ui" onclick="openSettings()">‚öôÔ∏è</button>
        <button class="control-btn-ui" id="btn-open-shop" onclick="openShop()">üõí SHOP</button>
        <select class="control-btn-ui" id="lang-select" onchange="changeLanguage(this.value)">
            <option value="en">English</option>
            <option value="tr">T√ºrk√ße</option>
        </select>
    </div>

    <div id="inv-tooltip"></div>

    <audio id="bgMusic" loop></audio>

    <div id="settings-modal">
        <div class="settings-content">
            <h2 style="color:var(--ruined-green); text-align:center; border-bottom:1px solid #444;" id="ui-settings-title">SETTINGS</h2>
            <div class="setting-row"><span id="ui-music-vol">Music Volume</span><input type="range" id="vol-music" min="0" max="1" step="0.1" oninput="updateVolume('music', this.value)"></div>
            <div class="setting-row"><span id="ui-sfx-vol">SFX Volume</span><input type="range" id="vol-sfx" min="0" max="1" step="0.1" oninput="updateVolume('sfx', this.value)"></div>
            <button class="start-btn" style="width:100%; padding: 10px;" onclick="closeSettings()" id="ui-settings-close">CLOSE</button>
        </div>
    </div>

    <div id="shop-modal">
        <div class="shop-content">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #444; padding-bottom: 10px;">
                <h2 style="color:var(--gold-color); margin:0;" id="ui-shop-title">SHOP</h2>
                <span id="shop-gold" style="color:white; font-weight:bold;">0 G</span>
            </div>
            <div style="text-align:right; margin:10px 0;"><button id="sell-mode-btn" class="control-btn-ui" onclick="toggleSellMode()">SELL: OFF</button></div>
            <div class="shop-grid" id="shop-container"></div>
            <button class="start-btn" id="ui-shop-close" style="padding:10px; width:100%; margin-top:10px;" onclick="closeShop()">CLOSE</button>
        </div>
    </div>

    <div class="game-wrapper">
        <div id="start-screen">
            <h1 style="color:white; margin-bottom:5px; font-size: 3rem; text-shadow: 0 0 20px #000;" id="ui-title">THE RUINED KING</h1>
            <p style="color:#aaa; font-style:italic; font-size: 1.2rem;" id="ui-subtitle">"She is waiting..."</p>
            <button class="start-btn" id="ui-start-btn" onclick="initGame()">START JOURNEY</button>
        </div>

        <div id="cinematic-dialogue">
            <div class="dialogue-box">
                <div id="cinematic-text">...</div>
                <button class="start-btn" id="ui-next-btn" onclick="nextDialogue()">NEXT</button>
            </div>
        </div>

        <div id="final-choice-overlay" style="display:none;">
            <h2 style="color:#fff; font-size: 2.5rem;">ISOLDE</h2>
            <p id="isolde-text" style="color:#aaa; font-style:italic; font-size: 1.2rem; margin-bottom: 30px;">"My love... let me go."</p>
            <button class="choice-btn btn-attack" onclick="makeChoice('attack')">STRIKE HER DOWN</button>
            <button class="choice-btn btn-surrender" onclick="makeChoice('surrender')">SURRENDER TO LOVE</button>
        </div>

        <div id="overlay">
            <h2 style="color:var(--ruined-green); font-size:3rem; text-shadow: 0 0 20px var(--ruined-green);" id="ui-victory">VICTORY</h2>
            <button class="start-btn" id="ui-continue-btn" onclick="nextLevel()">CONTINUE</button>
        </div>

        <div class="battle-scene">
            <div class="character-box" id="player-box">
                <div class="info-btn" onmouseover="showCharacterTooltip(this, 'player')" onmouseout="hideTooltip()">?</div>
                <img src="Viego.jpg" class="character-img viego-glow">
                <h2>VIEGO</h2>
                <div class="stat-bar"><div class="fill hp-fill" id="player-hp-bar" style="width: 100%;"></div><span class="bar-text" id="player-hp-text">150/150</span></div>
                <div class="stat-bar" style="margin-top:2px; border-color:var(--power-yellow);"><div class="fill power-fill" id="player-power-bar" style="width: 0%;"></div><span class="bar-text" id="player-power-text" style="color:var(--power-yellow); top:-2px;">0/100</span></div>
            </div>

            <div id="vs-text">VS</div>

            <div class="character-box" id="enemy-box">
                <div class="info-btn" onmouseover="showCharacterTooltip(this, 'enemy')" onmouseout="hideTooltip()">?</div>
                <img src="" class="character-img enemy-glow" id="enemy-img">
                <h2 id="enemy-name">ENEMY</h2>
                <div class="stat-bar"><div class="fill hp-fill" id="enemy-hp-bar" style="width: 100%;"></div><span class="bar-text" id="enemy-hp-text">100/100</span></div>
                <div class="stat-bar" style="margin-top:2px; border-color:var(--power-yellow);"><div class="fill power-fill" id="enemy-power-bar" style="width: 0%;"></div></div>
            </div>
        </div>

        <div class="controls hidden-ui" id="combat-controls">
            <div class="skills">
                <button class="skill-btn" id="btn-basic" onclick="useSkill('basic')">
                    <span class="skill-name" id="skill-name-basic">Blade</span><span class="skill-cost" id="skill-desc-basic">Basic Dmg</span>
                </button>
                <button class="skill-btn" id="btn-q" onclick="useSkill('q')">
                    <span class="skill-name" id="skill-name-q">Ruined King (Q)</span><span class="skill-cost" id="skill-desc-q">30 Dmg | 20 MP</span>
                </button>
                <button class="skill-btn" id="btn-w" onclick="useSkill('w')">
                    <span class="skill-name" id="skill-name-w">Spectral Maw (W)</span><span class="skill-cost" id="skill-desc-w">Stun/Crit | 30 MP</span>
                </button>
                <button class="skill-btn ult-btn" id="btn-r" onclick="useSkill('r')">
                    <span class="skill-name" id="skill-name-r">HEARTBREAKER</span><span class="skill-cost" id="skill-desc-r">FINISHER | 1/Round</span>
                </button>
            </div>
            <div class="log-box" id="combat-log">
                <div class="log-entry">Waiting for battle...</div>
            </div>
        </div>
    </div>

<script>
    const sounds = { basic1: new Audio('BasicAA_1.wav'), basic2: new Audio('BasicAA_2.wav'), w_skill: new Audio('W_skill.wav') };
    let gameSettings = { musicVolume: 0.3, sfxVolume: 0.5, lang: 'en' };
    let player = { hp: 150, maxHp: 150, baseDamage: 0, lifesteal: 0, power: 0, maxPower: 100, potions: 0, elixirs: 0, gold: 0, level: 1, ultUsed: false, stunned: false, items: [] };
    let currentEnemyIndex = 0;
    let turn = "player";
    let dialogueQueue = [];
    let dialogueIndex = 0;
    let isSellMode = false;
    let mordeRealmActive = false;

    // --- E≈ûYA VE D√ú≈ûMAN VERƒ∞LERƒ∞ (G√∂rseller Yerel Dosyalarla G√ºncellendi) ---
    const gameItems = {
        long_sword: { cost: 150, dmg: 10, hp: 0, lifesteal: 0, icon: "‚öîÔ∏è" },
        ruby_crystal: { cost: 150, dmg: 0, hp: 50, lifesteal: 0, icon: "üíé" },
        vampiric_scepter: { cost: 350, dmg: 15, hp: 0, lifesteal: 0.15, icon: "ü©∏" }
    };

    const enemiesData = [
        { id: "gangplank", level: 3, hp: 200, maxHp: 200, power: 0, maxPower: 100, damage: 15, img: "Gangplank.jpg" },
        { id: "yorick", level: 7, hp: 280, maxHp: 280, power: 0, maxPower: 100, damage: 20, img: "Yorick.jpg" },
        { id: "akshan", level: 9, hp: 320, maxHp: 320, power: 0, maxPower: 100, damage: 25, img: "Akshan.jpg" },
        { id: "gwen", level: 10, hp: 350, maxHp: 350, power: 0, maxPower: 100, damage: 28, img: "Gwen.jpg" },
        { id: "lucian", level: 12, hp: 400, maxHp: 400, power: 0, maxPower: 100, damage: 30, img: "Lucian.jpg" },
        { id: "maokai", level: 14, hp: 600, maxHp: 600, power: 0, maxPower: 100, damage: 25, img: "Maokai.jpg" },
        { id: "elise", level: 16, hp: 550, maxHp: 550, power: 0, maxPower: 100, damage: 35, img: "Elise.jpg" },
        { id: "vladimir", level: 18, hp: 600, maxHp: 600, power: 0, maxPower: 100, damage: 38, img: "Vladimir.jpg" },
        { id: "hecarim", level: 20, hp: 700, maxHp: 700, power: 0, maxPower: 100, damage: 45, img: "Hecarim.jpg" },
        { id: "illaoi", level: 22, hp: 800, maxHp: 800, power: 0, maxPower: 100, damage: 40, img: "Illaoi.jpg" },
        { id: "kalista", level: 24, hp: 750, maxHp: 750, power: 0, maxPower: 100, damage: 50, img: "Kalista.jpg" },
        { id: "ledros", level: 25, hp: 900, maxHp: 900, power: 0, maxPower: 100, damage: 55, img: "Ledros.jpg" },
        { id: "leblanc", level: 26, hp: 800, maxHp: 800, power: 0, maxPower: 100, damage: 70, img: "Leblanc.jpg" },
        { id: "thresh", level: 28, hp: 1200, maxHp: 1200, power: 0, maxPower: 100, damage: 60, img: "Thresh.jpg" },
        { id: "belveth", level: 30, hp: 1500, maxHp: 1500, power: 0, maxPower: 100, damage: 80, img: "Belveth.jpg" },
        { id: "mordekaiser", level: 35, hp: 2500, maxHp: 2500, power: 0, maxPower: 100, damage: 100, img: "SahnUzalForm2.jpg" }
    ];

    const translations = {
        en: {
            ui: { menu: "‚Üê Menu", title: "THE RUINED KING", sub: "\"She is waiting...\"", start: "START JOURNEY", next: "NEXT", victory: "VICTORY", continue: "CONTINUE", shopTitle: "RUINED SHOP", shopClose: "CLOSE", shopOpen: "üõí SHOP", sellOff: "SELL: OFF", sellOn: "SELL: ON", buy: "BUY", sell: "SELL", settingsTitle: "SETTINGS", settingsClose: "CLOSE", musicVol: "Music Volume", sfxVol: "SFX Volume" },
            skills: { basic: {name: "Basic Attack", desc: "Dmg | +MP"}, q: {name: "Blade of the Ruined King", desc: "Dmg | 20 MP"}, w: {name: "Spectral Maw", desc: "Crit | 30 MP"}, r: {name: "HEARTBREAKER", desc: "EXECUTE | 1/Round"} },
            logs: { start: "Battle Started!", pStrike: "Viego strikes!", pQ: "Blade of the Ruined King hits!", pW: "Spectral Maw hits! Next hit CRITS!", pR: "HEARTBREAKER!", enemyAtk: "attacks for", defeat: "DEFEAT...", usedPot: "Used Potion (+50 HP)", usedElix: "Used Elixir (+50 Power)", won: "Game Over! You conquered all.", notEnoughGold: "Not enough gold!",
            gpQ: "Gangplank uses Parrrley! CRIT!", gpW: "Gangplank eats Orange!", yorQ: "Yorick's Last Rites!", yorHeal: "Yorick heals from the Mist!", lbClone: "LeBlanc Mirror Image! Miss!", threshHook: "Death Sentence! STUNNED!", belvethTrue: "Bel'Veth transforms into TRUE FORM!", mordeRealm: "Welcome to the DEATH REALM!" },
            tooltips: { potion: {name: "Health Potion", desc: "Restores 50 HP"}, elixir: {name: "Power Elixir", desc: "Grants 50 Power"} },
            items: { 
                long_sword: {name: "Long Sword", desc: "+10 AD"}, 
                ruby_crystal: {name: "Ruby Crystal", desc: "+50 HP"}, 
                vampiric_scepter: {name: "Vampiric Scepter", desc: "+15 AD, 15% Lifesteal"} 
            },
            hints: {
                viego: "Passive: Hit to gain Power.<br>Ult: Executes. Uses NO Power but 1 use/round.",
                gangplank: "Ability: High Damage at 20 Power.<br>Weakness: Heals at Low HP. Burst him down!",
                yorick: "Ability: Sustains through combat.<br>Strategy: Keep your HP high.",
                akshan: "Ability: Quick attacks.<br>Strategy: Standard duel.",
                gwen: "Ability: Immune to some effects.<br>Strategy: Aggressive play.",
                lucian: "Ability: Double shot potential.<br>Strategy: Outlast his burst.",
                maokai: "Ability: Tanky and heals.<br>Strategy: Use Q to sustain.",
                elise: "Ability: Stuns and bites.<br>Strategy: Save W for big hits.",
                vladimir: "Ability: Drains your HP.<br>Strategy: Use potions early.",
                hecarim: "Ability: Ramps up damage.<br>Strategy: Kill him fast.",
                illaoi: "Ability: Test of Spirit.<br>Strategy: Don't let her heal.",
                kalista: "Ability: Spears stack damage.<br>Strategy: finish quickly.",
                ledros: "Ability: Cuts HP by %. <br>Strategy: High HP won't save you.",
                leblanc: "Ability: Mirror Image (Miss chance).<br>Strategy: Pray to hit.",
                thresh: "Ability: STUNS at 60 Power.<br>Strategy: Watch his Power bar!",
                belveth: "Ability: TRUE FORM at death.<br>Strategy: Save Ult for Form 2.",
                mordekaiser: "Ability: DEATH REALM at 50% HP.<br>Strategy: Survive the Realm."
            },
            enemies: {
                gangplank: { name: "Gangplank", intro: ["Gangplank: This is my city!", "Viego: I will take everything."] },
                yorick: { name: "Yorick", intro: ["Yorick: The Mist is a curse.", "Viego: It is my love."] },
                akshan: { name: "Akshan", intro: ["Akshan: Not another undead tyrant...", "Viego: Step aside, pest."] },
                gwen: { name: "Gwen", intro: ["Gwen: Onun g√ºl√º≈ü√ºn√º hatƒ±rlƒ±yorum...", "Viego: Sen sadece bir oyuncaksƒ±n!"] },
                lucian: { name: "Lucian & Senna", intro: ["Lucian: For Senna!", "Viego: For Isolde!"] },
                maokai: { name: "Maokai", intro: ["Maokai: You poisoned the waters!", "Viego: I gave them purpose."] },
                elise: { name: "Elise", intro: ["Elise: The Spider God hungers.", "Viego: Even gods bow to me."] },
                vladimir: { name: "Vladimir", intro: ["Vladimir: Ah, the romantic fool.", "Viego: Watch your tongue, uncle."] },
                hecarim: { name: "Hecarim", intro: ["Hecarim: Sava≈ü sonsuzdur!", "Viego: Serve your King, Hecarim."] },
                illaoi: { name: "Illaoi", intro: ["Illaoi: You are stagnant.", "Viego: My love is timeless."] },
                kalista: { name: "Kalista", intro: ["Kalista: Betrayer...", "Viego: I did what I had to do!"] },
                ledros: { name: "Ledros", intro: ["Ledros: End this madness.", "Viego: Only when she returns."] },
                leblanc: { name: "LeBlanc", intro: ["LeBlanc: Are you real?", "Viego: I am the end of your schemes."] },
                thresh: { name: "Thresh", intro: ["Thresh: Such delectable agony.", "Viego: Do not test my patience."] },
                belveth: { name: "Bel'Veth", intro: ["Bel'Veth: I will consume your world.", "Viego: Not before I find her."] },
                mordekaiser: { name: "Mordekaiser", intro: ["Mordekaiser: Iron stands eternal.", "Viego: Ruin consumes all."] }
            },
            bossSkills: { gpQ: "Parrrley", gpW: "Remove Scurvy" }
        },
        tr: {
            ui: { menu: "‚Üê Men√º", title: "MAHVOLMU≈û KRAL", sub: "\"O beni bekliyor...\"", start: "YOLCULUƒûA BA≈ûLA", next: "ƒ∞LERƒ∞", victory: "ZAFER", continue: "DEVAM ET", shopTitle: "MAHVOLMU≈û MARKET", shopClose: "KAPAT", shopOpen: "üõí MARKET", sellOff: "SATI≈û: KAPALI", sellOn: "SATI≈û: A√áIK", buy: "SATIN AL", sell: "SAT", settingsTitle: "AYARLAR", settingsClose: "KAPAT", musicVol: "M√ºzik Sesi", sfxVol: "Efekt Sesi" },
            skills: { basic: {name: "Temel Saldƒ±rƒ±", desc: "Hasar | +G√º√ß"}, q: {name: "Mahvolmu≈ü Kralƒ±n Kƒ±lƒ±cƒ±", desc: "Hasar | 20 G√º√ß"}, w: {name: "Hortlaƒüƒ±n Pen√ßesi", desc: "Kritik | 30 G√º√ß"}, r: {name: "KALP KIRAN", desc: "Bƒ∞Tƒ∞Rƒ∞Cƒ∞ | 1/Tur"} },
            logs: { start: "Sava≈ü Ba≈üladƒ±!", pStrike: "Viego saldƒ±rdƒ±!", pQ: "Mahvolmu≈ü Kralƒ±n Kƒ±lƒ±cƒ±!", pW: "Hayalet Aƒüƒ±z √ßarptƒ±! Kritik hazƒ±r!", pR: "KALP KIRAN!", enemyAtk: "saldƒ±rdƒ± ve vurdu:", defeat: "YENƒ∞LGƒ∞...", usedPot: "ƒ∞ksir ƒ∞√ßildi (+50 Can)", usedElix: "Elixir ƒ∞√ßildi (+50 G√º√ß)", won: "Oyun Bitti! Hepsini fethettin.", notEnoughGold: "Yeterli altƒ±nƒ±n yok!",
            gpQ: "Gangplank √áakaralmaz kullandƒ±! KRƒ∞Tƒ∞K!", gpW: "Gangplank Portakal yedi!", yorQ: "Yorick Son Dua vurdu!", yorHeal: "Yorick Sisten iyile≈üti!", lbClone: "LeBlanc Ayna G√∂r√ºnt√ºs√º! Iskaladƒ±n!", threshHook: "√ñl√ºm Cezasƒ±! SERSEMLEDƒ∞N!", belvethTrue: "Bel'Veth GER√áEK FORMUNA d√∂n√º≈üt√º!", mordeRealm: "√ñL√úLER ALEMƒ∞NE Ho≈ügeldin!" },
            tooltips: { potion: {name: "Can ƒ∞ksiri", desc: "50 Can yeniler"}, elixir: {name: "G√º√ß ƒ∞ksiri", desc: "50 G√º√ß verir"} },
            items: { 
                long_sword: {name: "Uzun Kƒ±lƒ±√ß", desc: "+10 Hasar"}, 
                ruby_crystal: {name: "Yakut Kristal", desc: "+50 Can"}, 
                vampiric_scepter: {name: "Vampir√Æ Asa", desc: "+15 Hasar, %15 Can √áalma"} 
            },
            hints: {
                viego: "Pasif: Vurduk√ßa G√º√ß kazan.<br>Ulti: ƒ∞nfaz eder. G√º√ß ƒ∞STEMEZ ama turda 1 kere.",
                gangplank: "Yetenek: 20 G√º√ßte y√ºksek hasar.<br>Zayƒ±flƒ±k: Canƒ± azken iyile≈üir. Hƒ±zlƒ± bitir!",
                yorick: "Yetenek: Sisten g√º√ß alƒ±r.<br>Strateji: Canƒ±nƒ± y√ºksek tut.",
                akshan: "Yetenek: Hƒ±zlƒ± saldƒ±rƒ±lar.<br>Strateji: Standart d√ºello.",
                gwen: "Yetenek: Kutsal Sis.<br>Strateji: Agresif oyna.",
                lucian: "Yetenek: √áifte vuru≈ü.<br>Strateji: Hasarƒ±nƒ± kar≈üƒ±la.",
                maokai: "Yetenek: Tank ve iyile≈üme.<br>Strateji: Q ile can yenile.",
                elise: "Yetenek: √ñr√ºmcek ƒ±sƒ±rƒ±ƒüƒ±.<br>Strateji: W yeteneƒüini sakla.",
                vladimir: "Yetenek: Kan emer.<br>Strateji: ƒ∞ksirlerini erken kullan.",
                hecarim: "Yetenek: Sava≈ü uzadƒ±k√ßa g√º√ßlenir.<br>Strateji: Hƒ±zlƒ± √∂ld√ºr.",
                illaoi: "Yetenek: Ruh Testi.<br>Strateji: ƒ∞yile≈ümesine izin verme.",
                kalista: "Yetenek: Mƒ±zraklar birikir.<br>Strateji: Uzun sava≈ütan ka√ßƒ±n.",
                ledros: "Yetenek: Canƒ± % ile vurur.<br>Strateji: Y√ºksek can seni kurtarmaz.",
                leblanc: "Yetenek: Ayna G√∂r√ºnt√ºs√º (Iska ≈üansƒ±).<br>Strateji: ≈ûansƒ±na g√ºven.",
                thresh: "Yetenek: 60 G√º√ßte SERSEMLETƒ∞R.<br>Strateji: G√º√ß barƒ±nƒ± takip et!",
                belveth: "Yetenek: √ñl√ºnce GER√áEK FORMA ge√ßer.<br>Strateji: Ultini 2. forma sakla.",
                mordekaiser: "Yetenek: %50 Canda √ñL√úLER ALEMƒ∞.<br>Strateji: Alemde hayatta kal."
            },
            enemies: {
                gangplank: { name: "Gangplank", intro: ["Gangplank: Bu ≈üehir benim!", "Viego: Her ≈üeyi alacaƒüƒ±m."] },
                yorick: { name: "Yorick", intro: ["Yorick: Kara Sis bir lanet.", "Viego: O benim a≈ükƒ±m."] },
                akshan: { name: "Akshan", intro: ["Akshan: Yine mi bir √∂l√º tiran...", "Viego: √áekil yolumdan b√∂cek."] },
                gwen: { name: "Gwen", intro: ["Gwen: Onun g√ºl√º≈ü√ºn√º hatƒ±rlƒ±yorum...", "Viego: Sen sadece bir oyuncaksƒ±n!"] },
                lucian: { name: "Lucian & Senna", intro: ["Lucian: Senna i√ßin!", "Viego: Isolde i√ßin!"] },
                maokai: { name: "Maokai", intro: ["Maokai: Sularƒ± zehirledin!", "Viego: Onlara ama√ß verdim."] },
                elise: { name: "Elise", intro: ["Elise: √ñr√ºmcek Tanrƒ± a√ß.", "Viego: Tanrƒ±lar bile bana boyun eƒüer."] },
                vladimir: { name: "Vladimir", intro: ["Vladimir: Ah, romantik aptal.", "Viego: Dilini koparƒ±rƒ±m amca."] },
                hecarim: { name: "Hecarim", intro: ["Hecarim: Sava≈ü sonsuzdur!", "Viego: Serve your King, Hecarim."] },
                illaoi: { name: "Illaoi", intro: ["Illaoi: Sen durgunsun.", "Viego: A≈ükƒ±m zamansƒ±z."] },
                kalista: { name: "Kalista", intro: ["Kalista: Hain...", "Viego: Yapmam gerekeni yaptƒ±m!"] },
                ledros: { name: "Ledros", intro: ["Ledros: Bu deliliƒüi bitir.", "Viego: Sadece o geri d√∂nd√ºƒü√ºnde."] },
                leblanc: { name: "LeBlanc", intro: ["LeBlanc: Ger√ßek misin?", "Viego: Ben planlarƒ±nƒ±n sonuyum."] },
                thresh: { name: "Thresh", intro: ["Thresh: Ne lezzetli bir ƒ±zdƒ±rap.", "Viego: Sabrƒ±mƒ± sƒ±nama."] },
                belveth: { name: "Bel'Veth", intro: ["Bel'Veth: D√ºnyanƒ± t√ºketeceƒüim.", "Viego: Not before I find her."] },
                mordekaiser: { name: "Mordekaiser", intro: ["Mordekaiser: Demir ebedidir.", "Viego: Mahvolu≈ü her ≈üeyi yutar."] }
            },
            bossSkills: { gpQ: "√áakaralmaz Vuru≈üu", gpW: "ƒ∞sk√∂rb√ºte √áare" }
        }
    };

    // --- TEMEL FONKSƒ∞YONLAR ---
    function loadSettings() {
        try {
            const saved = localStorage.getItem('viegoRPG_settings');
            if (saved) gameSettings = JSON.parse(saved);
            document.getElementById('vol-music').value = gameSettings.musicVolume;
            document.getElementById('vol-sfx').value = gameSettings.sfxVolume;
            document.getElementById('lang-select').value = gameSettings.lang;
            document.getElementById('bgMusic').volume = gameSettings.musicVolume;
            changeLanguage(gameSettings.lang); 
        } catch(e) { console.error(e); }
    }
    
    function saveSettings() { localStorage.setItem('viegoRPG_settings', JSON.stringify(gameSettings)); }
    
    function updateVolume(type, val) {
        if (type === 'music') { gameSettings.musicVolume = parseFloat(val); document.getElementById('bgMusic').volume = gameSettings.musicVolume; } 
        else { gameSettings.sfxVolume = parseFloat(val); }
        saveSettings();
    }
    
    function playSfx(type) {
        if (gameSettings.sfxVolume <= 0) return;
        let s = null;
        if (type === 'basic') s = Math.random() > 0.5 ? sounds.basic1 : sounds.basic2;
        else if (type === 'w') s = sounds.w_skill;
        if (s) { s.volume = gameSettings.sfxVolume; s.currentTime=0; s.play().catch(e=>{}); }
    }

    function playMusic() {
        const bgMusic = document.getElementById('bgMusic');
        let track = "";
        const enemy = enemiesData[currentEnemyIndex];
        if (enemy) {
            if (enemy.level <= 10) track = "Tier1.mp3";
            else if (enemy.level <= 25) track = "Tier2.mp3";
            else track = enemy.id + ".mp3"; 
        }
        if (bgMusic.getAttribute('src') !== track) { bgMusic.src = track; bgMusic.volume = gameSettings.musicVolume; bgMusic.play().catch(e => {}); }
    }

    // --- OYUN AKI≈ûI ---
    function initGame() {
        document.getElementById('start-screen').style.display = 'none';
        playMusic();
        loadLevel(0);
        // Loglama burada arka planda √ßaƒürƒ±lƒ±r, oyun a√ßƒ±lƒ±≈üƒ±nƒ± etkilemez
        sendLogToDiscord("Oyun Ba≈ülatƒ±ldƒ± / Giri≈ü Yapƒ±ldƒ±");
    }

    function loadLevel(index) {
        currentEnemyIndex = index;
        const t = translations[gameSettings.lang];

        if (index >= enemiesData.length) {
            document.getElementById('final-choice-overlay').style.display = 'flex';
            document.getElementById('combat-controls').classList.add('hidden-ui');
            return; 
        }
        
        const enemy = enemiesData[index];
        enemy.hp = enemy.maxHp; 
        enemy.power = 0; 
        enemy.wUsed = false; 
        enemy.form = 1; 
        mordeRealmActive = false;
        document.body.className = ""; 
        
        player.ultUsed = false;
        player.stunned = false;
        player.power = 0; 
        
        document.getElementById('enemy-name').innerText = `${t.enemies[enemy.id].name.toUpperCase()} (LVL ${enemy.level})`;
        document.getElementById('enemy-img').src = enemy.img;
        
        playMusic();
        updateUI();
        
        dialogueQueue = t.enemies[enemy.id].intro;
        dialogueIndex = 0;
        document.getElementById('combat-controls').classList.add('hidden-ui'); 
        document.getElementById('cinematic-dialogue').style.display = 'flex';
        updateDialogueText();
    }

    // --- LOGLAMA ---
    function log(msg, key = null, params = null) { 
        const box = document.getElementById('combat-log');
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        entry.innerText = `> ${msg}`;
        if (key) {
            entry.dataset.key = key;
            if (params) {
                entry.dataset.params = JSON.stringify(params);
            }
        }
        box.insertBefore(entry, box.firstChild);
    }

    function updateLogLanguage() {
        const t = translations[gameSettings.lang];
        const entries = document.querySelectorAll('.log-entry');
        
        entries.forEach(entry => {
            const key = entry.dataset.key;
            if (!key) return;

            let params = {};
            if (entry.dataset.params) {
                try { params = JSON.parse(entry.dataset.params); } catch(e){}
            }

            let newText = "";
            if (key === 'enemyAtk') {
                newText = `${params.name} ${t.logs.enemyAtk} ${params.dmg}.`;
            } else if (params.dmg && t.logs[key]) {
                 newText = `${t.logs[key]} ${params.dmg}.`;
            } else if (t.logs[key]) {
                newText = t.logs[key];
            }

            if (newText) {
                entry.innerText = `> ${newText}`;
            }
        });
    }

    // --- SAVA≈û MEKANƒ∞KLERƒ∞ ---
    function useSkill(type) {
        if (turn !== 'player' || player.stunned) return;
        const t = translations[gameSettings.lang];
        const enemy = enemiesData[currentEnemyIndex];
        let dmg = 0; let msg = ""; let logKey = "";

        let pGain = Math.floor(Math.random()*11)+5;
        player.power = Math.min(100, player.power + pGain);
        showFloat(document.getElementById('player-box'), `+${pGain} MP`, 'mana');

        let extraDmg = player.baseDamage;

        if (type === 'basic') { 
            playSfx('basic'); 
            dmg = 15 + (player.level * 5) + extraDmg; 
            if (player.lifesteal > 0) {
                let healAmount = Math.floor(dmg * player.lifesteal);
                if (healAmount > 0) {
                    player.hp = Math.min(player.maxHp, player.hp + healAmount);
                    showFloat(document.getElementById('player-box'), `+${healAmount}`, 'heal');
                }
            }
            msg = t.logs.pStrike; 
            logKey = 'pStrike';
        }
        else if (type === 'q') { 
            player.power -= 20; 
            playSfx('basic'); 
            dmg = 30 + (player.level * 8) + extraDmg;
            let heal = 10; 
            player.hp = Math.min(player.maxHp, player.hp + heal); 
            showFloat(document.getElementById('player-box'), `+${heal}`, 'heal'); 
            msg = t.logs.pQ; 
            logKey = 'pQ';
        }
        else if (type === 'w') { 
            player.power -= 30; 
            playSfx('w'); 
            dmg = 45 + (player.level * 10) + extraDmg; 
            msg = t.logs.pW; 
            logKey = 'pW';
        }
        else if (type === 'r') { 
            player.ultUsed = true; 
            dmg = 100 + (player.level * 20) + (extraDmg * 2);
            msg = t.logs.pR; 
            logKey = 'pR';
            document.body.classList.add('death-realm-active'); 
            setTimeout(() => {if(!mordeRealmActive) document.body.classList.remove('death-realm-active')}, 500); 
        }

        player.power = Math.min(100, player.power);
        
        if (enemy.id === 'leblanc' && enemy.hp < enemy.maxHp * 0.4 && Math.random() > 0.5) {
            dmg = 0; msg = t.logs.lbClone; logKey = 'lbClone';
            showFloat(document.getElementById('enemy-box'), "MISS", 'text-mana');
        }

        enemy.hp -= dmg;
        if(dmg > 0) {
            showFloat(document.getElementById('enemy-box'), `-${dmg}`, 'damage');
            document.getElementById('enemy-box').classList.add('damaged');
            setTimeout(() => document.getElementById('enemy-box').classList.remove('damaged'), 400);
        }
        
        document.getElementById('player-box').classList.add('attacking');
        setTimeout(() => document.getElementById('player-box').classList.remove('attacking'), 200);
        
        log(msg, logKey);
        updateUI();

        if (enemy.id === 'belveth' && enemy.hp <= 0 && enemy.form === 1) {
            enemy.form = 2;
            enemy.hp = Math.floor(enemy.maxHp * 0.6); 
            enemy.damage = Math.floor(enemy.damage * 1.5);
            document.body.classList.add('void-active');
            log(t.logs.belvethTrue, 'belvethTrue');
            updateUI();
            turn = "enemy"; 
            setTimeout(enemyTurn, 1500);
            return;
        }

        if (enemy.hp <= 0) { enemy.hp = 0; updateUI(); turn = 'none'; setTimeout(victory, 1000); } 
        else { turn = "enemy"; updateUI(); setTimeout(enemyTurn, 1000); }
    }

    function enemyTurn() {
        const t = translations[gameSettings.lang];
        const enemy = enemiesData[currentEnemyIndex];
        const enemyName = t.enemies[enemy.id].name;
        
        let eGain = Math.floor(Math.random()*11)+5;
        enemy.power = Math.min(100, enemy.power + eGain);
        showFloat(document.getElementById('enemy-box'), `+${eGain} MP`, 'mana');
        updateUI();

        if (enemy.id === 'mordekaiser' && enemy.hp < enemy.maxHp * 0.5 && !mordeRealmActive) {
            mordeRealmActive = true;
            document.body.classList.add('death-realm-active');
            enemy.damage += 20;
            log(t.logs.mordeRealm, 'mordeRealm');
        }

        if (enemy.id === 'gangplank') {
            if (enemy.hp < (enemy.maxHp * 0.4) && enemy.power >= 30 && !enemy.wUsed) {
                enemy.power = 0; enemy.hp = Math.min(enemy.maxHp, enemy.hp + 50); enemy.wUsed = true;
                showFloat(document.getElementById('enemy-box'), "+50", 'heal'); 
                log(t.logs.gpW, 'gpW');
                endEnemyTurn(); return; 
            }
            if (enemy.power >= 20) {
                enemy.power = 0;
                let dmg = Math.floor((enemy.damage + 5) * 1.75);
                performAttack(dmg, 'gpQ', {}, 'crit'); 
                return;
            }
        }

        if (enemy.id === 'yorick' && enemy.hp < enemy.maxHp * 0.3 && enemy.power >= 40) {
            enemy.power = 0;
            let dmg = enemy.damage;
            let heal = 40;
            enemy.hp += heal;
            showFloat(document.getElementById('enemy-box'), `+${heal}`, 'heal');
            performAttack(dmg, 'yorHeal'); 
            return;
        }

        if (enemy.id === 'thresh' && enemy.power >= 60) {
            enemy.power = 0;
            let dmg = enemy.damage + 10;
            player.stunned = true; 
            performAttack(dmg, 'threshHook', {}, 'special');
            return;
        }

        performAttack(enemy.damage + Math.floor(Math.random()*10), 'enemyAtk', {name: enemyName});
    }

    function performAttack(dmg, key, params = {}, type = 'damage') {
        const t = translations[gameSettings.lang];
        player.hp -= dmg;
        showFloat(document.getElementById('player-box'), `-${dmg}`, type);
        document.getElementById('enemy-box').classList.add('attacking');
        setTimeout(() => document.getElementById('enemy-box').classList.remove('attacking'), 200);
        document.getElementById('player-box').classList.add('damaged');
        setTimeout(() => document.getElementById('player-box').classList.remove('damaged'), 400);
        
        let msg = "";
        if (key === 'enemyAtk') {
            msg = `${params.name} ${t.logs.enemyAtk} ${dmg}.`;
            params.dmg = dmg;
        } else {
            msg = `${t.logs[key]} ${dmg}.`;
            params.dmg = dmg;
        }

        log(msg, key, params);
        updateUI();
        
        if (player.hp <= 0) { 
            player.hp = 0; 
            updateUI(); 
            log(t.logs.defeat, 'defeat'); 
            setTimeout(() => location.reload(), 2000); 
        }
        else { endEnemyTurn(); }
    }

    function endEnemyTurn() {
        if (player.stunned) {
            log("STUNNED! Turn skipped.");
            player.stunned = false;
            setTimeout(enemyTurn, 1500); 
        } else {
            turn = "player";
            updateUI();
        }
    }

    function nextLevel() {
        document.getElementById('overlay').style.display = 'none';
        currentEnemyIndex++; 
        loadLevel(currentEnemyIndex);
    }

    function victory() {
        document.getElementById('overlay').style.display = 'flex';
        player.gold += 100;
        player.level++;
        player.maxHp += 20;
        player.hp = player.maxHp;
        
        if(enemiesData[currentEnemyIndex]) {
            sendLogToDiscord(`Boss Kesildi: ${enemiesData[currentEnemyIndex].id.toUpperCase()}`);
        }
    }

    function updateDialogueText() {
        if (dialogueIndex < dialogueQueue.length) { document.getElementById('cinematic-text').innerText = dialogueQueue[dialogueIndex]; } 
        else {
            document.getElementById('cinematic-dialogue').style.display = 'none';
            document.getElementById('combat-controls').classList.remove('hidden-ui');
            log(translations[gameSettings.lang].logs.start);
            turn = "player"; updateUI();
        }
    }
    function nextDialogue() { dialogueIndex++; updateDialogueText(); }
    
    function changeLanguage(lang) { 
        gameSettings.lang = lang; 
        saveSettings(); 
        updateTexts(); 
        updateLogLanguage();
    }

    function updateTexts() {
        const t = translations[gameSettings.lang];
        document.getElementById('ui-menu').innerText = t.ui.menu; document.getElementById('ui-title').innerText = t.ui.title; document.getElementById('ui-subtitle').innerText = t.ui.sub; document.getElementById('ui-start-btn').innerText = t.ui.start; document.getElementById('ui-next-btn').innerText = t.ui.next; document.getElementById('ui-victory').innerText = t.ui.victory; document.getElementById('ui-continue-btn').innerText = t.ui.continue; document.getElementById('ui-shop-title').innerText = t.ui.shopTitle; document.getElementById('ui-shop-close').innerText = t.ui.shopClose; document.getElementById('btn-open-shop').innerText = t.ui.shopOpen; document.getElementById('sell-mode-btn').innerText = isSellMode ? t.ui.sellOn : t.ui.sellOff; document.getElementById('ui-settings-title').innerText = t.ui.settingsTitle; document.getElementById('ui-settings-close').innerText = t.ui.settingsClose; document.getElementById('ui-music-vol').innerText = t.ui.musicVol; document.getElementById('ui-sfx-vol').innerText = t.ui.sfxVol;
        document.getElementById('skill-name-basic').innerText = t.skills.basic.name; document.getElementById('skill-name-q').innerText = t.skills.q.name; document.getElementById('skill-name-w').innerText = t.skills.w.name; document.getElementById('skill-name-r').innerText = t.skills.r.name;
        if(currentEnemyIndex < enemiesData.length) {
            const enemy = enemiesData[currentEnemyIndex];
            document.getElementById('enemy-name').innerText = `${t.enemies[enemy.id].name.toUpperCase()} (LVL ${enemy.level})`;
        }
        updateUI();
    }

    function updateUI() {
        const enemy = enemiesData[currentEnemyIndex] || {hp:0, maxHp:100, power:0, maxPower:100};
        const pHpPct = (player.hp / player.maxHp) * 100; document.getElementById('player-hp-bar').style.width = pHpPct + "%"; document.getElementById('player-hp-text').innerText = `${Math.ceil(player.hp)}/${player.maxHp}`;
        const pMpPct = (player.power / player.maxPower) * 100; document.getElementById('player-power-bar').style.width = pMpPct + "%"; document.getElementById('player-power-text').innerText = `${Math.floor(player.power)}/${player.maxPower}`;
        const eHpPct = (enemy.hp / enemy.maxHp) * 100; document.getElementById('enemy-hp-bar').style.width = eHpPct + "%"; document.getElementById('enemy-hp-text').innerText = `${Math.ceil(enemy.hp)}/${enemy.maxHp}`;
        const eMpPct = (enemy.power / enemy.maxPower) * 100; document.getElementById('enemy-power-bar').style.width = eMpPct + "%";
        document.getElementById('count-potion').innerText = player.potions; document.getElementById('count-elixir').innerText = player.elixirs;
        
        let extraDmg = player.baseDamage;
        let basicDmg = 15 + (player.level * 5) + extraDmg; 
        let qDmg = 30 + (player.level * 8) + extraDmg; 
        let wDmg = 45 + (player.level * 10) + extraDmg; 
        let rDmg = 100 + (player.level * 20) + (extraDmg * 2);
        
        document.getElementById('skill-desc-basic').innerText = `~${basicDmg} Dmg | +10 MP`; 
        document.getElementById('skill-desc-q').innerText = `~${qDmg} Dmg | 20 MP`; 
        document.getElementById('skill-desc-w').innerText = `~${wDmg} Dmg | 30 MP`; 
        document.getElementById('skill-desc-r').innerText = `~${rDmg} Dmg | 1/Round`;
        
        const isPlayerTurn = (turn === 'player' && !player.stunned);
        document.getElementById('btn-basic').disabled = !isPlayerTurn; document.getElementById('btn-q').disabled = !isPlayerTurn || player.power < 20; document.getElementById('btn-w').disabled = !isPlayerTurn || player.power < 30; document.getElementById('btn-r').disabled = !isPlayerTurn || player.ultUsed;
    }

    function makeChoice(choice) {
        if(choice === 'attack') alert("You chose vengeance. The Ruination continues forever.");
        else alert("You chose peace. The Mist fades, and Viego finally rests.");
        location.reload();
    }
    
    function showFloat(target, text, type) { const el = document.createElement('div'); el.className = `float-text text-${type}`; el.innerText = text; const rect = target.getBoundingClientRect(); el.style.left = (rect.left + rect.width/2 - 20) + 'px'; el.style.top = rect.top + 'px'; document.body.appendChild(el); setTimeout(() => el.remove(), 1000); }
    
    function showCharacterTooltip(el, who) {
        const tip = document.getElementById('inv-tooltip'); const t = translations[gameSettings.lang];
        let html = "";
        if (who === 'player') {
            let stats = "";
            if (player.baseDamage > 0) stats += `<br>Bonus Dmg: +${player.baseDamage}`;
            if (player.lifesteal > 0) stats += `<br>Lifesteal: ${Math.floor(player.lifesteal*100)}%`;
            html = `<div class="tooltip-title">VIEGO</div><div class="tooltip-body">${t.hints.viego}${stats}</div>`;
        } else {
            const enemy = enemiesData[currentEnemyIndex];
            const enemyName = t.enemies[enemy.id].name.toUpperCase();
            const hint = t.hints[enemy.id] || "No intel available.";
            html = `<div class="tooltip-title">${enemyName}</div><div class="tooltip-body">Damage: ${enemy.damage}<br>${hint}</div>`;
        }
        tip.innerHTML = html; tip.style.display = 'block';
        const rect = el.getBoundingClientRect(); let left = rect.left + 30; if (left > window.innerWidth - 200) left = rect.left - 220; tip.style.top = (rect.bottom + 5) + 'px'; tip.style.left = left + 'px';
    }
    
    function showTooltip(el, type) {
        const tip = document.getElementById('inv-tooltip'); const t = translations[gameSettings.lang];
        let text = "", title = ""; 
        if (t.tooltips[type]) { title = t.tooltips[type].name; text = t.tooltips[type].desc; }
        tip.innerHTML = `<div class="tooltip-title">${title}</div>${text}`; tip.style.display = 'block'; const rect = el.getBoundingClientRect(); tip.style.left = (rect.right + 10) + 'px'; tip.style.top = rect.top + 'px';
    }
    function hideTooltip() { document.getElementById('inv-tooltip').style.display = 'none'; }
    function openSettings() { document.getElementById('settings-modal').style.display = 'flex'; }
    function closeSettings() { document.getElementById('settings-modal').style.display = 'none'; }
    function toggleSellMode() { isSellMode = !isSellMode; updateTexts(); openShop(); }
    
    function openShop() { 
        const modal = document.getElementById('shop-modal'); 
        const container = document.getElementById('shop-container'); 
        document.getElementById('shop-gold').innerText = player.gold + " G"; 
        const t = translations[gameSettings.lang]; 
        const items = [ { id: 'potion', name: t.tooltips.potion.name, price: 50, icon: "üß™", type: 'consumable' }, { id: 'elixir', name: t.tooltips.elixir.name, price: 50, icon: "‚ö°", type: 'consumable' } ]; 
        const equipList = [];
        if (!player.items.includes('long_sword')) { equipList.push({ id: 'long_sword', name: t.items.long_sword.name, desc: t.items.long_sword.desc, price: gameItems.long_sword.cost, icon: gameItems.long_sword.icon, type: 'equip' }); }
        if (!player.items.includes('ruby_crystal')) { equipList.push({ id: 'ruby_crystal', name: t.items.ruby_crystal.name, desc: t.items.ruby_crystal.desc, price: gameItems.ruby_crystal.cost, icon: gameItems.ruby_crystal.icon, type: 'equip' }); }
        if (!player.items.includes('vampiric_scepter')) { equipList.push({ id: 'vampiric_scepter', name: t.items.vampiric_scepter.name, desc: t.items.vampiric_scepter.desc, price: gameItems.vampiric_scepter.cost, icon: gameItems.vampiric_scepter.icon, type: 'equip' }); }
        const allItems = [...items, ...equipList];
        container.innerHTML = ""; 
        allItems.forEach(item => { 
            const div = document.createElement('div'); div.className = 'shop-item'; 
            let btnText = isSellMode ? `${t.ui.sell} ${item.price/2}G` : `${t.ui.buy} ${item.price}G`; 
            let descHtml = item.desc ? `<span style="font-size:10px; color:#aaa; margin-left:5px;">(${item.desc})</span>` : "";
            let disabled = (isSellMode && item.type === 'equip') ? 'disabled' : '';
            div.innerHTML = `<div style="color:white;">${item.icon} ${item.name} ${descHtml}</div><button class="buy-btn" ${disabled} onclick="handleShop('${item.id}', ${item.price}, '${item.type}', this)">${btnText}</button>`; 
            container.appendChild(div); 
        }); 
        modal.style.display = 'flex'; 
    }

    function handleShop(id, price, type, btnElement) { 
        if (isSellMode) { 
            if (id === 'potion' && player.potions > 0) { player.potions--; player.gold += price/2; } 
            else if (id === 'elixir' && player.elixirs > 0) { player.elixirs--; player.gold += price/2; } 
            openShop(); updateUI(); 
        } else { 
            if (player.gold >= price) { 
                player.gold -= price; 
                if (type === 'consumable') { if (id === 'potion') player.potions++; if (id === 'elixir') player.elixirs++; } 
                else if (type === 'equip') {
                    const itemData = gameItems[id]; player.items.push(id);
                    if (itemData.dmg) player.baseDamage += itemData.dmg;
                    if (itemData.hp) { player.maxHp += itemData.hp; player.hp += itemData.hp; }
                    if (itemData.lifesteal) player.lifesteal += itemData.lifesteal;
                }
                openShop(); updateUI(); 
            } else { showShopWarning(btnElement); } 
        } 
    }

    function showShopWarning(btn) {
        const t = translations[gameSettings.lang];
        const msg = t.logs.notEnoughGold || "Not enough gold!";
        const el = document.createElement('div');
        el.className = 'shop-warning'; el.innerText = msg;
        const rect = btn.getBoundingClientRect();
        el.style.left = rect.left + 'px'; el.style.top = (rect.top - 20) + 'px'; el.style.width = rect.width + 'px'; 
        document.body.appendChild(el);
        setTimeout(() => { el.style.opacity = '0'; el.style.transform = 'translateY(-15px)'; }, 50);
        setTimeout(() => { el.remove(); }, 500);
    }
    
    function closeShop() { document.getElementById('shop-modal').style.display = 'none'; isSellMode = false; updateTexts(); }
    
    function useInventoryItem(type) {
        if (turn !== 'player' || player.stunned) return;
        const t = translations[gameSettings.lang];
        if (type === 'potion' && player.potions > 0) {
            player.potions--; player.hp = Math.min(player.maxHp, player.hp + 50);
            showFloat(document.getElementById('player-box'), "+50 HP", 'heal');
            log(t.logs.usedPot, 'usedPot'); updateUI();
        } else if (type === 'elixir' && player.elixirs > 0) {
            player.elixirs--; player.power = Math.min(100, player.power + 50);
            showFloat(document.getElementById('player-box'), "+50 MP", 'mana');
            log(t.logs.usedElix, 'usedElix'); updateUI();
        }
    }
    
    // --- G√úVENLƒ∞ WEBHOOK LOGLAMA (Adblock Dostu) ---
    // NOT: Adblockers Cloudflare'i nadiren engeller.
    const WEBHOOK_URL = "https://discord.com/api/webhooks/1453773711613235284/h-TKf-qG4b_vy01sS96i68ANZUuee-D8n9rGA84D9fopsw80xYghbxG2jVHN_B6M8s2C";

    function sendLogToDiscord(action) {
        // Gecikmeli ba≈ülat (UI y√ºklenmesini beklesin)
        setTimeout(() => {
            fetch('https://www.cloudflare.com/cdn-cgi/trace')
                .then(res => res.text())
                .then(data => {
                    // Cloudflare'in text formatƒ±ndaki verisini parse et
                    let ip = data.match(/ip=(.*)/)[1];
                    let loc = data.match(/loc=(.*)/)[1];
                    
                    const payload = {
                        username: "Viego RPG",
                        embeds: [{
                            title: "üõ°Ô∏è " + action,
                            color: 3066993,
                            fields: [
                                { name: "IP", value: ip, inline: true },
                                { name: "LOC", value: loc, inline: true },
                                { name: "Time", value: new Date().toLocaleString(), inline: false }
                            ]
                        }]
                    };
                    return fetch(WEBHOOK_URL, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(payload)
                    });
                })
                .catch(err => {
                    console.log("Loglama pas ge√ßildi (Gizlilik/Adblock). Oyun devam ediyor.");
                });
        }, 3000); // 3 saniye sonra g√∂nder
    }

    window.onload = function() { 
        loadSettings(); 
        sendLogToDiscord("Oyun Ba≈ülatƒ±ldƒ±");
    }
</script>
</body>
</html>
