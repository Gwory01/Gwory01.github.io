<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Viego: The Ruined King RPG</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

        :root {
            --ruined-green: #0ac8b9;
            --dark-bg: #05080a;
            --power-yellow: #f1c40f;
            --hp-red: #c0392b;
            --crit-color: #ffcc00;
            --heal-color: #2ecc71;
            --gold-color: #f39c12;
            --sell-color: #e74c3c;
            --shield-grey: #95a5a6;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--dark-bg);
            background-image: linear-gradient(rgba(0,0,0,0.85), rgba(0,20,20,0.95)), url('https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Viego_0.jpg');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: #e0e0e0; font-family: 'Cinzel', serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            width: 100vw; height: 100dvh;
            margin: 0; padding: 0;
            overflow: hidden; 
            user-select: none;
            position: relative;
        }
        body.death-realm-active { filter: grayscale(100%) sepia(30%) hue-rotate(90deg) contrast(1.1); box-shadow: inset 0 0 150px #0ac8b9; }

        .game-wrapper { 
            width: 100%; height: 100%; max-width: 1000px;
            background: rgba(8, 10, 12, 0.85); 
            display: flex; flex-direction: column; 
            position: relative; z-index: 10;
        }

        /* --- INFO BUTONU (SOL √úST) --- */
        .info-btn { 
            position: absolute; 
            top: 10px; left: 10px; /* SOL √úST K√ñ≈ûE */
            width: 24px; height: 24px; 
            background: rgba(0, 0, 0, 0.9); 
            border: 1px solid var(--ruined-green); 
            color: var(--ruined-green); border-radius: 50%; 
            font-weight: bold; cursor: help; z-index: 50; 
            display: flex; justify-content: center; align-items: center; font-size: 14px;
            box-shadow: 0 0 8px var(--ruined-green);
            transition: transform 0.2s;
        }
        .info-btn:hover { transform: scale(1.1); background: var(--ruined-green); color: black; }

        .top-bar-controls { 
            position: absolute; top: 10px; right: 10px; z-index: 100;
            display: flex; gap: 10px; align-items: center; 
        }
        .control-btn-ui { background: rgba(0,0,0,0.7); color: white; border: 1px solid #555; padding: 8px 12px; border-radius: 4px; font-size: 12px; cursor: pointer; }
        .back-btn { position: absolute; top: 10px; left: 10px; z-index: 100; color: var(--ruined-green); text-decoration: none; border: 1px solid var(--ruined-green); padding: 8px 12px; background: rgba(0,0,0,0.8); font-size: 12px; border-radius: 4px; }

        .battle-scene { flex-grow: 1; display: flex; justify-content: space-evenly; align-items: center; position: relative; width: 100%; }
        .character-box { width: 45%; max-width: 350px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        
        .character-img { 
            width: 18vh; height: 18vh; max-width: 180px; max-height: 180px; min-width: 120px; min-height: 120px;
            object-fit: cover; object-position: center top; border-radius: 50%; border: 3px solid #444; 
            box-shadow: 0 0 20px rgba(0,0,0,0.5); transition: all 0.2s; 
        }
        
        .viego-glow { border-color: var(--ruined-green); box-shadow: 0 0 20px rgba(10, 200, 185, 0.3); }
        .enemy-glow { border-color: #d63031; box-shadow: 0 0 20px rgba(214, 48, 49, 0.3); }
        .character-box h2 { font-size: 1.1rem; margin: 10px 0 5px 0; text-shadow: 2px 2px 0 #000; letter-spacing: 1px; white-space: nowrap; }
        
        .stat-bar { width: 80%; height: 10px; background: #111; margin-top: 5px; border: 1px solid #444; position: relative; border-radius: 2px; }
        .fill { height: 100%; transition: width 0.4s ease-out; } .hp-fill { background-color: var(--hp-red); } 
        .power-fill { background-color: var(--power-yellow); box-shadow: 0 0 5px var(--power-yellow); }
        .bar-text { font-size: 9px; font-weight: bold; position: absolute; top: -15px; right: 0; color: #aaa; }
        #vs-text { font-size: 1.5rem; color: #444; font-weight: bold; }

        .controls { background: rgba(0,0,0,0.6); border-top: 2px solid var(--ruined-green); padding: 10px; display: flex; flex-direction: column; gap: 10px; height: auto; min-height: 25vh; transition: opacity 0.5s; }
        .hidden-ui { opacity: 0; pointer-events: none; }
        .skills { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; flex-grow: 1; }
        .skill-btn { background: #111; border: 1px solid #333; color: #aaa; font-family: 'Cinzel'; padding: 5px; border-radius: 4px; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: 0.2s; }
        .skill-btn:active { background: #222; transform: scale(0.98); }
        .skill-btn:disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(100%); border-color: #333; background: #000; }
        .skill-btn:disabled .skill-cost { color: #555; }
        
        .skill-name { font-weight: bold; font-size: 0.75rem; margin-bottom: 2px; color: #ddd; text-align: center; }
        .skill-cost { font-size: 0.65rem; color: #2ecc71; text-align: center; font-family: 'Roboto', sans-serif; }
        
        .ult-btn { border-color: var(--ruined-green); color: var(--ruined-green); }
        .ult-btn:disabled { border-color: #333; color: #555; }

        .log-box { height: 40px; background: rgba(0,0,0,0.5); border: 1px solid #333; font-size: 0.8rem; color: #ccc; padding: 5px; overflow-y: auto; font-family: 'Roboto', sans-serif; text-align: center; }

        #inventory-frame { position: absolute; top: 60px; left: 10px; z-index: 20; display: flex; flex-direction: column; gap: 10px; }
        .inv-slot { width: 40px; height: 40px; background: rgba(0,0,0,0.8); border: 1px solid #444; border-radius: 4px; display: flex; justify-content: center; align-items: center; font-size: 20px; cursor: pointer; }
        .inv-count { position: absolute; bottom: 0; right: 0; font-size: 10px; background: black; color: white; padding: 1px 3px; }

        #start-screen, #cinematic-dialogue, #overlay, #final-choice-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 200; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; }
        #overlay, #final-choice-overlay, #cinematic-dialogue { display: none; }
        .dialogue-box { background: #111; border: 2px solid var(--ruined-green); padding: 20px; width: 95%; max-width: 600px; border-radius: 8px; }
        #cinematic-text { font-size: 1rem; line-height: 1.5; color: white; margin-bottom: 20px; font-style: italic; min-height: 50px; font-family: 'Roboto', sans-serif; }
        .start-btn, .choice-btn { background: transparent; border: 2px solid var(--ruined-green); color: var(--ruined-green); padding: 15px 40px; font-family: 'Cinzel'; font-size: 1.2rem; cursor: pointer; margin-top: 10px; transition: 0.3s; width: 80%; max-width: 300px; }
        .start-btn:hover, .choice-btn:hover { background: var(--ruined-green); color: black; }
        .btn-attack { border-color: var(--hp-red); color: var(--hp-red); } .btn-attack:hover { background: var(--hp-red); color: white; }
        .btn-surrender { border-color: #2ecc71; color: #2ecc71; } .btn-surrender:hover { background: #2ecc71; color: white; }

        #shop-modal, #settings-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 3000; display: none; flex-direction: column; padding: 20px; justify-content: center; align-items: center; }
        .shop-content, .settings-content { width: 90%; max-width: 500px; background: #111; border: 2px solid #333; padding: 20px; border-radius: 8px; }
        .shop-grid { display: grid; grid-template-columns: 1fr; gap: 10px; max-height: 50vh; overflow-y: auto; margin-top: 20px; }
        .shop-item { background: #1a1a1a; border: 1px solid #333; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
        .buy-btn { background: #333; color: var(--gold-color); border: 1px solid var(--gold-color); padding: 4px 8px; font-size: 12px; cursor: pointer; }

        .setting-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; color: white; font-family: 'Cinzel'; }
        input[type=range] { width: 60%; cursor: pointer; accent-color: var(--ruined-green); }

        /* YENƒ∞ TOOLTIP TASARIMI */
        #inv-tooltip { 
            position: absolute; background: rgba(10, 12, 15, 0.98); 
            border: 1px solid var(--ruined-green); padding: 12px; 
            font-size: 12px; z-index: 5000; pointer-events: none; 
            display: none; width: 240px; text-align: left; 
            font-family: 'Roboto'; color: #ddd; border-radius: 4px; 
            box-shadow: 0 0 25px rgba(10, 200, 185, 0.2); 
        }
        .tooltip-title { color: var(--ruined-green); font-weight: bold; border-bottom: 1px solid #444; margin-bottom: 8px; padding-bottom: 5px; font-size: 14px; font-family: 'Cinzel'; }
        .tooltip-body { line-height: 1.4; color: #ccc; }
        .tooltip-highlight { color: #f1c40f; font-weight: bold; }
        .tooltip-weakness { color: #e74c3c; font-weight: bold; margin-top: 5px; display: block; }

        .float-text { position: absolute; font-weight: bold; font-size: 20px; animation: floatUp 1.2s ease-out forwards; text-shadow: 2px 2px 0 #000; z-index: 100; pointer-events: none; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-60px); } }
        .text-damage { color: #e74c3c; } .text-heal { color: #2ecc71; } .text-crit { color: #ffcc00; font-size: 26px; } .text-mana { color: #f1c40f; font-size: 16px; } .text-special { color: #a020f0; font-size: 24px; }
        .attacking { animation: bump 0.2s; } @keyframes bump { 50% { transform: scale(1.1); } }
        .damaged { animation: shake 0.4s; } @keyframes shake { 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        
        body.void-active { filter: hue-rotate(270deg) contrast(1.1); }
        
        @media screen and (max-width: 768px) {
            .battle-scene { flex-direction: column-reverse; gap: 20px; }
            .character-box { width: 90%; }
            #enemy-box { justify-content: flex-end; }
            #player-box { justify-content: flex-start; }
            .controls { height: auto; }
            .skills { grid-template-columns: 1fr 1fr; }
            #vs-text { transform: rotate(90deg); margin: 10px; font-size: 1.2rem; }
        }
    </style>
</head>
<body>

    <a href="index.html" class="back-btn" id="ui-menu">‚Üê Menu</a>
    
    <div id="inventory-frame">
        <div class="inv-slot" onclick="useInventoryItem('potion')" onmouseover="showTooltip(this, 'potion')" onmouseout="hideTooltip()">
            üß™ <span class="inv-count" id="count-potion">0</span>
        </div>
        <div class="inv-slot" onclick="useInventoryItem('elixir')" onmouseover="showTooltip(this, 'elixir')" onmouseout="hideTooltip()">
            ‚ö° <span class="inv-count" id="count-elixir">0</span>
        </div>
    </div>

    <div class="top-bar-controls">
        <button class="control-btn-ui" onclick="openSettings()">‚öôÔ∏è</button>
        <button class="control-btn-ui" id="btn-open-shop" onclick="openShop()">üõí SHOP</button>
        <select class="control-btn-ui" id="lang-select" onchange="changeLanguage(this.value)">
            <option value="en">English</option>
            <option value="tr">T√ºrk√ße</option>
        </select>
    </div>

    <div id="inv-tooltip"></div>

    <audio id="bgMusic" loop preload="auto"></audio>

    <div id="settings-modal">
        <div class="settings-content">
            <h2 style="color:var(--ruined-green); text-align:center; border-bottom:1px solid #444;" id="ui-settings-title">SETTINGS</h2>
            <div class="setting-row"><span id="ui-music-vol">Music Volume</span><input type="range" id="vol-music" min="0" max="1" step="0.1" oninput="updateVolume('music', this.value)"></div>
            <div class="setting-row"><span id="ui-sfx-vol">SFX Volume</span><input type="range" id="vol-sfx" min="0" max="1" step="0.1" oninput="updateVolume('sfx', this.value)"></div>
            <button class="start-btn" style="width:100%;" onclick="closeSettings()" id="ui-settings-close">CLOSE</button>
        </div>
    </div>

    <div id="shop-modal">
        <div class="shop-content">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #444;">
                <h2 style="color:var(--gold-color); margin:0;" id="ui-shop-title">SHOP</h2>
                <span id="shop-gold" style="color:white; font-weight:bold;">0 G</span>
            </div>
            <div style="text-align:right; margin:10px 0;"><button id="sell-mode-btn" class="control-btn-ui" onclick="toggleSellMode()">SELL: OFF</button></div>
            <div class="shop-grid" id="shop-container"></div>
            <button class="start-btn" id="ui-shop-close" style="padding:10px; width:100%; margin-top:10px;" onclick="closeShop()">CLOSE</button>
        </div>
    </div>

    <div class="game-wrapper">
        <div id="start-screen">
            <h1 style="color:white; margin-bottom:5px;" id="ui-title">THE RUINED KING</h1>
            <p style="color:#aaa; font-style:italic;" id="ui-subtitle">"She is waiting..."</p>
            <button class="start-btn" id="ui-start-btn" onclick="initGame()">START JOURNEY</button>
        </div>

        <div id="cinematic-dialogue">
            <div class="dialogue-box">
                <div id="cinematic-text">...</div>
                <button class="start-btn" id="ui-next-btn" onclick="nextDialogue()">NEXT</button>
            </div>
        </div>

        <div id="final-choice-overlay" style="display:none;">
            <h2 style="color:#fff;">ISOLDE</h2>
            <p id="isolde-text" style="color:#aaa; font-style:italic;">"My love... let me go."</p>
            <button class="choice-btn btn-attack" onclick="makeChoice('attack')">STRIKE HER DOWN</button>
            <button class="choice-btn btn-surrender" onclick="makeChoice('surrender')">SURRENDER TO LOVE</button>
        </div>

        <div id="overlay">
            <h2 style="color:var(--ruined-green); font-size:2.5rem;" id="ui-victory">VICTORY</h2>
            <button class="start-btn" id="ui-continue-btn" onclick="nextLevel()">CONTINUE</button>
        </div>

        <div class="battle-scene">
            <div class="character-box" id="player-box">
                <div class="info-btn" onmouseover="showCharacterTooltip(this, 'player')" onmouseout="hideTooltip()">i</div>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Viego_0.jpg" class="character-img viego-glow">
                <h2>VIEGO</h2>
                <div class="stat-bar"><div class="fill hp-fill" id="player-hp-bar" style="width: 100%;"></div><span class="bar-text" id="player-hp-text">150/150</span></div>
                <div class="stat-bar" style="margin-top:2px; border-color:var(--power-yellow);"><div class="fill power-fill" id="player-power-bar" style="width: 0%;"></div><span class="bar-text" id="player-power-text" style="color:var(--power-yellow); top:-2px;">0/100</span></div>
            </div>

            <div id="vs-text">VS</div>

            <div class="character-box" id="enemy-box">
                <div class="info-btn" onmouseover="showCharacterTooltip(this, 'enemy')" onmouseout="hideTooltip()">i</div>
                <img src="" class="character-img enemy-glow" id="enemy-img">
                <h2 id="enemy-name">ENEMY</h2>
                <div class="stat-bar"><div class="fill hp-fill" id="enemy-hp-bar" style="width: 100%;"></div><span class="bar-text" id="enemy-hp-text">100/100</span></div>
                <div class="stat-bar" style="margin-top:2px; border-color:var(--power-yellow);"><div class="fill power-fill" id="enemy-power-bar" style="width: 0%;"></div></div>
            </div>
        </div>

        <div class="controls hidden-ui" id="combat-controls">
            <div class="log-box" id="combat-log">...</div>
            <div class="skills">
                <button class="skill-btn" id="btn-basic" onclick="useSkill('basic')">
                    <span class="skill-name" id="skill-name-basic">Blade</span><span class="skill-cost" id="skill-desc-basic">Basic Dmg</span>
                </button>
                <button class="skill-btn" id="btn-q" onclick="useSkill('q')">
                    <span class="skill-name" id="skill-name-q">Ruined King (Q)</span><span class="skill-cost" id="skill-desc-q">30 Dmg | 20 MP</span>
                </button>
                <button class="skill-btn" id="btn-w" onclick="useSkill('w')">
                    <span class="skill-name" id="skill-name-w">Spectral Maw (W)</span><span class="skill-cost" id="skill-desc-w">Stun/Crit | 30 MP</span>
                </button>
                <button class="skill-btn ult-btn" id="btn-r" onclick="useSkill('r')">
                    <span class="skill-name" id="skill-name-r">HEARTBREAKER</span><span class="skill-cost" id="skill-desc-r">FINISHER | 1/Round</span>
                </button>
            </div>
        </div>
    </div>

<script>
    const sounds = { basic1: new Audio('BasicAA_1.wav'), basic2: new Audio('BasicAA_2.wav'), w_skill: new Audio('W_skill.wav') };
    let gameSettings = { musicVolume: 0.3, sfxVolume: 0.5, lang: 'en' };

    function loadSettings() {
        const saved = localStorage.getItem('viegoRPG_settings');
        if (saved) gameSettings = JSON.parse(saved);
        document.getElementById('vol-music').value = gameSettings.musicVolume;
        document.getElementById('vol-sfx').value = gameSettings.sfxVolume;
        document.getElementById('lang-select').value = gameSettings.lang;
        document.getElementById('bgMusic').volume = gameSettings.musicVolume;
        changeLanguage(gameSettings.lang); 
    }
    function saveSettings() { localStorage.setItem('viegoRPG_settings', JSON.stringify(gameSettings)); }
    function updateVolume(type, val) {
        if (type === 'music') { gameSettings.musicVolume = parseFloat(val); document.getElementById('bgMusic').volume = gameSettings.musicVolume; } 
        else { gameSettings.sfxVolume = parseFloat(val); }
        saveSettings();
    }
    function playSfx(type) {
        if (gameSettings.sfxVolume <= 0) return;
        let s = null;
        if (type === 'basic') s = Math.random() > 0.5 ? sounds.basic1 : sounds.basic2;
        else if (type === 'w') s = sounds.w_skill;
        if (s) { s.volume = gameSettings.sfxVolume; s.currentTime=0; s.play().catch(e=>{}); }
    }

    function playMusic() {
        const bgMusic = document.getElementById('bgMusic');
        let track = "";
        const enemy = enemiesData[currentEnemyIndex];
        if (enemy) {
            if (enemy.level <= 10) track = "Tier1.mp3";
            else if (enemy.level <= 25) track = "Tier2.mp3";
            else track = enemy.id + ".mp3"; 
        }
        if (bgMusic.getAttribute('src') !== track) { bgMusic.src = track; bgMusic.volume = gameSettings.musicVolume; bgMusic.play().catch(e => {}); }
    }

    const enemiesData = [
        // TIER 1
        { id: "gangplank", level: 3, hp: 200, maxHp: 200, power: 0, maxPower: 100, damage: 15, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Gangplank_0.jpg" },
        { id: "yorick", level: 7, hp: 280, maxHp: 280, power: 0, maxPower: 100, damage: 20, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Yorick_0.jpg" },
        { id: "akshan", level: 9, hp: 320, maxHp: 320, power: 0, maxPower: 100, damage: 25, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Akshan_0.jpg" },
        { id: "gwen", level: 10, hp: 350, maxHp: 350, power: 0, maxPower: 100, damage: 28, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Gwen_0.jpg" },
        { id: "lucian", level: 12, hp: 400, maxHp: 400, power: 0, maxPower: 100, damage: 30, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Lucian_0.jpg" },
        // TIER 2
        { id: "maokai", level: 14, hp: 600, maxHp: 600, power: 0, maxPower: 100, damage: 25, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Maokai_0.jpg" },
        { id: "elise", level: 16, hp: 550, maxHp: 550, power: 0, maxPower: 100, damage: 35, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Elise_0.jpg" },
        { id: "vladimir", level: 18, hp: 600, maxHp: 600, power: 0, maxPower: 100, damage: 38, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Vladimir_0.jpg" },
        { id: "hecarim", level: 20, hp: 700, maxHp: 700, power: 0, maxPower: 100, damage: 45, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Hecarim_0.jpg" },
        { id: "illaoi", level: 22, hp: 800, maxHp: 800, power: 0, maxPower: 100, damage: 40, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Illaoi_0.jpg" },
        { id: "kalista", level: 24, hp: 750, maxHp: 750, power: 0, maxPower: 100, damage: 50, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Kalista_0.jpg" },
        { id: "ledros", level: 25, hp: 900, maxHp: 900, power: 0, maxPower: 100, damage: 55, img: "https://images.contentstack.io/v3/assets/blt5644e700902b4512/blt569033320f750d42/66f28743e33c87138379434e/Commander_Ledros_T2_Lvl_1.png" }, 
        // TIER 3
        { id: "leblanc", level: 26, hp: 800, maxHp: 800, power: 0, maxPower: 100, damage: 70, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Leblanc_0.jpg" },
        { id: "thresh", level: 28, hp: 1200, maxHp: 1200, power: 0, maxPower: 100, damage: 60, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Thresh_0.jpg" },
        { id: "belveth", level: 30, hp: 1500, maxHp: 1500, power: 0, maxPower: 100, damage: 80, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Belveth_0.jpg" },
        { id: "mordekaiser", level: 35, hp: 2500, maxHp: 2500, power: 0, maxPower: 100, damage: 100, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Mordekaiser_0.jpg" }
    ];

    const translations = {
        en: {
            ui: { menu: "‚Üê Menu", title: "THE RUINED KING", sub: "\"She is waiting...\"", start: "START JOURNEY", next: "NEXT", victory: "VICTORY", continue: "CONTINUE", shopTitle: "RUINED SHOP", shopClose: "CLOSE", shopOpen: "üõí SHOP", sellOff: "SELL: OFF", sellOn: "SELL: ON", buy: "BUY", sell: "SELL", settingsTitle: "SETTINGS", settingsClose: "CLOSE", musicVol: "Music Volume", sfxVol: "SFX Volume" },
            skills: { basic: {name: "Basic Attack", desc: "Dmg | +MP"}, q: {name: "Blade of the Ruined King", desc: "Dmg | 20 MP"}, w: {name: "Spectral Maw", desc: "Crit | 30 MP"}, r: {name: "HEARTBREAKER", desc: "EXECUTE | 1/Round"} },
            logs: { start: "Battle Started!", pStrike: "Viego strikes!", pQ: "Blade of the Ruined King hits!", pW: "Spectral Maw hits! Next hit CRITS!", pR: "HEARTBREAKER!", enemyAtk: "attacks for", defeat: "DEFEAT...", usedPot: "Used Potion (+50 HP)", usedElix: "Used Elixir (+50 Power)", won: "Game Over! You conquered all.",
            gpQ: "Gangplank uses Parrrley! CRIT!", gpW: "Gangplank eats Orange!", yorQ: "Yorick's Last Rites!", yorHeal: "Yorick heals from the Mist!", lbClone: "LeBlanc Mirror Image! Miss!", threshHook: "Death Sentence! STUNNED!", belvethTrue: "Bel'Veth transforms into TRUE FORM!", mordeRealm: "Welcome to the DEATH REALM!" },
            hints: {
                viego: "Passive: Hit to gain Power.<br>Ult: Executes. Uses NO Power but 1 use/round.",
                gangplank: "Ability: High Damage at 20 Power.<br>Weakness: Heals at Low HP. Burst him down!",
                yorick: "Ability: Sustains through combat.<br>Strategy: Keep your HP high.",
                akshan: "Ability: Quick attacks.<br>Strategy: Standard duel.",
                gwen: "Ability: Immune to some effects.<br>Strategy: Aggressive play.",
                lucian: "Ability: Double shot potential.<br>Strategy: Outlast his burst.",
                maokai: "Ability: Tanky and heals.<br>Strategy: Use Q to sustain.",
                elise: "Ability: Stuns and bites.<br>Strategy: Save W for big hits.",
                vladimir: "Ability: Drains your HP.<br>Strategy: Use potions early.",
                hecarim: "Ability: Ramps up damage.<br>Strategy: Kill him fast.",
                illaoi: "Ability: Test of Spirit.<br>Strategy: Don't let her heal.",
                kalista: "Ability: Spears stack damage.<br>Strategy: finish quickly.",
                ledros: "Ability: Cuts HP by %. <br>Strategy: High HP won't save you.",
                leblanc: "Ability: Mirror Image (Miss chance).<br>Strategy: Pray to hit.",
                thresh: "Ability: STUNS at 60 Power.<br>Strategy: Watch his Power bar!",
                belveth: "Ability: TRUE FORM at death.<br>Strategy: Save Ult for Form 2.",
                mordekaiser: "Ability: DEATH REALM at 50% HP.<br>Strategy: Survive the Realm."
            },
            enemies: {
                gangplank: { name: "Gangplank", intro: ["Gangplank: This is my city!", "Viego: I will take everything."] },
                yorick: { name: "Yorick", intro: ["Yorick: The Mist is a curse.", "Viego: It is my love."] },
                akshan: { name: "Akshan", intro: ["Akshan: Not another undead tyrant...", "Viego: Step aside, pest."] },
                gwen: { name: "Gwen", intro: ["Gwen: I remember her smile...", "Viego: You are nothing but a doll!"] },
                lucian: { name: "Lucian & Senna", intro: ["Lucian: For Senna!", "Viego: For Isolde!"] },
                maokai: { name: "Maokai", intro: ["Maokai: You poisoned the waters!", "Viego: I gave them purpose."] },
                elise: { name: "Elise", intro: ["Elise: The Spider God hungers.", "Viego: Even gods bow to me."] },
                vladimir: { name: "Vladimir", intro: ["Vladimir: Ah, the romantic fool.", "Viego: Watch your tongue, uncle."] },
                hecarim: { name: "Hecarim", intro: ["Hecarim: War is eternal!", "Viego: Serve your King, Hecarim."] },
                illaoi: { name: "Illaoi", intro: ["Illaoi: You are stagnant.", "Viego: My love is timeless."] },
                kalista: { name: "Kalista", intro: ["Kalista: Betrayer...", "Viego: I did what I had to do!"] },
                ledros: { name: "Ledros", intro: ["Ledros: End this madness.", "Viego: Only when she returns."] },
                leblanc: { name: "LeBlanc", intro: ["LeBlanc: Are you real?", "Viego: I am the end of your schemes."] },
                thresh: { name: "Thresh", intro: ["Thresh: Such delectable agony.", "Viego: Do not test my patience."] },
                belveth: { name: "Bel'Veth", intro: ["Bel'Veth: I will consume your world.", "Viego: Not before I find her."] },
                mordekaiser: { name: "Mordekaiser", intro: ["Mordekaiser: Iron stands eternal.", "Viego: Ruin consumes all."] }
            }
        },
        tr: {
            ui: { menu: "‚Üê Men√º", title: "MAHVOLMU≈û KRAL", sub: "\"O beni bekliyor...\"", start: "YOLCULUƒûA BA≈ûLA", next: "ƒ∞LERƒ∞", victory: "ZAFER", continue: "DEVAM ET", shopTitle: "MAHVOLMU≈û MARKET", shopClose: "KAPAT", shopOpen: "üõí MARKET", sellOff: "SATI≈û: KAPALI", sellOn: "SATI≈û: A√áIK", buy: "SATIN AL", sell: "SAT", settingsTitle: "AYARLAR", settingsClose: "KAPAT", musicVol: "M√ºzik Sesi", sfxVol: "Efekt Sesi" },
            skills: { basic: {name: "Temel Saldƒ±rƒ±", desc: "Hasar | +G√º√ß"}, q: {name: "Mahvolmu≈ü Kralƒ±n Kƒ±lƒ±cƒ±", desc: "Hasar | 20 G√º√ß"}, w: {name: "Hortlaƒüƒ±n Pen√ßesi", desc: "Kritik | 30 G√º√ß"}, r: {name: "KALP KIRAN", desc: "Bƒ∞Tƒ∞Rƒ∞Cƒ∞ | 1/Tur"} },
            logs: { start: "Sava≈ü Ba≈üladƒ±!", pStrike: "Viego saldƒ±rdƒ±!", pQ: "Mahvolmu≈ü Kralƒ±n Kƒ±lƒ±cƒ±!", pW: "Hayalet Aƒüƒ±z √ßarptƒ±! Kritik hazƒ±r!", pR: "KALP KIRAN!", enemyAtk: "saldƒ±rdƒ± ve vurdu:", defeat: "YENƒ∞LGƒ∞...", usedPot: "ƒ∞ksir ƒ∞√ßildi (+50 Can)", usedElix: "Elixir ƒ∞√ßildi (+50 G√º√ß)", won: "Oyun Bitti! Hepsini fethettin.",
            gpQ: "Gangplank √áakaralmaz kullandƒ±! KRƒ∞Tƒ∞K!", gpW: "Gangplank Portakal yedi!", yorQ: "Yorick Son Dua vurdu!", yorHeal: "Yorick Sisten iyile≈üti!", lbClone: "LeBlanc Ayna G√∂r√ºnt√ºs√º! Iskaladƒ±n!", threshHook: "√ñl√ºm Cezasƒ±! SERSEMLEDƒ∞N!", belvethTrue: "Bel'Veth GER√áEK FORMUNA d√∂n√º≈üt√º!", mordeRealm: "√ñL√úLER ALEMƒ∞NE Ho≈ügeldin!" },
            hints: {
                viego: "Pasif: Vurduk√ßa G√º√ß kazan.<br>Ulti: ƒ∞nfaz eder. G√º√ß ƒ∞STEMEZ ama turda 1 kere.",
                gangplank: "Yetenek: 20 G√º√ßte y√ºksek hasar.<br>Zayƒ±flƒ±k: Canƒ± azken iyile≈üir. Hƒ±zlƒ± bitir!",
                yorick: "Yetenek: Sisten g√º√ß alƒ±r.<br>Strateji: Canƒ±nƒ± y√ºksek tut.",
                akshan: "Yetenek: Hƒ±zlƒ± saldƒ±rƒ±lar.<br>Strateji: Standart d√ºello.",
                gwen: "Yetenek: Kutsal Sis.<br>Strateji: Agresif oyna.",
                lucian: "Yetenek: √áifte vuru≈ü.<br>Strateji: Hasarƒ±nƒ± kar≈üƒ±la.",
                maokai: "Yetenek: Tank ve iyile≈üme.<br>Strateji: Q ile can yenile.",
                elise: "Yetenek: √ñr√ºmcek ƒ±sƒ±rƒ±ƒüƒ±.<br>Strateji: W yeteneƒüini sakla.",
                vladimir: "Yetenek: Kan emer.<br>Strateji: ƒ∞ksirlerini erken kullan.",
                hecarim: "Yetenek: Sava≈ü uzadƒ±k√ßa g√º√ßlenir.<br>Strateji: Hƒ±zlƒ± √∂ld√ºr.",
                illaoi: "Yetenek: Ruh Testi.<br>Strateji: ƒ∞yile≈ümesine izin verme.",
                kalista: "Yetenek: Mƒ±zraklar birikir.<br>Strateji: Uzun sava≈ütan ka√ßƒ±n.",
                ledros: "Yetenek: Canƒ± % ile vurur.<br>Strateji: Y√ºksek can seni kurtarmaz.",
                leblanc: "Yetenek: Ayna G√∂r√ºnt√ºs√º (Iska ≈üansƒ±).<br>Strateji: ≈ûansƒ±na g√ºven.",
                thresh: "Yetenek: 60 G√º√ßte SERSEMLETƒ∞R.<br>Strateji: G√º√ß barƒ±nƒ± takip et!",
                belveth: "Yetenek: √ñl√ºnce GER√áEK FORMA ge√ßer.<br>Strateji: Ultini 2. forma sakla.",
                mordekaiser: "Yetenek: %50 Canda √ñL√úLER ALEMƒ∞.<br>Strateji: Alemde hayatta kal."
            },
            enemies: {
                gangplank: { name: "Gangplank", intro: ["Gangplank: Bu ≈üehir benim!", "Viego: Her ≈üeyi alacaƒüƒ±m."] },
                yorick: { name: "Yorick", intro: ["Yorick: Kara Sis bir lanet.", "Viego: O benim a≈ükƒ±m."] },
                akshan: { name: "Akshan", intro: ["Akshan: Yine mi bir √∂l√º tiran...", "Viego: √áekil yolumdan b√∂cek."] },
                gwen: { name: "Gwen", intro: ["Gwen: Onun g√ºl√º≈ü√ºn√º hatƒ±rlƒ±yorum...", "Viego: Sen sadece bir oyuncaksƒ±n!"] },
                lucian: { name: "Lucian & Senna", intro: ["Lucian: Senna i√ßin!", "Viego: Isolde i√ßin!"] },
                maokai: { name: "Maokai", intro: ["Maokai: Sularƒ± zehirledin!", "Viego: Onlara ama√ß verdim."] },
                elise: { name: "Elise", intro: ["Elise: √ñr√ºmcek Tanrƒ± a√ß.", "Viego: Tanrƒ±lar bile bana boyun eƒüer."] },
                vladimir: { name: "Vladimir", intro: ["Vladimir: Ah, romantik aptal.", "Viego: Dilini koparƒ±rƒ±m amca."] },
                hecarim: { name: "Hecarim", intro: ["Hecarim: Sava≈ü sonsuzdur!", "Viego: Kralƒ±na hizmet et Hecarim."] },
                illaoi: { name: "Illaoi", intro: ["Illaoi: Sen durgunsun.", "Viego: A≈ükƒ±m zamansƒ±z."] },
                kalista: { name: "Kalista", intro: ["Kalista: Hain...", "Viego: Yapmam gerekeni yaptƒ±m!"] },
                ledros: { name: "Ledros", intro: ["Ledros: Bu deliliƒüi bitir.", "Viego: Sadece o geri d√∂nd√ºƒü√ºnde."] },
                leblanc: { name: "LeBlanc", intro: ["LeBlanc: Ger√ßek misin?", "Viego: Ben planlarƒ±nƒ±n sonuyum."] },
                thresh: { name: "Thresh", intro: ["Thresh: Ne lezzetli bir ƒ±zdƒ±rap.", "Viego: Sabrƒ±mƒ± sƒ±nama."] },
                belveth: { name: "Bel'Veth", intro: ["Bel'Veth: D√ºnyanƒ± t√ºketeceƒüim.", "Viego: Onu bulmadan asla."] },
                mordekaiser: { name: "Mordekaiser", intro: ["Mordekaiser: Demir ebedidir.", "Viego: Mahvolu≈ü her ≈üeyi yutar."] }
            }
        }
    };

    let player = { hp: 150, maxHp: 150, power: 0, maxPower: 100, potions: 2, elixirs: 1, gold: 0, level: 1, ultUsed: false, stunned: false };
    let currentEnemyIndex = 0;
    let turn = "player";
    let dialogueQueue = [];
    let dialogueIndex = 0;
    let isSellMode = false;
    let mordeRealmActive = false;

    function initGame() {
        document.getElementById('start-screen').style.display = 'none';
        playMusic();
        loadLevel(0);
    }

    function loadLevel(index) {
        currentEnemyIndex = index;
        const t = translations[gameSettings.lang];

        if (index >= enemiesData.length) {
            document.getElementById('final-choice-overlay').style.display = 'flex';
            document.getElementById('combat-controls').classList.add('hidden-ui');
            return; 
        }
        
        const enemy = enemiesData[index];
        enemy.hp = enemy.maxHp; 
        enemy.power = 0; 
        enemy.wUsed = false; 
        enemy.form = 1; 
        mordeRealmActive = false;
        document.body.className = ""; 
        
        player.ultUsed = false;
        player.stunned = false;
        player.power = 0; 
        
        document.getElementById('enemy-name').innerText = `${t.enemies[enemy.id].name.toUpperCase()} (LVL ${enemy.level})`;
        document.getElementById('enemy-img').src = enemy.img;
        
        playMusic();
        updateUI();
        
        dialogueQueue = t.enemies[enemy.id].intro;
        dialogueIndex = 0;
        document.getElementById('combat-controls').classList.add('hidden-ui'); 
        document.getElementById('cinematic-dialogue').style.display = 'flex';
        updateDialogueText();
    }

    function useSkill(type) {
        if (turn !== 'player' || player.stunned) return;
        const t = translations[gameSettings.lang];
        const enemy = enemiesData[currentEnemyIndex];
        let dmg = 0; let msg = "";

        let pGain = Math.floor(Math.random()*11)+5;
        player.power = Math.min(100, player.power + pGain);
        showFloat(document.getElementById('player-box'), `+${pGain} MP`, 'mana');

        if (type === 'basic') { playSfx('basic'); dmg = 15 + (player.level * 5); msg = t.logs.pStrike; }
        else if (type === 'q') { player.power -= 20; playSfx('basic'); dmg = 30 + (player.level * 8); let heal = 10; player.hp = Math.min(player.maxHp, player.hp + heal); showFloat(document.getElementById('player-box'), `+${heal}`, 'heal'); msg = t.logs.pQ; }
        else if (type === 'w') { player.power -= 30; playSfx('w'); dmg = 45 + (player.level * 10); msg = t.logs.pW; }
        else if (type === 'r') { player.ultUsed = true; dmg = 100 + (player.level * 20); msg = t.logs.pR; document.body.classList.add('death-realm-active'); setTimeout(() => {if(!mordeRealmActive) document.body.classList.remove('death-realm-active')}, 500); }

        player.power = Math.min(100, player.power);
        
        if (enemy.id === 'leblanc' && enemy.hp < enemy.maxHp * 0.4 && Math.random() > 0.5) {
            dmg = 0; msg = t.logs.lbClone;
            showFloat(document.getElementById('enemy-box'), "MISS", 'text-mana');
        }

        enemy.hp -= dmg;
        if(dmg > 0) {
            showFloat(document.getElementById('enemy-box'), `-${dmg}`, 'damage');
            document.getElementById('enemy-box').classList.add('damaged');
            setTimeout(() => document.getElementById('enemy-box').classList.remove('damaged'), 400);
        }
        
        document.getElementById('player-box').classList.add('attacking');
        setTimeout(() => document.getElementById('player-box').classList.remove('attacking'), 200);
        
        log(msg);
        updateUI();

        if (enemy.id === 'belveth' && enemy.hp <= 0 && enemy.form === 1) {
            enemy.form = 2;
            enemy.hp = Math.floor(enemy.maxHp * 0.6); 
            enemy.damage = Math.floor(enemy.damage * 1.5);
            document.body.classList.add('void-active');
            log(t.logs.belvethTrue);
            updateUI();
            turn = "enemy"; 
            setTimeout(enemyTurn, 1500);
            return;
        }

        if (enemy.hp <= 0) { enemy.hp = 0; updateUI(); turn = 'none'; setTimeout(victory, 1000); } 
        else { turn = "enemy"; updateUI(); setTimeout(enemyTurn, 1000); }
    }

    function enemyTurn() {
        const t = translations[gameSettings.lang];
        const enemy = enemiesData[currentEnemyIndex];
        const enemyName = t.enemies[enemy.id].name;
        
        let eGain = Math.floor(Math.random()*11)+5;
        enemy.power = Math.min(100, enemy.power + eGain);
        showFloat(document.getElementById('enemy-box'), `+${eGain} MP`, 'mana');
        updateUI();

        if (enemy.id === 'mordekaiser' && enemy.hp < enemy.maxHp * 0.5 && !mordeRealmActive) {
            mordeRealmActive = true;
            document.body.classList.add('death-realm-active');
            enemy.damage += 20;
            log(t.logs.mordeRealm);
        }

        if (enemy.id === 'gangplank') {
            if (enemy.hp < (enemy.maxHp * 0.4) && enemy.power >= 30 && !enemy.wUsed) {
                enemy.power = 0; enemy.hp = Math.min(enemy.maxHp, enemy.hp + 50); enemy.wUsed = true;
                showFloat(document.getElementById('enemy-box'), "+50", 'heal'); log(t.logs.gpW);
                endEnemyTurn(); return; 
            }
            if (enemy.power >= 20) {
                enemy.power = 0;
                let dmg = Math.floor((enemy.damage + 5) * 1.75);
                performAttack(dmg, t.logs.gpQ, 'crit'); return;
            }
        }

        if (enemy.id === 'yorick' && enemy.hp < enemy.maxHp * 0.3 && enemy.power >= 40) {
            enemy.power = 0;
            let dmg = enemy.damage;
            let heal = 40;
            enemy.hp += heal;
            showFloat(document.getElementById('enemy-box'), `+${heal}`, 'heal');
            performAttack(dmg, t.logs.yorHeal); return;
        }

        if (enemy.id === 'thresh' && enemy.power >= 60) {
            enemy.power = 0;
            let dmg = enemy.damage + 10;
            player.stunned = true; 
            performAttack(dmg, t.logs.threshHook, 'special'); 
            return;
        }

        performAttack(enemy.damage + Math.floor(Math.random()*10), `${enemyName} ${t.logs.enemyAtk}`);
    }

    function performAttack(dmg, msg, type = 'damage') {
        player.hp -= dmg;
        showFloat(document.getElementById('player-box'), `-${dmg}`, type);
        document.getElementById('enemy-box').classList.add('attacking');
        setTimeout(() => document.getElementById('enemy-box').classList.remove('attacking'), 200);
        document.getElementById('player-box').classList.add('damaged');
        setTimeout(() => document.getElementById('player-box').classList.remove('damaged'), 400);
        log(`${msg} ${dmg}.`);
        updateUI();
        
        if (player.hp <= 0) { player.hp = 0; updateUI(); log(translations[gameSettings.lang].logs.defeat); setTimeout(() => location.reload(), 2000); }
        else { endEnemyTurn(); }
    }

    function endEnemyTurn() {
        if (player.stunned) {
            log("STUNNED! Turn skipped.");
            player.stunned = false;
            setTimeout(enemyTurn, 1500); 
        } else {
            turn = "player";
            updateUI();
        }
    }

    function nextLevel() {
        document.getElementById('overlay').style.display = 'none';
        currentEnemyIndex++; 
        loadLevel(currentEnemyIndex);
    }

    function victory() {
        document.getElementById('overlay').style.display = 'flex';
        player.gold += 100;
        player.level++;
        player.maxHp += 20;
        player.hp = player.maxHp;
    }

    function updateDialogueText() {
        if (dialogueIndex < dialogueQueue.length) { document.getElementById('cinematic-text').innerText = dialogueQueue[dialogueIndex]; } 
        else {
            document.getElementById('cinematic-dialogue').style.display = 'none';
            document.getElementById('combat-controls').classList.remove('hidden-ui');
            log(translations[gameSettings.lang].logs.start);
            turn = "player"; updateUI();
        }
    }
    function nextDialogue() { dialogueIndex++; updateDialogueText(); }
    
    function changeLanguage(lang) { gameSettings.lang = lang; saveSettings(); updateTexts(); }
    function updateTexts() {
        const t = translations[gameSettings.lang];
        document.getElementById('ui-menu').innerText = t.ui.menu; document.getElementById('ui-title').innerText = t.ui.title; document.getElementById('ui-subtitle').innerText = t.ui.sub; document.getElementById('ui-start-btn').innerText = t.ui.start; document.getElementById('ui-next-btn').innerText = t.ui.next; document.getElementById('ui-victory').innerText = t.ui.victory; document.getElementById('ui-continue-btn').innerText = t.ui.continue; document.getElementById('ui-shop-title').innerText = t.ui.shopTitle; document.getElementById('ui-shop-close').innerText = t.ui.shopClose; document.getElementById('btn-open-shop').innerText = t.ui.shopOpen; document.getElementById('sell-mode-btn').innerText = isSellMode ? t.ui.sellOn : t.ui.sellOff; document.getElementById('ui-settings-title').innerText = t.ui.settingsTitle; document.getElementById('ui-settings-close').innerText = t.ui.settingsClose; document.getElementById('ui-music-vol').innerText = t.ui.musicVol; document.getElementById('ui-sfx-vol').innerText = t.ui.sfxVol;
        document.getElementById('skill-name-basic').innerText = t.skills.basic.name; document.getElementById('skill-name-q').innerText = t.skills.q.name; document.getElementById('skill-name-w').innerText = t.skills.w.name; document.getElementById('skill-name-r').innerText = t.skills.r.name;
        if(currentEnemyIndex < enemiesData.length) {
            const enemy = enemiesData[currentEnemyIndex];
            document.getElementById('enemy-name').innerText = `${t.enemies[enemy.id].name.toUpperCase()} (LVL ${enemy.level})`;
        }
        updateUI();
    }

    function updateUI() {
        const enemy = enemiesData[currentEnemyIndex] || {hp:0, maxHp:100, power:0, maxPower:100};
        const pHpPct = (player.hp / player.maxHp) * 100; document.getElementById('player-hp-bar').style.width = pHpPct + "%"; document.getElementById('player-hp-text').innerText = `${Math.ceil(player.hp)}/${player.maxHp}`;
        const pMpPct = (player.power / player.maxPower) * 100; document.getElementById('player-power-bar').style.width = pMpPct + "%"; document.getElementById('player-power-text').innerText = `${Math.floor(player.power)}/${player.maxPower}`;
        const eHpPct = (enemy.hp / enemy.maxHp) * 100; document.getElementById('enemy-hp-bar').style.width = eHpPct + "%"; document.getElementById('enemy-hp-text').innerText = `${Math.ceil(enemy.hp)}/${enemy.maxHp}`;
        const eMpPct = (enemy.power / enemy.maxPower) * 100; document.getElementById('enemy-power-bar').style.width = eMpPct + "%";
        document.getElementById('count-potion').innerText = player.potions; document.getElementById('count-elixir').innerText = player.elixirs;
        
        let basicDmg = 15 + (player.level * 5); let qDmg = 30 + (player.level * 8); let wDmg = 45 + (player.level * 10); let rDmg = 100 + (player.level * 20);
        document.getElementById('skill-desc-basic').innerText = `~${basicDmg} Dmg | +10 MP`; document.getElementById('skill-desc-q').innerText = `~${qDmg} Dmg | 20 MP`; document.getElementById('skill-desc-w').innerText = `~${wDmg} Dmg | 30 MP`; document.getElementById('skill-desc-r').innerText = `~${rDmg} Dmg | 1/Round`;
        
        const isPlayerTurn = (turn === 'player' && !player.stunned);
        document.getElementById('btn-basic').disabled = !isPlayerTurn; document.getElementById('btn-q').disabled = !isPlayerTurn || player.power < 20; document.getElementById('btn-w').disabled = !isPlayerTurn || player.power < 30; document.getElementById('btn-r').disabled = !isPlayerTurn || player.ultUsed;
    }

    function makeChoice(choice) {
        if(choice === 'attack') alert("You chose vengeance. The Ruination continues forever.");
        else alert("You chose peace. The Mist fades, and Viego finally rests.");
        location.reload();
    }

    function log(msg) { const b = document.getElementById('combat-log'); b.innerHTML = `> ${msg}<br>` + b.innerHTML; }
    function showFloat(target, text, type) { const el = document.createElement('div'); el.className = `float-text text-${type}`; el.innerText = text; const rect = target.getBoundingClientRect(); el.style.left = (rect.left + rect.width/2 - 20) + 'px'; el.style.top = rect.top + 'px'; document.body.appendChild(el); setTimeout(() => el.remove(), 1000); }
    
    function showCharacterTooltip(el, who) {
        const tip = document.getElementById('inv-tooltip'); const t = translations[gameSettings.lang];
        let html = "";
        
        // Show specific hints for each character
        if (who === 'player') {
            html = `<div class="tooltip-title">VIEGO</div>${t.hints.viego}`;
        } else {
            const enemy = enemiesData[currentEnemyIndex];
            const enemyName = t.enemies[enemy.id].name.toUpperCase();
            // Get hint for specific enemy ID
            const hint = t.hints[enemy.id] || "No info.";
            
            html = `<div class="tooltip-title">${enemyName}</div>
                    <div class="tooltip-body">${hint}</div>`;
        }
        tip.innerHTML = html; tip.style.display = 'block';
        const rect = el.getBoundingClientRect(); let left = rect.left + 30; if (left > window.innerWidth - 200) left = rect.left - 220; tip.style.top = (rect.bottom + 5) + 'px'; tip.style.left = left + 'px';
    }
    
    function showTooltip(el, type) {
        const tip = document.getElementById('inv-tooltip'); const t = translations[gameSettings.lang];
        let text = "", title = ""; if (type === 'potion') { title = t.tooltips.potion.name; text = t.tooltips.potion.desc; } else if (type === 'elixir') { title = t.tooltips.elixir.name; text = t.tooltips.elixir.desc; }
        tip.innerHTML = `<div class="tooltip-title">${title}</div>${text}`; tip.style.display = 'block'; const rect = el.getBoundingClientRect(); tip.style.left = (rect.right + 10) + 'px'; tip.style.top = rect.top + 'px';
    }
    function hideTooltip() { document.getElementById('inv-tooltip').style.display = 'none'; }
    function openSettings() { document.getElementById('settings-modal').style.display = 'flex'; }
    function closeSettings() { document.getElementById('settings-modal').style.display = 'none'; }
    function toggleSellMode() { isSellMode = !isSellMode; updateTexts(); openShop(); }
    function openShop() { const modal = document.getElementById('shop-modal'); const container = document.getElementById('shop-container'); document.getElementById('shop-gold').innerText = player.gold + " G"; const t = translations[gameSettings.lang]; const items = [ { id: 'potion', name: t.tooltips.potion.name, price: 50, icon: "üß™" }, { id: 'elixir', name: t.tooltips.elixir.name, price: 50, icon: "‚ö°" }, { id: 'sword', name: t.tooltips.sword.name, price: 300, icon: "‚öîÔ∏è" } ]; container.innerHTML = ""; items.forEach(item => { const div = document.createElement('div'); div.className = 'shop-item'; let btnText = isSellMode ? `${t.ui.sell} ${item.price/2}G` : `${t.ui.buy} ${item.price}G`; div.innerHTML = `<div style="color:white;">${item.icon} ${item.name}</div><button class="buy-btn" onclick="handleShop('${item.id}', ${item.price})">${btnText}</button>`; container.appendChild(div); }); modal.style.display = 'flex'; }
    function handleShop(id, price) { if (isSellMode) { if (id === 'potion' && player.potions > 0) { player.potions--; player.gold += price/2; } else if (id === 'elixir' && player.elixirs > 0) { player.elixirs--; player.gold += price/2; } openShop(); updateUI(); } else { if (player.gold >= price) { player.gold -= price; if (id === 'potion') player.potions++; if (id === 'elixir') player.elixirs++; openShop(); updateUI(); } else { alert(translations[gameSettings.lang].logs.notEnoughGold); } } }
    function closeShop() { document.getElementById('shop-modal').style.display = 'none'; isSellMode = false; updateTexts(); }
    window.onload = function() { loadSettings(); }
</script>
</body>
</html>
