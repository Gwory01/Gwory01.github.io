<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Viego: The Ruined King RPG</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

        :root {
            --ruined-green: #0ac8b9;
            --dark-bg: #05080a;
            --power-yellow: #f1c40f;
            --hp-red: #c0392b;
            --crit-color: #ffcc00;
            --heal-color: #2ecc71;
            --gold-color: #f39c12;
            --sell-color: #e74c3c;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--dark-bg);
            background-image: linear-gradient(rgba(0,0,0,0.85), rgba(0,20,20,0.95)), url('https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Viego_0.jpg');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: #e0e0e0; font-family: 'Cinzel', serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            width: 100vw; height: 100dvh;
            margin: 0; padding: 0;
            overflow: hidden; 
            user-select: none;
            position: relative;
        }
        body.death-realm-active { filter: grayscale(100%) sepia(30%) hue-rotate(90deg) contrast(1.1); box-shadow: inset 0 0 150px #0ac8b9; }

        #mist-canvas-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; mix-blend-mode: screen; opacity: 0.6; }

        /* --- UI GENEL --- */
        .game-wrapper { 
            width: 100%; height: 100%; max-width: 1000px;
            background: rgba(8, 10, 12, 0.85); 
            display: flex; flex-direction: column; 
            position: relative; z-index: 10;
        }

        .info-btn { 
            position: absolute; top: 10px; right: 20px; 
            width: 28px; height: 28px; 
            background: #000; border: 2px solid var(--ruined-green); 
            color: var(--ruined-green); border-radius: 50%; 
            font-weight: bold; cursor: help; z-index: 50; 
            display: flex; justify-content: center; align-items: center; font-size: 16px;
            box-shadow: 0 0 10px var(--ruined-green);
        }
        .info-btn:active { transform: scale(0.9); }

        .top-bar-controls { 
            position: absolute; top: 10px; right: 10px; z-index: 100;
            display: flex; gap: 10px; align-items: center; 
        }
        .control-btn-ui { background: rgba(0,0,0,0.7); color: white; border: 1px solid #555; padding: 8px 12px; border-radius: 4px; font-size: 12px; cursor: pointer; }
        .back-btn { position: absolute; top: 10px; left: 10px; z-index: 100; color: var(--ruined-green); text-decoration: none; border: 1px solid var(--ruined-green); padding: 8px 12px; background: rgba(0,0,0,0.8); font-size: 12px; border-radius: 4px; }

        /* SAVA≈û ALANI */
        .battle-scene { flex-grow: 1; display: flex; justify-content: space-evenly; align-items: center; position: relative; width: 100%; }
        .character-box { width: 45%; max-width: 350px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .character-img { 
            width: 18vh; height: 18vh; max-width: 180px; max-height: 180px; min-width: 120px; min-height: 120px;
            object-fit: cover; object-position: center top; border-radius: 50%; border: 3px solid #444; 
            box-shadow: 0 0 20px rgba(0,0,0,0.5); transition: all 0.2s; 
        }
        .viego-glow { border-color: var(--ruined-green); box-shadow: 0 0 20px rgba(10, 200, 185, 0.3); }
        .enemy-glow { border-color: #d63031; box-shadow: 0 0 20px rgba(214, 48, 49, 0.3); }
        .character-box h2 { font-size: 1.2rem; margin: 10px 0 5px 0; text-shadow: 2px 2px 0 #000; letter-spacing: 1px; }
        
        .stat-bar { width: 80%; height: 10px; background: #111; margin-top: 5px; border: 1px solid #444; position: relative; border-radius: 2px; }
        .fill { height: 100%; transition: width 0.4s ease-out; } .hp-fill { background-color: var(--hp-red); } 
        .power-fill { background-color: var(--power-yellow); box-shadow: 0 0 5px var(--power-yellow); }
        .bar-text { font-size: 9px; font-weight: bold; position: absolute; top: -15px; right: 0; color: #aaa; }
        #vs-text { font-size: 1.5rem; color: #444; font-weight: bold; }

        .controls { background: rgba(0,0,0,0.6); border-top: 2px solid var(--ruined-green); padding: 10px; display: flex; flex-direction: column; gap: 10px; height: auto; min-height: 25vh; transition: opacity 0.5s; }
        .hidden-ui { opacity: 0; pointer-events: none; }
        .skills { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; flex-grow: 1; }
        .skill-btn { background: #111; border: 1px solid #333; color: #aaa; font-family: 'Cinzel'; padding: 5px; border-radius: 4px; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: 0.2s; }
        .skill-btn:active { background: #222; transform: scale(0.98); }
        
        /* DISABLED STATE (G√ú√á YETERSƒ∞ZSE) */
        .skill-btn:disabled { 
            opacity: 0.4; 
            cursor: not-allowed; 
            filter: grayscale(100%); 
            border-color: #333; 
            background: #000;
        }
        
        .skill-name { font-weight: bold; font-size: 0.75rem; margin-bottom: 2px; color: #ddd; text-align: center; }
        .skill-cost { font-size: 0.65rem; color: #2ecc71; text-align: center; font-family: 'Roboto', sans-serif; }
        .skill-btn:disabled .skill-cost { color: #555; } /* Yetersiz g√º√ßte yazƒ± da kararsƒ±n */
        
        .ult-btn { border-color: var(--ruined-green); color: var(--ruined-green); }
        .ult-btn:disabled { border-color: #333; color: #555; }

        .log-box { height: 40px; background: rgba(0,0,0,0.5); border: 1px solid #333; font-size: 0.8rem; color: #ccc; padding: 5px; overflow-y: auto; font-family: 'Roboto', sans-serif; text-align: center; }

        #inventory-frame { position: absolute; top: 60px; left: 10px; z-index: 20; display: flex; flex-direction: column; gap: 10px; }
        .inv-slot { width: 40px; height: 40px; background: rgba(0,0,0,0.8); border: 1px solid #444; border-radius: 4px; display: flex; justify-content: center; align-items: center; font-size: 20px; cursor: pointer; }
        .inv-count { position: absolute; bottom: 0; right: 0; font-size: 10px; background: black; color: white; padding: 1px 3px; }

        #start-screen, #cinematic-dialogue, #overlay, #final-choice-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 200; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; }
        #overlay, #final-choice-overlay, #cinematic-dialogue { display: none; }
        .dialogue-box { background: #111; border: 2px solid var(--ruined-green); padding: 20px; width: 95%; max-width: 600px; border-radius: 8px; }
        #cinematic-text { font-size: 1rem; line-height: 1.5; color: white; margin-bottom: 20px; font-style: italic; min-height: 50px; font-family: 'Roboto', sans-serif; }
        .start-btn { background: transparent; border: 2px solid var(--ruined-green); color: var(--ruined-green); padding: 15px 40px; font-family: 'Cinzel'; font-size: 1.2rem; cursor: pointer; margin-top: 20px; transition: 0.3s; }
        .start-btn:active { background: var(--ruined-green); color: black; }

        #shop-modal, #settings-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 3000; display: none; flex-direction: column; padding: 20px; justify-content: center; align-items: center; }
        .shop-content, .settings-content { width: 90%; max-width: 500px; background: #111; border: 2px solid #333; padding: 20px; border-radius: 8px; }
        .shop-grid { display: grid; grid-template-columns: 1fr; gap: 10px; max-height: 50vh; overflow-y: auto; margin-top: 20px; }
        .shop-item { background: #1a1a1a; border: 1px solid #333; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
        .buy-btn { background: #333; color: var(--gold-color); border: 1px solid var(--gold-color); padding: 4px 8px; font-size: 12px; cursor: pointer; }

        .setting-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; color: white; font-family: 'Cinzel'; }
        input[type=range] { width: 60%; cursor: pointer; accent-color: var(--ruined-green); }

        #inv-tooltip { position: absolute; background: rgba(10, 12, 15, 0.98); border: 1px solid var(--ruined-green); padding: 10px; font-size: 12px; z-index: 5000; pointer-events: none; display: none; width: 220px; text-align: left; font-family: 'Roboto'; color: #ddd; border-radius: 4px; box-shadow: 0 0 20px rgba(0,0,0,0.8); }
        .tooltip-title { color: var(--ruined-green); font-weight: bold; border-bottom: 1px solid #444; margin-bottom: 5px; padding-bottom: 5px; font-size: 14px; }

        .float-text { position: absolute; font-weight: bold; font-size: 20px; animation: floatUp 1.2s ease-out forwards; text-shadow: 2px 2px 0 #000; z-index: 100; pointer-events: none; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-60px); } }
        .text-damage { color: #e74c3c; } .text-heal { color: #2ecc71; } .text-crit { color: #ffcc00; font-size: 26px; } .text-mana { color: #f1c40f; font-size: 16px; }
        .attacking { animation: bump 0.2s; } @keyframes bump { 50% { transform: scale(1.1); } }
        .damaged { animation: shake 0.4s; } @keyframes shake { 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        #flash-effect { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:50; }
        .ult-flash { animation: flash 1s linear; background: rgba(10, 200, 185, 0.5); } @keyframes flash { from { opacity: 1; } to { opacity: 0; } }

        @media screen and (max-width: 768px) {
            .battle-scene { flex-direction: column-reverse; gap: 20px; }
            .character-box { width: 90%; }
            #enemy-box { justify-content: flex-end; }
            #player-box { justify-content: flex-start; }
            .controls { height: auto; }
            .skills { grid-template-columns: 1fr 1fr; }
            #vs-text { transform: rotate(90deg); margin: 10px; font-size: 1.2rem; }
        }
    </style>
</head>
<body>

    <a href="index.html" class="back-btn" id="ui-menu">‚Üê Menu</a>
    
    <div id="inventory-frame">
        <div class="inv-slot" onclick="useInventoryItem('potion')" ontouchstart="showTooltip(this, 'potion')" ontouchend="hideTooltip()" onmouseover="showTooltip(this, 'potion')" onmouseout="hideTooltip()">
            üß™ <span class="inv-count" id="count-potion">0</span>
        </div>
        <div class="inv-slot" onclick="useInventoryItem('elixir')" ontouchstart="showTooltip(this, 'elixir')" ontouchend="hideTooltip()" onmouseover="showTooltip(this, 'elixir')" onmouseout="hideTooltip()">
            ‚ö° <span class="inv-count" id="count-elixir">0</span>
        </div>
    </div>

    <div class="top-bar-controls">
        <button class="control-btn-ui" onclick="openSettings()">‚öôÔ∏è</button>
        <button class="control-btn-ui" id="btn-open-shop" onclick="openShop()">üõí SHOP</button>
        <select class="control-btn-ui" id="lang-select" onchange="changeLanguage(this.value)">
            <option value="en">English</option>
            <option value="tr">T√ºrk√ße</option>
        </select>
    </div>

    <div id="inv-tooltip"></div>

    <audio id="bgMusic" loop preload="auto"></audio>

    <div id="settings-modal">
        <div class="settings-content">
            <h2 style="color:var(--ruined-green); text-align:center; border-bottom:1px solid #444; padding-bottom:10px;" id="ui-settings-title">SETTINGS</h2>
            <div class="setting-row"><span id="ui-music-vol">Music Volume</span><input type="range" id="vol-music" min="0" max="1" step="0.1" oninput="updateVolume('music', this.value)"></div>
            <div class="setting-row"><span id="ui-sfx-vol">SFX Volume</span><input type="range" id="vol-sfx" min="0" max="1" step="0.1" oninput="updateVolume('sfx', this.value)"></div>
            <button class="start-btn" style="width:100%; padding:10px;" onclick="closeSettings()" id="ui-settings-close">CLOSE</button>
        </div>
    </div>

    <div id="shop-modal">
        <div class="shop-content">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #444; padding-bottom:10px;">
                <h2 style="color:var(--gold-color); margin:0;" id="ui-shop-title">SHOP</h2>
                <span id="shop-gold" style="color:white; font-weight:bold;">0 G</span>
            </div>
            <div style="text-align:right; margin:10px 0;"><button id="sell-mode-btn" class="control-btn-ui" onclick="toggleSellMode()">SELL: OFF</button></div>
            <div class="shop-grid" id="shop-container"></div>
            <button class="start-btn" id="ui-shop-close" style="padding:10px; width:100%; margin-top:10px;" onclick="closeShop()">CLOSE</button>
        </div>
    </div>

    <div class="game-wrapper">
        <div id="start-screen">
            <h1 style="color:white; margin-bottom:5px;" id="ui-title">THE RUINED KING</h1>
            <p style="color:#aaa; font-style:italic;" id="ui-subtitle">"She is waiting..."</p>
            <button class="start-btn" id="ui-start-btn" onclick="initGame()">START JOURNEY</button>
        </div>

        <div id="cinematic-dialogue">
            <div class="dialogue-box">
                <div id="cinematic-text">...</div>
                <button class="start-btn" id="ui-next-btn" style="padding: 10px 30px; font-size: 1rem;" onclick="nextDialogue()">NEXT</button>
            </div>
        </div>

        <div id="overlay">
            <h2 style="color:var(--ruined-green); font-size:2.5rem;" id="ui-victory">VICTORY</h2>
            <button class="start-btn" id="ui-continue-btn" onclick="nextLevel()">CONTINUE</button>
        </div>

        <div class="battle-scene">
            <div class="character-box" id="player-box">
                <div class="info-btn" ontouchstart="showCharacterTooltip(this, 'player')" ontouchend="hideTooltip()" onmouseover="showCharacterTooltip(this, 'player')" onmouseout="hideTooltip()">i</div>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Viego_0.jpg" class="character-img viego-glow">
                <h2>VIEGO</h2>
                <div class="stat-bar"><div class="fill hp-fill" id="player-hp-bar" style="width: 100%;"></div><span class="bar-text" id="player-hp-text">150/150</span></div>
                <div class="stat-bar" style="margin-top:2px; border-color:var(--power-yellow);"><div class="fill power-fill" id="player-power-bar" style="width: 0%;"></div><span class="bar-text" id="player-power-text" style="color:var(--power-yellow); top:-2px;">0/100</span></div>
            </div>

            <div id="vs-text">VS</div>

            <div class="character-box" id="enemy-box">
                <div class="info-btn" ontouchstart="showCharacterTooltip(this, 'enemy')" ontouchend="hideTooltip()" onmouseover="showCharacterTooltip(this, 'enemy')" onmouseout="hideTooltip()">i</div>
                <img src="" class="character-img enemy-glow" id="enemy-img">
                <h2 id="enemy-name">ENEMY</h2>
                <div class="stat-bar"><div class="fill hp-fill" id="enemy-hp-bar" style="width: 100%;"></div><span class="bar-text" id="enemy-hp-text">100/100</span></div>
                <div class="stat-bar" style="margin-top:2px; border-color:var(--power-yellow);"><div class="fill power-fill" id="enemy-power-bar" style="width: 0%;"></div></div>
            </div>
        </div>

        <div class="controls hidden-ui" id="combat-controls">
            <div class="log-box" id="combat-log">...</div>
            <div class="skills">
                <button class="skill-btn" id="btn-basic" onclick="useSkill('basic')">
                    <span class="skill-name" id="skill-name-basic">Blade</span>
                    <span class="skill-cost" id="skill-desc-basic">Basic Dmg</span>
                </button>
                <button class="skill-btn" id="btn-q" onclick="useSkill('q')">
                    <span class="skill-name" id="skill-name-q">Ruined King (Q)</span>
                    <span class="skill-cost" id="skill-desc-q">30 Dmg | 20 MP</span>
                </button>
                <button class="skill-btn" id="btn-w" onclick="useSkill('w')">
                    <span class="skill-name" id="skill-name-w">Spectral Maw (W)</span>
                    <span class="skill-cost" id="skill-desc-w">Stun/Crit | 30 MP</span>
                </button>
                <button class="skill-btn ult-btn" id="btn-r" onclick="useSkill('r')">
                    <span class="skill-name" id="skill-name-r">HEARTBREAKER</span>
                    <span class="skill-cost" id="skill-desc-r">FINISHER | 1/Round</span>
                </button>
            </div>
        </div>
    </div>

<script>
    // --- SES Y√ñNETƒ∞Mƒ∞ ---
    const sounds = {
        basic1: new Audio('BasicAA_1.wav'),
        basic2: new Audio('BasicAA_2.wav'),
        w_skill: new Audio('W_skill.wav')
    };

    let gameSettings = { musicVolume: 0.3, sfxVolume: 0.5, lang: 'en' };

    function loadSettings() {
        const saved = localStorage.getItem('viegoRPG_settings');
        if (saved) gameSettings = JSON.parse(saved);
        document.getElementById('vol-music').value = gameSettings.musicVolume;
        document.getElementById('vol-sfx').value = gameSettings.sfxVolume;
        document.getElementById('lang-select').value = gameSettings.lang;
        document.getElementById('bgMusic').volume = gameSettings.musicVolume;
        changeLanguage(gameSettings.lang); 
    }

    function saveSettings() { localStorage.setItem('viegoRPG_settings', JSON.stringify(gameSettings)); }

    function updateVolume(type, val) {
        if (type === 'music') { gameSettings.musicVolume = parseFloat(val); document.getElementById('bgMusic').volume = gameSettings.musicVolume; } 
        else { gameSettings.sfxVolume = parseFloat(val); }
        saveSettings();
    }

    function playSfx(type) {
        if (gameSettings.sfxVolume <= 0) return;
        let soundToPlay = null;
        if (type === 'basic') soundToPlay = Math.random() > 0.5 ? sounds.basic1 : sounds.basic2;
        else if (type === 'w') soundToPlay = sounds.w_skill;
        if (soundToPlay) { soundToPlay.volume = gameSettings.sfxVolume; soundToPlay.currentTime = 0; soundToPlay.play().catch(e => {}); }
    }

    // --- I18N (Dƒ∞L) ---
    const translations = {
        en: {
            ui: {
                menu: "‚Üê Menu", title: "THE RUINED KING", sub: "\"She is waiting...\"", start: "START JOURNEY", next: "NEXT", victory: "VICTORY", continue: "CONTINUE",
                shopTitle: "RUINED SHOP", shopClose: "CLOSE", shopOpen: "üõí SHOP", sellOff: "SELL: OFF", sellOn: "SELL: ON", buy: "BUY", sell: "SELL",
                settingsTitle: "SETTINGS", settingsClose: "CLOSE", musicVol: "Music Volume", sfxVol: "SFX Volume"
            },
            skills: {
                basic: { name: "Basic Attack", desc: "Dmg | +MP" },
                q: { name: "Blade of the Ruined King", desc: "Dmg | 20 MP" },
                w: { name: "Spectral Maw", desc: "Crit | 30 MP" },
                r: { name: "HEARTBREAKER", desc: "EXECUTE | 1/Round" }
            },
            logs: {
                wait: "Waiting for battle...", start: "Battle Started!", pStrike: "Viego strikes!", pQ: "Blade of the Ruined King hits!", pW: "Spectral Maw hits! Next hit CRITS!",
                pR: "HEARTBREAKER!", noPower: "Not enough Power!", enemyAtk: "attacks for", defeat: "DEFEAT... The Mist fades.", usedPot: "Used Potion (+50 HP)",
                usedElix: "Used Elixir (+50 Power)", notEnoughGold: "Not enough Gold!", won: "Game Over! You conquered all.",
                gpQ: "Gangplank uses Parrrley! CRITICAL!", gpOrange: "Gangplank eats an Orange and heals!"
            },
            tooltips: {
                viego: "Passive: Soul Eater<br>Ult: Heartbreaker (Executes)", threat: "Threat", potion: { name: "Mist Potion", desc: "Heals 50 HP" },
                elixir: { name: "Wrath Elixir", desc: "Grants 50 Power" }, sword: { name: "B.F. Sword", desc: "+10 Base Damage" }
            },
            enemies: {
                gangplank: { 
                    name: "Gangplank", 
                    intro: [
                        "Gangplank: You think you can waltz into Bilgewater, ghost?", 
                        "Viego: I care not for your petty port. I seek her.",
                        "Gangplank: Everyone pays the tithe here. Even the dead.",
                        "Viego: I am the King of the Dead. Kneel or break."
                    ] 
                },
                yorick: { 
                    name: "Yorick", 
                    intro: [
                        "Yorick: The Maiden screams in your presence, Ruined King.", 
                        "Viego: Where is Isolde? The Mist whispers her name!",
                        "Yorick: The Mist is a poison you unleashed. I will cure it with this shovel.",
                        "Viego: There is no cure for love, Monk. Only the end."
                    ] 
                },
                lucian: { 
                    name: "Lucian", 
                    intro: [
                        "Lucian: I've hunted shadows all my life. You're just the biggest one.", 
                        "Viego: Your wife lives because of me! You should thank me.",
                        "Lucian: Senna is cursed because of you. Today, the Shadow Isles fall.",
                        "Viego: If I cannot have happiness, no one shall!"
                    ] 
                },
                mordekaiser: { 
                    name: "Mordekaiser", 
                    intro: [
                        "Mordekaiser: A King? You are but a child playing with souls.", 
                        "Viego: My love transcends death! What is your iron compared to my heart?",
                        "Mordekaiser: Iron is eternal. Love is a weakness of flesh.",
                        "Viego: I will shatter your armor and reclaim what is mine!"
                    ] 
                }
            },
            bossSkills: { gpQ: "Parrrley", gpW: "Remove Scurvy" }
        },
        tr: {
            ui: {
                menu: "‚Üê Men√º", title: "MAHVOLMU≈û KRAL", sub: "\"O beni bekliyor...\"", start: "YOLCULUƒûA BA≈ûLA", next: "ƒ∞LERƒ∞", victory: "ZAFER", continue: "DEVAM ET",
                shopTitle: "MAHVOLMU≈û MARKET", shopClose: "KAPAT", shopOpen: "üõí MARKET", sellOff: "SATI≈û: KAPALI", sellOn: "SATI≈û: A√áIK", buy: "SATIN AL", sell: "SAT",
                settingsTitle: "AYARLAR", settingsClose: "KAPAT", musicVol: "M√ºzik Sesi", sfxVol: "Efekt Sesi"
            },
            skills: {
                basic: { name: "Temel Saldƒ±rƒ±", desc: "Hasar | +G√º√ß" },
                q: { name: "Mahvolmu≈ü Kralƒ±n Kƒ±lƒ±cƒ±", desc: "Hasar | 20 G√º√ß" },
                w: { name: "Hortlaƒüƒ±n Pen√ßesi", desc: "Kritik | 30 G√º√ß" },
                r: { name: "KALP KIRAN", desc: "Bƒ∞Tƒ∞Rƒ∞Cƒ∞ | 1/Tur" }
            },
            logs: {
                wait: "Sava≈ü bekleniyor...", start: "Sava≈ü Ba≈üladƒ±!", pStrike: "Viego saldƒ±rdƒ±!", pQ: "Mahvolmu≈ü Kralƒ±n Kƒ±lƒ±cƒ±!", pW: "Hayalet Aƒüƒ±z √ßarptƒ±! Kritik hazƒ±r!",
                pR: "KALP KIRAN!", noPower: "Yetersiz G√º√ß!", enemyAtk: "saldƒ±rdƒ± ve vurdu:", defeat: "YENƒ∞LGƒ∞... Sis daƒüƒ±lƒ±yor.", usedPot: "ƒ∞ksir ƒ∞√ßildi (+50 Can)",
                usedElix: "Elixir ƒ∞√ßildi (+50 G√º√ß)", notEnoughGold: "Yetersiz Altƒ±n!", won: "Oyun Bitti! Hepsini fethettin.",
                gpQ: "Gangplank √áakaralmaz kullandƒ±! KRƒ∞Tƒ∞K!", gpOrange: "Gangplank Portakal yedi ve iyile≈üti!"
            },
            tooltips: {
                viego: "Pasif: Ruh Yiyen<br>Ulti: Kalp Kƒ±ran (ƒ∞nfaz)", threat: "Tehdit", potion: { name: "Sis ƒ∞ksiri", desc: "50 Can Yeniler" },
                elixir: { name: "√ñfke ƒ∞ksiri", desc: "50 G√º√ß Verir" }, sword: { name: "A.M. Kƒ±lƒ±cƒ±", desc: "+10 Taban Hasar" }
            },
            enemies: {
                gangplank: { 
                    name: "Gangplank", 
                    intro: [
                        "Gangplank: Bilgewater'a b√∂yle elini kolunu sallayarak girebileceƒüini mi sandƒ±n hayalet?", 
                        "Viego: Senin k√º√ß√ºk limanƒ±n umurumda deƒüil. Ben onu arƒ±yorum.",
                        "Gangplank: Burada herkes hara√ß √∂der. √ñl√ºler bile.",
                        "Viego: Ben √ñl√ºlerin Kralƒ±yƒ±m. Diz √ß√∂k ya da kƒ±rƒ±l."
                    ] 
                },
                yorick: { 
                    name: "Yorick", 
                    intro: [
                        "Yorick: Sis'in Hanƒ±mƒ± senin varlƒ±ƒüƒ±nda √ßƒ±ƒülƒ±k atƒ±yor, Mahvolmu≈ü Kral.", 
                        "Viego: Isolde nerede? Sis onun adƒ±nƒ± fƒ±sƒ±ldƒ±yor!",
                        "Yorick: Kara Sis senin yaydƒ±ƒüƒ±n bir zehir. Ben de onu bu k√ºrekle temizleyeceƒüim.",
                        "Viego: A≈ükƒ±n tedavisi yoktur Ke≈üi≈ü. Sadece sonu vardƒ±r."
                    ] 
                },
                lucian: { 
                    name: "Lucian", 
                    intro: [
                        "Lucian: Hayatƒ±m boyunca g√∂lgeleri avladƒ±m. Sen sadece en b√ºy√ºƒü√ºs√ºn.", 
                        "Viego: Karƒ±n benim sayemde ya≈üƒ±yor! Bana te≈üekk√ºr etmelisin.",
                        "Lucian: Senna senin y√ºz√ºnden lanetlendi. Bug√ºn G√∂lge Adalar d√º≈üecek.",
                        "Viego: Eƒüer ben mutlu olamazsam, kimse olamaz!"
                    ] 
                },
                mordekaiser: { 
                    name: "Mordekaiser", 
                    intro: [
                        "Mordekaiser: Kral mƒ±? Sen sadece ruhlarla oynayan ≈üƒ±marƒ±k bir √ßocuksun.", 
                        "Viego: Benim a≈ükƒ±m √∂l√ºm√º a≈üar! Senin demirin benim kalbimin yanƒ±nda nedir ki?",
                        "Mordekaiser: Demir ebedidir. A≈ük ise etin bir zayƒ±flƒ±ƒüƒ±dƒ±r.",
                        "Viego: Zƒ±rhƒ±nƒ± par√ßalayacaƒüƒ±m ve benim olanƒ± geri alacaƒüƒ±m!"
                    ] 
                }
            },
            bossSkills: { gpQ: "√áakaralmaz Vuru≈üu", gpW: "ƒ∞sk√∂rb√ºte √áare" }
        }
    };

    // --- OYUN VERƒ∞LERƒ∞ ---
    const enemiesData = [
        { id: "gangplank", hp: 200, maxHp: 200, power: 0, maxPower: 100, damage: 15, wUsed: false, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Gangplank_0.jpg" },
        { id: "yorick", hp: 250, maxHp: 250, power: 0, maxPower: 100, damage: 20, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Yorick_0.jpg" },
        { id: "lucian", hp: 300, maxHp: 300, power: 0, maxPower: 100, damage: 25, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Lucian_0.jpg" },
        { id: "mordekaiser", hp: 500, maxHp: 500, power: 0, maxPower: 100, damage: 40, img: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Mordekaiser_0.jpg" }
    ];

    let player = { hp: 150, maxHp: 150, power: 0, maxPower: 100, potions: 2, elixirs: 1, gold: 0, level: 1, ultUsed: false };
    let currentEnemyIndex = 0;
    let turn = "player";
    let dialogueQueue = [];
    let dialogueIndex = 0;
    let isSellMode = false;

    // --- Dƒ∞L ---
    function changeLanguage(lang) {
        gameSettings.lang = lang;
        saveSettings();
        updateTexts();
    }

    function updateTexts() {
        const t = translations[gameSettings.lang];
        document.getElementById('ui-menu').innerText = t.ui.menu;
        document.getElementById('ui-title').innerText = t.ui.title;
        document.getElementById('ui-subtitle').innerText = t.ui.sub;
        document.getElementById('ui-start-btn').innerText = t.ui.start;
        document.getElementById('ui-next-btn').innerText = t.ui.next;
        document.getElementById('ui-victory').innerText = t.ui.victory;
        document.getElementById('ui-continue-btn').innerText = t.ui.continue;
        document.getElementById('ui-shop-title').innerText = t.ui.shopTitle;
        document.getElementById('ui-shop-close').innerText = t.ui.shopClose;
        document.getElementById('btn-open-shop').innerText = t.ui.shopOpen;
        document.getElementById('sell-mode-btn').innerText = isSellMode ? t.ui.sellOn : t.ui.sellOff;
        document.getElementById('ui-settings-title').innerText = t.ui.settingsTitle;
        document.getElementById('ui-settings-close').innerText = t.ui.settingsClose;
        document.getElementById('ui-music-vol').innerText = t.ui.musicVol;
        document.getElementById('ui-sfx-vol').innerText = t.ui.sfxVol;
        
        document.getElementById('skill-name-basic').innerText = t.skills.basic.name;
        document.getElementById('skill-name-q').innerText = t.skills.q.name;
        document.getElementById('skill-name-w').innerText = t.skills.w.name;
        document.getElementById('skill-name-r').innerText = t.skills.r.name;
        
        const enemyData = enemiesData[currentEnemyIndex];
        if(enemyData) document.getElementById('enemy-name').innerText = t.enemies[enemyData.id].name.toUpperCase();
        
        updateUI(); 
    }

    // --- BA≈ûLATMA ---
    function initGame() {
        document.getElementById('start-screen').style.display = 'none';
        const bgMusic = document.getElementById('bgMusic');
        bgMusic.src = "Tier1.mp3"; 
        bgMusic.volume = gameSettings.musicVolume;
        bgMusic.play().catch(e => {});
        loadLevel(0);
    }

    function loadLevel(index) {
        currentEnemyIndex = index;
        const t = translations[gameSettings.lang];
        if (index >= enemiesData.length) { alert(t.logs.won); location.reload(); return; }
        const enemy = enemiesData[index];
        enemy.hp = enemy.maxHp; 
        enemy.power = 0; 
        enemy.wUsed = false; 
        player.ultUsed = false; 
        
        document.getElementById('enemy-name').innerText = t.enemies[enemy.id].name.toUpperCase();
        document.getElementById('enemy-img').src = enemy.img;
        updateUI();
        
        dialogueQueue = t.enemies[enemy.id].intro;
        dialogueIndex = 0;
        document.getElementById('combat-controls').classList.add('hidden-ui'); 
        document.getElementById('cinematic-dialogue').style.display = 'flex';
        updateDialogueText();
    }

    function updateDialogueText() {
        if (dialogueIndex < dialogueQueue.length) {
            document.getElementById('cinematic-text').innerText = dialogueQueue[dialogueIndex];
        } else {
            document.getElementById('cinematic-dialogue').style.display = 'none';
            document.getElementById('combat-controls').classList.remove('hidden-ui');
            log(translations[gameSettings.lang].logs.start);
            turn = "player";
            updateUI(); // Ba≈ülangƒ±√ßta buton kontrol√º
        }
    }

    function nextDialogue() { dialogueIndex++; updateDialogueText(); }

    // --- SAVA≈û Sƒ∞STEMƒ∞ ---
    function useSkill(type) {
        if (turn !== 'player') return;
        const t = translations[gameSettings.lang];
        const enemy = enemiesData[currentEnemyIndex];
        let dmg = 0;
        let msg = "";

        if (type === 'basic') {
            playSfx('basic'); 
            dmg = 15 + (player.level * 5);
            msg = t.logs.pStrike;
        } else if (type === 'q') {
            if (player.power < 20) { log(t.logs.noPower + " (20)"); return; }
            playSfx('basic'); 
            player.power -= 20;
            dmg = 30 + (player.level * 8);
            let heal = 10;
            player.hp = Math.min(player.maxHp, player.hp + heal);
            showFloat(document.getElementById('player-box'), `+${heal}`, 'heal');
            msg = t.logs.pQ;
        } else if (type === 'w') {
            if (player.power < 30) { log(t.logs.noPower + " (30)"); return; }
            playSfx('w'); 
            player.power -= 30;
            dmg = 45 + (player.level * 10);
            msg = t.logs.pW;
        } else if (type === 'r') {
            if (player.ultUsed) { log("Ult already used this round!"); return; }
            player.ultUsed = true;
            dmg = 100 + (player.level * 20);
            msg = t.logs.pR;
            document.body.classList.add('death-realm-active');
            setTimeout(() => document.body.classList.remove('death-realm-active'), 500);
        }

        enemy.hp -= dmg;
        showFloat(document.getElementById('enemy-box'), `-${dmg}`, 'damage');
        
        document.getElementById('player-box').classList.add('attacking');
        setTimeout(() => document.getElementById('player-box').classList.remove('attacking'), 200);
        document.getElementById('enemy-box').classList.add('damaged');
        setTimeout(() => document.getElementById('enemy-box').classList.remove('damaged'), 400);

        log(`${msg} ${dmg} dmg.`);
        updateUI();

        if (enemy.hp <= 0) {
            enemy.hp = 0;
            updateUI();
            setTimeout(victory, 1000);
        } else {
            turn = "enemy";
            updateUI(); // Disable buttons
            setTimeout(enemyTurn, 1000);
        }
    }

    function enemyTurn() {
        const t = translations[gameSettings.lang];
        const enemy = enemiesData[currentEnemyIndex];
        const enemyName = t.enemies[enemy.id].name;
        
        let pRegen = Math.floor(Math.random() * 11) + 5;
        let eRegen = Math.floor(Math.random() * 11) + 5;
        player.power = Math.min(100, player.power + pRegen);
        enemy.power = Math.min(100, enemy.power + eRegen);
        showFloat(document.getElementById('player-box'), `+${pRegen} MP`, 'mana');
        showFloat(document.getElementById('enemy-box'), `+${eRegen} MP`, 'mana');
        updateUI();

        // GANGPLANK AI
        if (enemy.id === 'gangplank') {
            if (enemy.hp < (enemy.maxHp * 0.4) && enemy.power >= 30 && !enemy.wUsed) {
                enemy.power = 0;
                enemy.hp = Math.min(enemy.maxHp, enemy.hp + 50);
                enemy.wUsed = true;
                showFloat(document.getElementById('enemy-box'), t.bossSkills.gpW, 'heal');
                showFloat(document.getElementById('enemy-box'), "+50", 'heal');
                log(t.logs.gpOrange);
                
                turn = "player"; 
                updateUI(); // RE-ENABLE BUTTONS
                return; 
            }
            if (enemy.power >= 20) {
                enemy.power = 0;
                let dmg = Math.floor((enemy.damage + Math.floor(Math.random() * 10)) * 1.75);
                player.hp -= dmg;
                showFloat(document.getElementById('enemy-box'), t.bossSkills.gpQ, 'crit');
                showFloat(document.getElementById('player-box'), `-${dmg}`, 'damage');
                log(`${enemyName} ${t.logs.gpQ} ${dmg} dmg!`);
                updateUI(); // Update HP
                
                if (player.hp <= 0) { player.hp = 0; updateUI(); log(t.logs.defeat); setTimeout(() => location.reload(), 2000); return; }
                
                turn = "player";
                updateUI(); // RE-ENABLE BUTTONS
                return;
            }
        }

        // STANDART SALDIRI
        let dmg = enemy.damage + Math.floor(Math.random() * 10);
        player.hp -= dmg;
        showFloat(document.getElementById('player-box'), `-${dmg}`, 'damage');
        
        document.getElementById('enemy-box').classList.add('attacking');
        setTimeout(() => document.getElementById('enemy-box').classList.remove('attacking'), 200);
        document.getElementById('player-box').classList.add('damaged');
        setTimeout(() => document.getElementById('player-box').classList.remove('damaged'), 400);

        log(`${enemyName} ${t.logs.enemyAtk} ${dmg}.`);
        updateUI();

        if (player.hp <= 0) {
            player.hp = 0;
            updateUI();
            log(t.logs.defeat);
            setTimeout(() => location.reload(), 2000); 
        } else {
            turn = "player";
            updateUI(); // RE-ENABLE BUTTONS
        }
    }

    function victory() {
        document.getElementById('overlay').style.display = 'flex';
        player.gold += 100;
        player.level++;
        player.maxHp += 20;
        player.hp = player.maxHp;
    }

    function nextLevel() {
        document.getElementById('overlay').style.display = 'none';
        loadLevel(currentEnemyIndex + 1);
    }

    // --- ENVANTER & SHOP & SETTINGS ---
    function useInventoryItem(type) {
        if (turn !== 'player') return;
        const t = translations[gameSettings.lang];
        if (type === 'potion' && player.potions > 0) {
            player.potions--; player.hp = Math.min(player.maxHp, player.hp + 50);
            showFloat(document.getElementById('player-box'), "+50", 'heal'); log(t.logs.usedPot); playSfx('magic');
        } else if (type === 'elixir' && player.elixirs > 0) {
            player.elixirs--; player.power = Math.min(player.maxPower, player.power + 50);
            showFloat(document.getElementById('player-box'), "+50 Power", 'heal'); log(t.logs.usedElix); playSfx('magic');
        }
        updateUI();
    }

    function openSettings() { document.getElementById('settings-modal').style.display = 'flex'; }
    function closeSettings() { document.getElementById('settings-modal').style.display = 'none'; }
    function toggleSellMode() { isSellMode = !isSellMode; updateTexts(); openShop(); }

    function openShop() {
        const modal = document.getElementById('shop-modal');
        const container = document.getElementById('shop-container');
        document.getElementById('shop-gold').innerText = player.gold + " G";
        const t = translations[gameSettings.lang];
        const items = [ { id: 'potion', name: t.tooltips.potion.name, price: 50, icon: "üß™" }, { id: 'elixir', name: t.tooltips.elixir.name, price: 50, icon: "‚ö°" }, { id: 'sword', name: t.tooltips.sword.name, price: 300, icon: "‚öîÔ∏è" } ];
        container.innerHTML = "";
        items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'shop-item';
            let btnText = isSellMode ? `${t.ui.sell} ${item.price/2}G` : `${t.ui.buy} ${item.price}G`;
            div.innerHTML = `<div style="color:white;">${item.icon} ${item.name}</div><button class="buy-btn" onclick="handleShop('${item.id}', ${item.price})">${btnText}</button>`;
            container.appendChild(div);
        });
        modal.style.display = 'flex';
    }

    function handleShop(id, price) {
        const t = translations[gameSettings.lang];
        if (isSellMode) { if (id === 'potion' && player.potions > 0) { player.potions--; player.gold += price/2; } else if (id === 'elixir' && player.elixirs > 0) { player.elixirs--; player.gold += price/2; } openShop(); updateUI(); } 
        else { if (player.gold >= price) { player.gold -= price; if (id === 'potion') player.potions++; if (id === 'elixir') player.elixirs++; openShop(); updateUI(); } else { alert(t.logs.notEnoughGold); } }
    }
    function closeShop() { document.getElementById('shop-modal').style.display = 'none'; isSellMode = false; updateTexts(); }

    // --- UI G√úNCELLEME ---
    function updateUI() {
        const enemy = enemiesData[currentEnemyIndex];
        const pHpPct = (player.hp / player.maxHp) * 100;
        document.getElementById('player-hp-bar').style.width = pHpPct + "%";
        document.getElementById('player-hp-text').innerText = `${Math.ceil(player.hp)}/${player.maxHp}`;
        
        const pMpPct = (player.power / player.maxPower) * 100;
        document.getElementById('player-power-bar').style.width = pMpPct + "%";
        document.getElementById('player-power-text').innerText = `${Math.floor(player.power)}/${player.maxPower}`;

        const eHpPct = (enemy.hp / enemy.maxHp) * 100;
        document.getElementById('enemy-hp-bar').style.width = eHpPct + "%";
        document.getElementById('enemy-hp-text').innerText = `${Math.ceil(enemy.hp)}/${enemy.maxHp}`;
        const eMpPct = (enemy.power / enemy.maxPower) * 100;
        document.getElementById('enemy-power-bar').style.width = eMpPct + "%";

        document.getElementById('count-potion').innerText = player.potions;
        document.getElementById('count-elixir').innerText = player.elixirs;

        let basicDmg = 15 + (player.level * 5);
        let qDmg = 30 + (player.level * 8);
        let wDmg = 45 + (player.level * 10);
        let rDmg = 100 + (player.level * 20);

        document.getElementById('skill-desc-basic').innerText = `~${basicDmg} Dmg | +10 MP`;
        document.getElementById('skill-desc-q').innerText = `~${qDmg} Dmg | 20 MP`;
        document.getElementById('skill-desc-w').innerText = `~${wDmg} Dmg | 30 MP`;
        document.getElementById('skill-desc-r').innerText = `~${rDmg} Dmg | 1/Round`;

        const isPlayerTurn = (turn === 'player');
        
        document.getElementById('btn-basic').disabled = !isPlayerTurn;
        document.getElementById('btn-q').disabled = !isPlayerTurn || player.power < 20;
        document.getElementById('btn-w').disabled = !isPlayerTurn || player.power < 30;
        document.getElementById('btn-r').disabled = !isPlayerTurn || player.ultUsed;
    }

    function log(msg) {
        const box = document.getElementById('combat-log');
        box.innerHTML = `> ${msg}<br>` + box.innerHTML;
    }

    function showFloat(target, text, type) {
        const el = document.createElement('div');
        el.className = `float-text text-${type}`;
        el.innerText = text;
        const rect = target.getBoundingClientRect();
        el.style.left = (rect.left + rect.width/2 - 20) + 'px';
        el.style.top = (rect.top) + 'px';
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 1000);
    }

    function showCharacterTooltip(el, who) {
        const tip = document.getElementById('inv-tooltip');
        const t = translations[gameSettings.lang];
        let html = "";
        if (who === 'player') html = `<div class="tooltip-title">VIEGO</div>${t.tooltips.viego}`;
        else { const enemy = enemiesData[currentEnemyIndex]; html = `<div class="tooltip-title">${t.enemies[enemy.id].name.toUpperCase()}</div>Dmg: ${enemy.damage}<br><span class="info-strong">${t.tooltips.threat}:</span> High`; }
        tip.innerHTML = html;
        tip.style.display = 'block';
        const rect = el.getBoundingClientRect();
        let left = rect.left - 200; if (left < 10) left = 10; 
        tip.style.top = (rect.bottom + 5) + 'px'; tip.style.left = left + 'px';
    }
    
    function showTooltip(el, type) {
        const tip = document.getElementById('inv-tooltip');
        const t = translations[gameSettings.lang];
        let text = ""; let title = "";
        if (type === 'potion') { title = t.tooltips.potion.name; text = t.tooltips.potion.desc; } else if (type === 'elixir') { title = t.tooltips.elixir.name; text = t.tooltips.elixir.desc; }
        tip.innerHTML = `<div class="tooltip-title">${title}</div>${text}`;
        tip.style.display = 'block';
        const rect = el.getBoundingClientRect();
        tip.style.left = (rect.right + 10) + 'px'; tip.style.top = rect.top + 'px';
    }
    function hideTooltip() { document.getElementById('inv-tooltip').style.display = 'none'; }

    // --- MIST (SHADER) ---
    const bgCanvas = document.body.appendChild(document.createElement("canvas"));
    bgCanvas.id = "mist-canvas-bg";
    const gl = bgCanvas.getContext("webgl2");
    if(gl) {
        const vsSource = `#version 300 es
        precision mediump float; const vec2 p[6]=vec2[6](vec2(-1,-1),vec2(1,-1),vec2(-1,1),vec2(-1,1),vec2(1,-1),vec2(1,1)); out vec2 uv; void main(){uv=p[gl_VertexID]*0.5+0.5;gl_Position=vec4(p[gl_VertexID],0,1);}`;
        const fsSource = `#version 300 es
        precision highp float; uniform float time; in vec2 uv; out vec4 color;
        float n(vec2 p){return fract(sin(dot(p,vec2(1,300)))*43758.54);}
        float fbm(vec2 p){float v=0.,a=.5;for(int i=0;i<4;i++){v+=a*n(p);p*=2.;a*=.5;}return v;}
        void main(){vec2 p=uv;float t=time*0.1;float f=fbm(p*3.+t);
        color=vec4(0.04,0.78,0.72,smoothstep(0.2,0.9,f)*0.3);}`;
        const createShader = (ty, src) => { const s=gl.createShader(ty); gl.shaderSource(s,src); gl.compileShader(s); return s; };
        const prog = gl.createProgram(); 
        gl.attachShader(prog, createShader(gl.VERTEX_SHADER, vsSource));
        gl.attachShader(prog, createShader(gl.FRAGMENT_SHADER, fsSource));
        gl.linkProgram(prog); gl.useProgram(prog);
        const tLoc = gl.getUniformLocation(prog, "time");
        const start = Date.now();
        const render = () => { bgCanvas.width = window.innerWidth; bgCanvas.height = window.innerHeight; gl.viewport(0,0,bgCanvas.width, bgCanvas.height); gl.uniform1f(tLoc, (Date.now()-start)/1000); gl.drawArrays(gl.TRIANGLES, 0, 6); requestAnimationFrame(render); };
        render();
    }

    window.onload = function() { loadSettings(); }
</script>
</body>
</html>
